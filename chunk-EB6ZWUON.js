import{e as z}from"./chunk-3B2Y74WR.js";import{a as Q}from"./chunk-YL3TDIGQ.js";import"./chunk-LN47MBAJ.js";import{a as X}from"./chunk-OBD3L7BG.js";import{a as J}from"./chunk-PZF2KSPB.js";import{c as W}from"./chunk-MXBDCOJX.js";import{g as q,l as N}from"./chunk-JHAYVYNF.js";import{k as A}from"./chunk-BPDV6QKT.js";import{Cb as I,Db as C,K as V,Oa as t,Ob as R,Rb as r,Sb as b,Tb as _,X as L,Za as $,aa as K,ba as w,ca as T,da as B,dc as Y,ga as F,gb as Z,gc as c,hc as m,ja as g,nc as O,ob as h,p as E,pb as f,q as y,r as G,rb as U,sb as j,tb as P,ub as a,vb as o,wb as k,x as M,zb as H}from"./chunk-4EEEF725.js";import{d as D}from"./chunk-4CLCTAJ7.js";var te=e=>["/details/users",e],ie=(e,i)=>i.id;function ne(e,i){e&1&&k(0,"div",3)}function ae(e,i){e&1&&(T(),a(0,"svg",4),k(1,"path",8),o())}function oe(e,i){if(e&1){let p=H();a(0,"div",5),T(),a(1,"svg",9),k(2,"path",10),o(),B(),a(3,"p"),r(4),o(),a(5,"button",11),I("click",function(){K(p);let u=C();return w(u.loadLeaderboard())}),r(6),c(7,"transloco"),o()()}if(e&2){let p=C();t(4),b(p.error()),t(2),_(" ",m(7,2,"details.leaderboard.retry")," ")}}function re(e,i){e&1&&(a(0,"div",6),k(1,"div",12),a(2,"p"),r(3),c(4,"transloco"),o()()),e&2&&(t(3),b(m(4,1,"details.leaderboard.loading")))}function de(e,i){e&1&&(a(0,"div",45),T(),a(1,"svg",46),k(2,"path",17),o(),B(),a(3,"span"),r(4),c(5,"transloco"),o()()),e&2&&(t(4),b(m(5,1,"details.leaderboard.thank_you_message")))}function le(e,i){if(e&1&&(a(0,"div",24)(1,"div",41)(2,"div",42)(3,"span",43),r(4),c(5,"transloco"),o(),a(6,"span",44),r(7),c(8,"number"),o()(),h(9,de,6,3,"div",45),o()()),e&2){let p=C(2);t(4),b(m(5,3,"details.leaderboard.your_rank")),t(3),_("#",m(8,5,p.userRank())),t(2),f(p.showThankYou()?9:-1)}}function se(e,i){e&1&&(k(0,"div",3),r(1),c(2,"transloco")),e&2&&(t(),_(" ",m(2,1,"details.leaderboard.searching")," "))}function pe(e,i){e&1&&(r(0),c(1,"transloco")),e&2&&_(" ",m(1,1,"details.leaderboard.login_to_rate")," ")}function ce(e,i){e&1&&(r(0),c(1,"transloco")),e&2&&_(" ",m(1,1,"details.leaderboard.find_my_rank_button")," ")}function me(e,i){e&1&&r(0," \u{1F947} ")}function ue(e,i){e&1&&r(0," \u{1F948} ")}function _e(e,i){e&1&&r(0," \u{1F949} ")}function xe(e,i){if(e&1&&r(0),e&2){let p=C().$index;_(" ",p+1," ")}}function he(e,i){if(e&1&&(a(0,"div",33)(1,"div",47)(2,"span",48),h(3,me,1,0)(4,ue,1,0)(5,_e,1,0)(6,xe,1,1),o()(),a(7,"div",49)(8,"a",50),r(9),o()(),a(10,"div",47)(11,"span",51),r(12),c(13,"transloco"),o(),a(14,"span",52),r(15),c(16,"number"),o()()()),e&2){let p=i.$implicit,n=i.$index;t(2),R("rank-1",n===0)("rank-2",n===1)("rank-3",n===2),t(),f(n===0?3:n===1?4:n===2?5:6),t(5),P("routerLink",Y(16,te,p.id))("title",p.username),t(),_(" ",p.username," "),t(3),b(m(13,12,"details.leaderboard.kudos")),t(3),_(" ",m(16,14,p.kudos)," ")}}function fe(e,i){e&1&&(r(0),c(1,"transloco")),e&2&&_(" ",m(1,1,"details.leaderboard.read_less")," ")}function be(e,i){e&1&&(r(0),c(1,"transloco")),e&2&&_(" ",m(1,1,"details.leaderboard.read_more")," ")}function ge(e,i){if(e&1){let p=H();a(0,"div",13)(1,"div",14)(2,"div",15),T(),a(3,"svg",16),k(4,"path",17),o(),B(),a(5,"div")(6,"h3",18),r(7),c(8,"transloco"),o(),a(9,"p",19),r(10),c(11,"transloco"),o()()()(),a(12,"div",14)(13,"div",20)(14,"div",21)(15,"h3",22),r(16),c(17,"transloco"),o(),a(18,"p",23),r(19),c(20,"transloco"),o()(),h(21,le,10,7,"div",24),a(22,"div",25)(23,"button",26),c(24,"transloco"),I("click",function(){K(p);let u=C();return w(u.findMyRank())}),h(25,se,3,3)(26,pe,2,3)(27,ce,2,3),o()()()()(),a(28,"div",27)(29,"div",28)(30,"div",29)(31,"div",30)(32,"span",31),r(33),c(34,"transloco"),o(),a(35,"span",31),r(36),c(37,"transloco"),o(),a(38,"span",32),r(39),c(40,"transloco"),o()(),U(41,he,17,18,"div",33,ie),o(),a(43,"div",14)(44,"p",34),r(45),c(46,"transloco"),o()()(),a(47,"aside",35)(48,"div",24)(49,"h3",22),r(50),c(51,"transloco"),o(),a(52,"div",36)(53,"p"),r(54),c(55,"transloco"),o(),a(56,"p",37),r(57),c(58,"transloco"),o(),a(59,"button",38),I("click",function(){K(p);let u=C();return w(u.toggleKudosExplanation())}),h(60,fe,2,3)(61,be,2,3),o(),a(62,"p",39)(63,"a",40),r(64),c(65,"transloco"),o()()()()()()}if(e&2){let p=C();t(7),_(" ",m(8,21,"details.leaderboard.appreciation_title")," "),t(3),_(" ",m(11,23,"details.leaderboard.appreciation_message")," "),t(6),_(" ",m(17,25,"details.leaderboard.find_my_rank")," "),t(3),_(" ",m(20,27,"details.leaderboard.find_my_rank_description")," "),t(2),f(p.rankSearched()&&p.userRank()!==null?21:-1),t(2),R("btn-disabled",!p.isLoggedIn()),P("disabled",!p.isLoggedIn()||p.searchingRank())("title",p.isLoggedIn()?"":m(24,29,"details.leaderboard.login_to_rate")),t(2),f(p.searchingRank()?25:p.isLoggedIn()?27:26),t(8),b(m(34,31,"details.leaderboard.rank")),t(3),b(m(37,33,"details.leaderboard.username")),t(3),b(m(40,35,"details.leaderboard.kudos")),t(2),j(p.users()),t(4),_(" ",m(46,37,"details.leaderboard.footer_note")," "),t(5),_(" ",m(51,39,"details.leaderboard.what_kudos_represent")," "),t(4),b(m(55,41,"details.leaderboard.kudos_explanation_1")),t(2),R("is-expanded",p.kudosExplanationExpanded()),t(),_(" ",m(58,43,"details.leaderboard.kudos_explanation_2")," "),t(3),f(p.kudosExplanationExpanded()?60:61),t(4),_(" ",m(65,45,"details.leaderboard.learn_more_faq")," ")}}function ve(e,i){e&1&&(a(0,"div",7)(1,"p"),r(2),c(3,"transloco"),o()()),e&2&&(t(2),b(m(3,1,"details.leaderboard.no_users")))}var De=(()=>{let i=class i{toggleKudosExplanation(){this.kudosExplanationExpanded.update(n=>!n)}constructor(){this.title=L(N),this.translator=L(X),this.aiHorde=L(J),this.auth=L(Q),this.destroyRef=L(F),this.loading=g(!1),this.pagesLoaded=g(0),this.error=g(null),this.users=g([]),this.totalKudos=O(()=>this.users().reduce((n,u)=>n+u.kudos,0)),this.isLoggedIn=this.auth.isLoggedIn,this.currentUser=this.auth.currentUser,this.searchingRank=g(!1),this.userRank=g(null),this.rankSearched=g(!1),this.showThankYou=g(!1),this.kudosExplanationExpanded=g(!1),Z(()=>{this.loadLeaderboard()})}ngOnInit(){G([this.translator.get("details.leaderboard.title"),this.translator.get("app_title")]).pipe(A(this.destroyRef)).subscribe(([n,u])=>{this.title.setTitle(`${n} | ${u}`)})}loadLeaderboard(){this.loading.set(!0),this.error.set(null),this.users.set([]),this.pagesLoaded.set(0);let n=this.aiHorde.getKudosLeaderboard(1,25).pipe(y(d=>({page:1,users:d}))),u=this.aiHorde.getKudosLeaderboard(2,25).pipe(y(d=>({page:2,users:d}))),s=this.aiHorde.getKudosLeaderboard(3,25).pipe(y(d=>({page:3,users:d}))),x=this.aiHorde.getKudosLeaderboard(4,25).pipe(y(d=>({page:4,users:d})));M(n,u,s,x).pipe(A(this.destroyRef),V((d,v)=>(d.pages[v.page]=v.users,d.loadedCount++,d),{pages:{},loadedCount:0})).subscribe({next:d=>{let v=[];for(let l=1;l<=i.TOTAL_PAGES;l++)d.pages[l]&&v.push(...d.pages[l]);this.users.set(v),this.pagesLoaded.set(d.loadedCount),d.loadedCount>=i.TOTAL_PAGES&&this.loading.set(!1)},error:()=>{this.error.set("Failed to load kudos leaderboard"),this.loading.set(!1)}})}findMyRank(){return D(this,null,function*(){let n=this.currentUser();if(n){this.searchingRank.set(!0),this.userRank.set(null),this.rankSearched.set(!1),this.showThankYou.set(!1);try{let u=yield this.binarySearchRank(n.kudos,n.id);this.userRank.set(u),this.rankSearched.set(!0),this.showThankYou.set(!0)}catch{this.userRank.set(null),this.rankSearched.set(!0),this.showThankYou.set(!1)}finally{this.searchingRank.set(!1)}}})}binarySearchRank(n,u){return D(this,null,function*(){let s=1,x=1,d=yield E(this.aiHorde.getKudosLeaderboardPage(x));for(;d.length===i.PAGE_SIZE&&!(d[d.length-1].kudos<n);)s=x,x*=2,d=yield E(this.aiHorde.getKudosLeaderboardPage(x));for(;s<x;){let l=Math.floor((s+x)/2);if(d=yield E(this.aiHorde.getKudosLeaderboardPage(l)),d.length===0){x=l;continue}let S=d[0].kudos,ee=d[d.length-1].kudos;n>S?x=l:n<ee?s=l+1:(s=l,x=l)}d=yield E(this.aiHorde.getKudosLeaderboardPage(s));for(let l=0;l<d.length;l++)if(d[l].id===u)return(s-1)*i.PAGE_SIZE+l+1;if(s>1){let l=yield E(this.aiHorde.getKudosLeaderboardPage(s-1));for(let S=0;S<l.length;S++)if(l[S].id===u)return(s-2)*i.PAGE_SIZE+S+1}let v=yield E(this.aiHorde.getKudosLeaderboardPage(s+1));for(let l=0;l<v.length;l++)if(v[l].id===u)return s*i.PAGE_SIZE+l+1;for(let l=0;l<d.length;l++)if(d[l].kudos<=n)return(s-1)*i.PAGE_SIZE+l+1;return(s-1)*i.PAGE_SIZE+d.length+1})}formatKudos(n){return n>=1e9?(n/1e9).toFixed(1)+"B":n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toLocaleString()}};i.PAGE_SIZE=25,i.TOTAL_PAGES=4,i.\u0275fac=function(u){return new(u||i)},i.\u0275cmp=$({type:i,selectors:[["app-kudos-leaderboard"]],decls:11,vars:9,consts:[[1,"stack-lg"],[1,"details-tabs"],["type","button",1,"btn-source-control",3,"click","disabled"],["aria-hidden","true",1,"spinner","spinner-sm"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"icon-sm"],[1,"state-container","state-container-sm","state-error"],[1,"state-container","state-container-sm","text-secondary"],[1,"state-container","state-container-sm","state-muted"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"state-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"],["type","button",1,"btn-source-control",3,"click"],[1,"spinner","spinner-md"],[1,"leaderboard-top-cards"],[1,"card","card-bg-secondary"],[1,"flex","items-start","gap-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"icon-sm","text-brand-purple","shrink-0","mt-0.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"],[1,"font-semibold","text-primary"],[1,"text-secondary","text-sm","mt-1"],[1,"stack-sm"],[1,"text-center"],[1,"heading-card"],[1,"text-secondary","text-sm"],[1,"card","card-bg-primary"],[1,"flex","justify-center"],["type","button",1,"btn-primary",3,"click","disabled","title"],[1,"leaderboard-layout"],[1,"leaderboard-main"],[1,"models-table"],[1,"models-table-header","leaderboard-table-header"],[1,"models-table-th"],[1,"models-table-th","models-table-th-right"],[1,"models-table-row","leaderboard-table-row"],[1,"text-secondary","text-sm","text-center"],[1,"leaderboard-sidebar"],[1,"prose-content","text-sm"],[1,"kudos-explanation-more","mt-2"],["type","button",1,"kudos-read-more-btn",3,"click"],[1,"mt-2"],["routerLink","/faq","fragment","kudos",1,"link"],[1,"flex","flex-col","items-center","gap-3"],[1,"flex","flex-col","items-center","gap-1"],[1,"text-secondary","text-sm","font-medium"],[1,"text-5xl","font-bold","text-primary",2,"font-variant-numeric","tabular-nums"],[1,"flex","items-center","gap-2","text-brand-purple","text-sm","font-medium"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"icon-sm","shrink-0"],[1,"models-table-cell"],[1,"model-rank-badge"],[1,"models-table-cell-name"],[1,"models-table-name","link",3,"routerLink","title"],[1,"models-table-label"],[1,"models-table-value"]],template:function(u,s){u&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),I("click",function(){return s.loadLeaderboard()}),h(3,ne,1,0,"div",3)(4,ae,2,0,":svg:svg",4),r(5),c(6,"transloco"),o()(),h(7,oe,8,4,"div",5),h(8,re,5,3,"div",6),h(9,ge,66,47),h(10,ve,4,3,"div",7),o()),u&2&&(t(2),P("disabled",s.loading()),t(),f(s.loading()?3:4),t(2),_(" ",m(6,7,"details.leaderboard.refresh")," "),t(2),f(s.error()?7:-1),t(),f(s.loading()&&!s.error()?8:-1),t(),f(!s.loading()&&!s.error()&&s.users().length>0?9:-1),t(),f(!s.loading()&&!s.error()&&s.users().length===0?10:-1))},dependencies:[W,q,z],encapsulation:2,changeDetection:0});let e=i;return e})();export{De as KudosLeaderboardComponent};
