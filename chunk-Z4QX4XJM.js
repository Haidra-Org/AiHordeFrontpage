import{a as i,b as _}from"./chunk-T6V27EFK.js";import{a as f}from"./chunk-VFTR325L.js";import{g as m}from"./chunk-GZDNXZTC.js";import{A as n,P as c,S as p,X as o,ja as l,k as r,nc as g,q as d}from"./chunk-QF4LG6ZD.js";var K=(()=>{let a=class a{constructor(){this.database=o(_),this.aiHorde=o(f),this.httpClient=o(m),this.baseUrl="https://aihorde.net/api/v2",this._currentUser=l(null),this._isLoading=l(!1),this._isInitialized=l(!1),this.currentUser=this._currentUser.asReadonly(),this.isLoading=this._isLoading.asReadonly(),this.isLoggedIn=g(()=>this._currentUser()!==null),this.isInitialized=this._isInitialized.asReadonly(),this.initializeFromStorage()}initializeFromStorage(){let t=this.database.get("remember_api_key",!0),e=this.database.get("api_key",null,t?i.Permanent:i.Session);e?(this._isLoading.set(!0),this.aiHorde.getUserByApiKey(e).subscribe({next:s=>{this._currentUser.set(s),this._isLoading.set(!1),this._isInitialized.set(!0)},error:()=>{this._isLoading.set(!1),this._isInitialized.set(!0)}})):this._isInitialized.set(!0)}login(t,e=!1){return this._isLoading.set(!0),this.aiHorde.getUserByApiKey(t).pipe(c(s=>{s&&(this.database.store("remember_api_key",e),this.database.store("api_key",t,e?i.Permanent:i.Session),this._currentUser.set(s)),this._isLoading.set(!1)}),n(()=>(this._isLoading.set(!1),r(null))))}logout(){this._currentUser.set(null),this.database.store("api_key","",i.Permanent),this.database.store("api_key","",i.Session)}refreshUser(){let t=this.database.get("remember_api_key",!0),e=this.database.get("api_key",null,t?i.Permanent:i.Session);return e?(this._isLoading.set(!0),this.aiHorde.getUserByApiKey(e).pipe(c(s=>{this._currentUser.set(s),this._isLoading.set(!1)}),n(()=>(this._isLoading.set(!1),r(null))))):r(null)}getStoredApiKey(){let t=this.database.get("remember_api_key",!0);return this.database.get("api_key",null,t?i.Permanent:i.Session)}deleteUser(){let t=this.getStoredApiKey(),e=this._currentUser();return!t||!e?r({success:!1,error:{message:"Not logged in"}}):this.httpClient.delete(`${this.baseUrl}/users/${e.id}`,{headers:{apikey:t}}).pipe(d(s=>({success:!0,data:s})),n(s=>{let u=s.error?.message??s.error?.detail??"Failed to delete account";return r({success:!1,error:{message:u,rc:s.error?.rc}})}))}undeleteUser(){let t=this.getStoredApiKey(),e=this._currentUser();return!t||!e?r({success:!1,error:"Not logged in"}):this.httpClient.put(`${this.baseUrl}/users/${e.id}`,{undelete:!0},{headers:{apikey:t}}).pipe(d(()=>({success:!0})),n(s=>{let u=s.error?.message??s.error?.detail??"Failed to restore account";return r({success:!1,error:u})}))}};a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=p({token:a,factory:a.\u0275fac,providedIn:"root"});let h=a;return h})();export{K as a};
