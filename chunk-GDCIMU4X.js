import{a as te}from"./chunk-ZPGUFHCW.js";import{a as Z,b as ee}from"./chunk-BV2EP4TL.js";import{a as ie}from"./chunk-CRVG2NOB.js";import{e as J}from"./chunk-3B2Y74WR.js";import{a as K}from"./chunk-YL3TDIGQ.js";import{c as Q,d as Y}from"./chunk-MXBDCOJX.js";import{k as U}from"./chunk-BPDV6QKT.js";import{Cb as w,Db as m,Oa as i,Qb as q,Rb as l,Sb as x,Tb as _,Ub as L,X as M,Za as H,aa as g,ba as f,ca as T,cc as X,da as $,dc as S,ga as j,gc as s,hc as c,ic as y,ja as E,nb as A,ob as C,pb as u,qb as z,qc as F,rb as D,rc as B,sb as O,tb as k,ub as o,vb as r,wb as h,zb as v}from"./chunk-4EEEF725.js";var W=e=>({name:e}),ne=e=>["/admin/users",e],oe=e=>["/details/workers/owner",e],re=e=>["/details/teams",e],ae=()=>[],le=(e,d)=>d.id,de=(e,d)=>d.message;function se(e,d){e&1&&(o(0,"div",0),T(),o(1,"svg",34),h(2,"path",35),r(),$(),o(3,"span"),l(4),s(5,"transloco"),r()()),e&2&&(i(4),x(c(5,1,"admin.workers.success")))}function pe(e,d){if(e&1&&(o(0,"li",47)(1,"a",48),l(2),r()()),e&2){let t=d.$implicit,n=m(5);i(),k("routerLink",n.getModelLink(t)),i(),x(t)}}function ce(e,d){if(e&1&&(o(0,"ul",46),D(1,pe,3,2,"li",47,z),r()),e&2){let t=m(4);i(),O(t.getFilteredModels())}}function me(e,d){e&1&&(o(0,"p",40),l(1),s(2,"transloco"),r()),e&2&&(i(),_(" ",c(2,1,"admin.workers.dialog.no_models_match")," "))}function _e(e,d){if(e&1){let t=v();o(0,"div",43)(1,"input",44),s(2,"transloco"),w("input",function(a){g(t);let p=m(3);return f(p.onModelSearchChange(a))}),r()(),o(3,"div",45),C(4,ce,3,0,"ul",46)(5,me,3,3,"p",40),r()}if(e&2){let t=m(3);i(),k("value",t.modelSearch())("placeholder",c(2,3,"admin.workers.dialog.search_models")),i(3),u(t.getFilteredModels().length>0?4:5)}}function Ce(e,d){e&1&&(o(0,"p",40),l(1),s(2,"transloco"),r()),e&2&&(i(),_(" ",c(2,1,"admin.common.none")," "))}function ue(e,d){if(e&1){let t=v();o(0,"h3",38),l(1),s(2,"transloco"),o(3,"span",39),l(4),r()(),C(5,_e,6,5)(6,Ce,3,3,"p",40),o(7,"div",41)(8,"button",42),w("click",function(){g(t);let a=m(2);return f(a.closeDialog())}),l(9),s(10,"transloco"),r()()}if(e&2){let t=m(2);i(),_(" ",y(2,4,"admin.workers.dialog.models_title",S(9,W,t.worker().name))," "),i(3),_("(",t.getSortedModels().length,")"),i(),u(t.getSortedModels().length>0?5:6),i(4),_(" ",c(10,7,"admin.workers.dialog.close")," ")}}function ke(e,d){if(e&1&&(l(0),s(1,"transloco")),e&2){let t=m(3);_(" ",y(1,1,"admin.workers.dialog.unset_maintenance_title",S(4,W,t.worker().name))," ")}}function xe(e,d){if(e&1&&(l(0),s(1,"transloco")),e&2){let t=m(3);_(" ",y(1,1,"admin.workers.dialog.set_maintenance_title",S(4,W,t.worker().name))," ")}}function we(e,d){if(e&1){let t=v();o(0,"div",43)(1,"label",52),l(2),s(3,"transloco"),r(),o(4,"textarea",53),w("input",function(a){g(t);let p=m(3);return f(p.onMaintenanceReasonChange(a))}),r()()}if(e&2){let t=m(3);i(2),_(" ",c(3,2,"admin.workers.dialog.maintenance_reason")," "),i(2),k("value",t.maintenanceReason())}}function ge(e,d){if(e&1){let t=v();o(0,"h3",38),C(1,ke,2,6)(2,xe,2,6),r(),C(3,we,5,4,"div",43),o(4,"div",49)(5,"button",50),w("click",function(){g(t);let a=m(2);return f(a.closeDialog())}),l(6),s(7,"transloco"),r(),o(8,"button",51),w("click",function(){g(t);let a=m(2);return f(a.confirmMaintenance())}),l(9),s(10,"transloco"),r()()}if(e&2){let t=m(2);i(),u(t.worker().maintenance_mode?1:2),i(2),u(t.worker().maintenance_mode?-1:3),i(3),_(" ",c(7,5,"admin.workers.dialog.cancel")," "),i(2),k("disabled",t.isUpdating()),i(),_(" ",c(10,7,"admin.workers.dialog.confirm")," ")}}function fe(e,d){if(e&1&&(l(0),s(1,"transloco")),e&2){let t=m(3);_(" ",y(1,1,"admin.workers.dialog.unset_paused_title",S(4,W,t.worker().name))," ")}}function ve(e,d){if(e&1&&(l(0),s(1,"transloco")),e&2){let t=m(3);_(" ",y(1,1,"admin.workers.dialog.set_paused_title",S(4,W,t.worker().name))," ")}}function he(e,d){if(e&1){let t=v();o(0,"h3",38),C(1,fe,2,6)(2,ve,2,6),r(),o(3,"div",49)(4,"button",50),w("click",function(){g(t);let a=m(2);return f(a.closeDialog())}),l(5),s(6,"transloco"),r(),o(7,"button",54),w("click",function(){g(t);let a=m(2);return f(a.confirmPause())}),l(8),s(9,"transloco"),r()()}if(e&2){let t=m(2);i(),u(t.worker().paused?1:2),i(4),_(" ",c(6,4,"admin.workers.dialog.cancel")," "),i(2),k("disabled",t.isUpdating()),i(),_(" ",c(9,6,"admin.workers.dialog.confirm")," ")}}function Se(e,d){e&1&&(o(0,"div",56)(1,"p",61),l(2),s(3,"transloco"),r()()),e&2&&(i(2),_(" ",c(3,1,"admin.workers.dialog.delete_error")," "))}function be(e,d){if(e&1){let t=v();o(0,"h3",38),l(1),s(2,"transloco"),r(),o(3,"div",55)(4,"div",56)(5,"p",57),l(6),s(7,"transloco"),r()(),o(8,"div",58)(9,"p",59),l(10),s(11,"transloco"),r()(),C(12,Se,4,3,"div",56),r(),o(13,"div",49)(14,"button",50),w("click",function(){g(t);let a=m(2);return f(a.closeDialog())}),l(15),s(16,"transloco"),r(),o(17,"button",60),w("click",function(){g(t);let a=m(2);return f(a.confirmDelete())}),l(18),s(19,"transloco"),r()()}if(e&2){let t=m(2);i(),_(" ",y(2,7,"admin.workers.dialog.delete_title",S(18,W,t.worker().name))," "),i(5),_(" ",c(7,10,"admin.workers.dialog.delete_warning_permanent")," "),i(4),_(" ",c(11,12,"admin.workers.dialog.delete_warning_offline_requirement")," "),i(2),u(t.deleteError()?12:-1),i(3),_(" ",c(16,14,"admin.workers.dialog.cancel")," "),i(2),k("disabled",t.isUpdating()),i(),_(" ",c(19,16,"admin.workers.dialog.delete_confirm")," ")}}function Te(e,d){if(e&1&&(o(0,"option",65),l(1),r()),e&2){let t=d.$implicit;k("value",t.id),i(),x(t.name)}}function Ee(e,d){if(e&1){let t=v();o(0,"h3",38),l(1),s(2,"transloco"),r(),o(3,"div",43)(4,"label",62),l(5),s(6,"transloco"),r(),o(7,"select",63),w("change",function(a){g(t);let p=m(2);return f(p.onTeamSelectChange(a))}),o(8,"option",64),l(9),s(10,"transloco"),r(),D(11,Te,2,2,"option",65,le),r(),o(13,"p",66),l(14),s(15,"transloco"),r()(),o(16,"div",49)(17,"button",50),w("click",function(){g(t);let a=m(2);return f(a.closeDialog())}),l(18),s(19,"transloco"),r(),o(20,"button",67),w("click",function(){g(t);let a=m(2);return f(a.confirmTeamChange())}),l(21),s(22,"transloco"),r()()}if(e&2){let t=m(2);i(),_(" ",y(2,8,"admin.workers.dialog.team_title",S(21,W,t.worker().name))," "),i(4),_(" ",c(6,11,"admin.workers.dialog.team_select")," "),i(2),k("value",t.selectedTeamId()),i(2),x(c(10,13,"admin.workers.dialog.no_team")),i(2),O(t.availableTeams()),i(3),_(" ",c(15,15,"admin.workers.dialog.team_hint")," "),i(4),_(" ",c(19,17,"admin.workers.dialog.cancel")," "),i(2),k("disabled",t.isUpdating()),i(),_(" ",c(22,19,"admin.workers.dialog.confirm")," ")}}function ye(e,d){if(e&1){let t=v();o(0,"div",1)(1,"div",36),w("click",function(){g(t);let a=m();return f(a.closeDialog())}),r(),o(2,"div",37),C(3,ue,11,11)(4,ge,11,9)(5,he,10,8)(6,be,20,20)(7,Ee,23,23),r()()}if(e&2){let t,n=m();i(3),u((t=n.dialogType())==="models"?3:t==="maintenance"?4:t==="pause"?5:t==="delete"?6:t==="team"?7:-1)}}function Ie(e,d){e&1&&(o(0,"div",5),s(1,"transloco"),T(),o(2,"svg",34),h(3,"path",35),r()()),e&2&&k("title",c(1,1,"admin.workers.card.online"))}function We(e,d){e&1&&(o(0,"div",6),s(1,"transloco"),T(),o(2,"svg",34),h(3,"path",68),r()()),e&2&&k("title",c(1,1,"admin.workers.card.issue"))}function Be(e,d){e&1&&(o(0,"span",10),l(1),s(2,"transloco"),r()),e&2&&(i(),x(c(2,1,"admin.workers.type.image")))}function Ve(e,d){e&1&&(o(0,"span",11),l(1),s(2,"transloco"),r()),e&2&&(i(),x(c(2,1,"admin.workers.type.text")))}function Me(e,d){e&1&&(o(0,"span",12),l(1),s(2,"transloco"),r()),e&2&&(i(),x(c(2,1,"admin.workers.type.interrogation")))}function Ue(e,d){if(e&1){let t=v();o(0,"button",69),s(1,"transloco"),w("click",function(a){return g(t),m().onClearHighlight(),f(a.stopPropagation())}),l(2),s(3,"transloco"),o(4,"span",70),l(5,"\xD7"),r()()}e&2&&(A("aria-label",c(1,2,"details.common.clear_highlight")),i(2),_(" ",c(3,4,"details.common.highlighted")," "))}function De(e,d){e&1&&(o(0,"div",16),s(1,"transloco"),T(),o(2,"svg",71),h(3,"path",72),r()()),e&2&&k("title",c(1,1,"admin.workers.card.low_speed_warning"))}function Oe(e,d){e&1&&(o(0,"div",16),s(1,"transloco"),T(),o(2,"svg",73),h(3,"path",72),r()()),e&2&&k("title",c(1,1,"admin.workers.card.high_speed_warning"))}function Fe(e,d){e&1&&(o(0,"div",16),s(1,"transloco"),T(),o(2,"svg",74),h(3,"path",75),r()()),e&2&&k("title",c(1,1,"admin.workers.card.paused"))}function Le(e,d){e&1&&(o(0,"div",16),s(1,"transloco"),T(),o(2,"svg",74),h(3,"path",76),r()()),e&2&&k("title",c(1,1,"admin.workers.card.maintenance"))}function Ne(e,d){e&1&&(o(0,"div",16),s(1,"transloco"),T(),o(2,"svg",74),h(3,"path",77),r()()),e&2&&k("title",c(1,1,"admin.workers.card.flagged"))}function Pe(e,d){e&1&&(o(0,"div",16),s(1,"transloco"),T(),o(2,"svg",78),h(3,"path",79),r()()),e&2&&k("title",c(1,1,"admin.workers.card.trusted"))}function Ge(e,d){e&1&&(o(0,"span",20),l(1),s(2,"transloco"),r()),e&2&&(i(),_("",c(2,1,"admin.workers.card.owner"),":"))}function Re(e,d){if(e&1&&(o(0,"a",21),l(1),r()),e&2){let t=m();k("routerLink",S(3,ne,t.getOwnerUserId()))("title",t.worker().owner),i(),x(t.getOwnerDisplayName())}}function $e(e,d){if(e&1&&(o(0,"a",21),l(1),r()),e&2){let t=m();k("routerLink",S(3,oe,t.getOwnerUserId()))("title",t.worker().owner),i(),x(t.getOwnerDisplayName())}}function je(e,d){if(e&1&&(o(0,"span",22),l(1),r()),e&2){let t=m();k("title",t.worker().owner??""),i(),x(t.getOwnerDisplayName())}}function He(e,d){if(e&1&&(o(0,"a",21),l(1),r()),e&2){let t,n,a=m(2);k("routerLink",S(3,re,a.worker().team.id))("title",((t=a.worker().team)==null?null:t.name)??((t=a.worker().team)==null?null:t.id)??""),i(),x(((n=a.worker().team)==null?null:n.name)??((n=a.worker().team)==null?null:n.id)??"")}}function Ae(e,d){if(e&1&&(o(0,"span",80),l(1),r()),e&2){let t,n,a=m(2);k("title",((t=a.worker().team)==null?null:t.name)??((t=a.worker().team)==null?null:t.id)??""),i(),x(((n=a.worker().team)==null?null:n.name)??((n=a.worker().team)==null?null:n.id)??"")}}function ze(e,d){if(e&1&&(o(0,"div",19)(1,"span",20),l(2),s(3,"transloco"),r(),C(4,He,2,5,"a",21)(5,Ae,2,2,"span",80),r()),e&2){let t,n=m();i(2),_("",c(3,2,"admin.workers.card.team"),":"),i(2),u((t=n.worker().team)!=null&&t.id?4:5)}}function qe(e,d){if(e&1&&(o(0,"span",22),l(1),r()),e&2){let t=d,n=m();k("title",n.worker().bridge_agent),i(),L("",t.name," v",t.version)}}function Xe(e,d){if(e&1&&(o(0,"span",22),l(1),r()),e&2){let t=m();k("title",t.worker().bridge_agent),i(),x(t.worker().bridge_agent)}}function Je(e,d){e&1&&(o(0,"div",23)(1,"span",20),l(2),s(3,"transloco"),r(),o(4,"span",81),l(5),r()()),e&2&&(i(2),_("",c(3,2,"admin.workers.card.software_contact"),":"),i(3),x(d.contact))}function Ke(e,d){if(e&1&&(o(0,"div",23)(1,"span",20),l(2),s(3,"transloco"),r(),o(4,"span",81),l(5),r()()),e&2){let t=m();i(2),_("",c(3,2,"admin.workers.card.contact"),":"),i(3),x(t.worker().contact)}}function Qe(e,d){if(e&1&&(o(0,"div",19)(1,"span",20),l(2),s(3,"transloco"),r(),o(4,"span",82),l(5),r()()),e&2){let t=m();i(2),_("",c(3,2,"admin.workers.card.ipaddr"),":"),i(3),x(t.worker().ipaddr)}}function Ye(e,d){if(e&1&&(o(0,"span",25),l(1),h(2,"app-unit-tooltip",83),r()),e&2){let t=d;i(),_(" ",t.primary.value.toFixed(2)," "),i(),k("unit",t)("primaryOverride",t.primary.unit)}}function Ze(e,d){if(e&1&&(o(0,"span",25),l(1),r()),e&2){let t=m();i(),x(t.worker().performance)}}function et(e,d){if(e&1&&(o(0,"span",25),l(1),h(2,"app-unit-tooltip",83),r()),e&2){let t=d;i(),_(" ",t.primary.value.toFixed(1)," "),i(),k("unit",t)("primaryOverride",t.primary.prefix+t.primary.unit)}}function tt(e,d){if(e&1&&(o(0,"span",25),l(1),s(2,"formatNumber"),r()),e&2){let t=m(2);i(),x(c(2,1,t.worker().megapixelsteps_generated??0))}}function it(e,d){if(e&1&&(o(0,"div",19)(1,"span",20),l(2),s(3,"transloco"),r(),C(4,et,3,3,"span",25)(5,tt,3,3,"span",25),r()),e&2){let t,n=m();i(2),_("",c(3,2,"admin.workers.card.mps_generated"),":"),i(2),u((t=n.getMpsGeneratedUnit())?4:5,t)}}function nt(e,d){if(e&1&&(o(0,"span",25),l(1),h(2,"app-unit-tooltip",83),r()),e&2){let t=d;i(),_(" ",t.primary.value.toFixed(1)," "),i(),k("unit",t)("primaryOverride",t.primary.prefix+t.primary.unit)}}function ot(e,d){if(e&1&&(o(0,"span",25),l(1),s(2,"formatNumber"),r()),e&2){let t=m(2);i(),x(c(2,1,t.worker().tokens_generated??0))}}function rt(e,d){if(e&1&&(o(0,"div",19)(1,"span",20),l(2),s(3,"transloco"),r(),C(4,nt,3,3,"span",25)(5,ot,3,3,"span",25),r()),e&2){let t,n=m();i(2),_("",c(3,2,"admin.workers.card.tokens_generated"),":"),i(2),u((t=n.getTokensGeneratedUnit())?4:5,t)}}function at(e,d){if(e&1&&(o(0,"div",23)(1,"span",20),l(2),s(3,"transloco"),r(),o(4,"span",84),l(5),r()()),e&2){let t=m(2);i(2),_("",c(3,2,"admin.workers.card.model_loaded"),":"),i(3),x(t.worker().models[0])}}function lt(e,d){if(e&1&&(o(0,"div",19)(1,"span",20),l(2),s(3,"transloco"),r(),o(4,"span",25),l(5),r()()),e&2){let t,n=m(2);i(2),_("",c(3,2,"admin.workers.card.models_loaded"),":"),i(3),x(((t=n.worker().models)==null?null:t.length)??0)}}function dt(e,d){if(e&1&&C(0,at,6,4,"div",23)(1,lt,6,4,"div",19),e&2){let t,n=m();u((((t=n.worker().models)==null?null:t.length)??0)===1?0:1)}}function st(e,d){if(e&1&&(o(0,"div",19)(1,"span",20),l(2),s(3,"transloco"),r(),o(4,"span",25),l(5),r()()),e&2){let t,n=m();i(2),_("",c(3,2,"admin.workers.card.forms"),":"),i(3),x(((t=n.worker().forms)==null?null:t.join(", "))??"")}}function pt(e,d){e&1&&(o(0,"span",87),l(1,"img2img"),r())}function ct(e,d){e&1&&(o(0,"span",87),l(1,"inpainting"),r())}function mt(e,d){e&1&&(o(0,"span",87),l(1,"post-processing"),r())}function _t(e,d){e&1&&(o(0,"span",87),l(1,"LoRA"),r())}function Ct(e,d){e&1&&(o(0,"span",87),l(1,"ControlNet"),r())}function ut(e,d){e&1&&(o(0,"span",87),l(1,"SDXL ControlNet"),r())}function kt(e,d){if(e&1&&(o(0,"div",27)(1,"span",85),l(2),s(3,"transloco"),r(),o(4,"div",86),C(5,pt,2,0,"span",87),C(6,ct,2,0,"span",87),C(7,mt,2,0,"span",87),C(8,_t,2,0,"span",87),C(9,Ct,2,0,"span",87),C(10,ut,2,0,"span",87),r()()),e&2){let t=m();i(2),_("",c(3,7,"admin.workers.card.capabilities"),":"),i(3),u(t.worker().img2img?5:-1),i(),u(t.worker().painting?6:-1),i(),u(t.worker()["post-processing"]?7:-1),i(),u(t.worker().lora?8:-1),i(),u(t.worker().controlnet?9:-1),i(),u(t.worker().sdxl_controlnet?10:-1)}}function xt(e,d){if(e&1&&(o(0,"span",90),l(1),r()),e&2){let t=m().$implicit;i(),_("(",t.origin,")")}}function wt(e,d){if(e&1&&(o(0,"div",89)(1,"span",25),l(2),r(),C(3,xt,2,1,"span",90),r()),e&2){let t=d.$implicit;i(2),x(t.message),i(),u(t.origin?3:-1)}}function gt(e,d){if(e&1&&(o(0,"div",27)(1,"span",85),l(2),s(3,"transloco"),r(),o(4,"div",88),D(5,wt,4,2,"div",89,de),r()()),e&2){let t,n=m();i(2),L("",c(3,2,"admin.workers.card.messages")," (",((t=n.worker().messages)==null?null:t.length)??0,"):"),i(3),O(n.worker().messages??X(4,ae))}}function ft(e,d){if(e&1){let t=v();o(0,"button",91),s(1,"transloco"),w("click",function(){g(t);let a=m();return f(a.openTeamDialog())}),l(2),s(3,"transloco"),r()}e&2&&(k("title",c(1,2,"admin.workers.action.change_team")),i(2),_(" ",c(3,4,"admin.workers.button.team")," "))}function vt(e,d){e&1&&(l(0),s(1,"transloco")),e&2&&_(" ",c(1,1,"admin.workers.button.disable_maintenance")," ")}function ht(e,d){e&1&&(l(0),s(1,"transloco")),e&2&&_(" ",c(1,1,"admin.workers.button.maintenance")," ")}function St(e,d){if(e&1){let t=v();o(0,"button",92),s(1,"transloco"),w("click",function(){g(t);let a=m();return f(a.openMaintenanceDialog())}),C(2,vt,2,3)(3,ht,2,3),r()}if(e&2){let t=m();k("title",c(1,2,"admin.workers.button.maintenance_tooltip")),i(2),u(t.worker().maintenance_mode?2:3)}}function bt(e,d){e&1&&(l(0),s(1,"transloco")),e&2&&_(" ",c(1,1,"admin.workers.button.unpause")," ")}function Tt(e,d){e&1&&(l(0),s(1,"transloco")),e&2&&_(" ",c(1,1,"admin.workers.button.pause")," ")}function Et(e,d){if(e&1){let t=v();o(0,"button",93),s(1,"transloco"),s(2,"transloco"),w("click",function(){g(t);let a=m();return f(a.openPauseDialog())}),C(3,bt,2,3)(4,Tt,2,3),r()}if(e&2){let t=m();k("title",t.worker().paused?c(1,2,"admin.workers.action.unset_paused"):c(2,4,"admin.workers.action.set_paused")),i(3),u(t.worker().paused?3:4)}}function yt(e,d){if(e&1){let t=v();o(0,"button",94),s(1,"transloco"),w("click",function(){g(t);let a=m();return f(a.openDeleteDialog())}),l(2),s(3,"transloco"),r()}e&2&&(k("title",c(1,2,"admin.workers.action.delete")),i(2),_(" ",c(3,4,"admin.workers.button.delete")," "))}var Gt=(()=>{let d=class d{constructor(){this.workerService=M(te),this.destroyRef=M(j),this.auth=M(K),this.unitConversion=M(ee),this.worker=B.required(),this.isModerator=B(!1),this.viewMode=B("admin"),this.availableTeams=B([]),this.highlighted=B(!1),this.workerUpdated=F(),this.workerDeleted=F(),this.clearHighlight=F(),this.dialogOpen=E(!1),this.dialogType=E("models"),this.maintenanceReason=E(""),this.modelSearch=E(""),this.isUpdating=E(!1),this.showSuccess=E(!1),this.deleteError=E(null),this.selectedTeamId=E("")}get isUserModerator(){return this.auth.currentUser()?.moderator??!1}getOwnerUserId(){let n=this.worker().owner;if(!n)return null;let a=n.match(/#(\d+)$/);return a?a[1]:null}isOwnedByCurrentUser(){let n=this.auth.currentUser();if(!n)return!1;let a=this.worker().id;if(n.worker_ids?.includes(a))return!0;let p=this.getOwnerUserId();return!!p&&p===`${n.id}`}canToggleMaintenance(){return this.isOwnedByCurrentUser()||this.isModerator()}canTogglePause(){return this.viewMode()==="admin"&&this.isUserModerator}canDelete(){return this.isOwnedByCurrentUser()||this.isModerator()}canChangeTeam(){return this.isOwnedByCurrentUser()||this.isModerator()}hasOwnerName(){return!!this.worker().owner}getOwnerDisplayName(){return this.worker().owner??"Unknown"}getModelType(){return this.worker().type==="text"?"text":"image"}getModelLink(n){return["/details/models",this.getModelType(),n]}isHighSpeed(){return this.worker().type==="image"?parseFloat(this.worker().performance)>3:!1}isLowSpeed(){return this.worker().type==="image"?parseFloat(this.worker().performance)<.4:!1}hasIssue(){let n=this.worker();return!n.online||n.paused||n.maintenance_mode||n.flagged}hasImageCapabilities(){let n=this.worker();return!!(n.img2img||n.painting||n["post-processing"]||n.lora||n.controlnet||n.sdxl_controlnet)}getCardBackground(){let n=this.worker(),a="";return n.maintenance_mode||n.paused||n.flagged?a="worker-card-issue":a="worker-card-normal",this.highlighted()&&(a+=" worker-card-highlighted"),a}onClearHighlight(){this.clearHighlight.emit()}formatUptime(n){let a=Math.floor(n/86400),p=Math.floor(n%86400/3600),b=Math.floor(n%3600/60);return a>0?`${a}d ${p}h`:p>0?`${p}h ${b}m`:`${b}m`}truncateName(n,a=30){return n.length>a?n.substring(0,a)+"...":n}getParsedBridgeAgent(){let n=this.worker().bridge_agent;if(!n)return null;let a=n.indexOf(":");if(a===-1)return null;let p=n.indexOf(":",a+1);if(p===-1)return null;let b=n.substring(0,a),I=n.substring(a+1,p),V=n.substring(p+1);return!b||!I||!V?null:{name:b,version:I,contact:V}}getSortedModels(){return[...this.worker().models??[]].sort((n,a)=>n.toLowerCase().localeCompare(a.toLowerCase()))}getFilteredModels(){let n=this.modelSearch().toLowerCase().trim();return n?this.getSortedModels().filter(a=>a.toLowerCase().includes(n)):this.getSortedModels()}onModelSearchChange(n){let a=n.target;this.modelSearch.set(a.value)}openModelsDialog(){this.dialogType.set("models"),this.modelSearch.set(""),this.dialogOpen.set(!0)}openMaintenanceDialog(){this.dialogType.set("maintenance"),this.maintenanceReason.set(""),this.dialogOpen.set(!0)}openPauseDialog(){this.dialogType.set("pause"),this.dialogOpen.set(!0)}closeDialog(){this.dialogOpen.set(!1)}onMaintenanceReasonChange(n){let a=n.target;this.maintenanceReason.set(a.value)}confirmMaintenance(){this.isUpdating.set(!0);let n=!this.worker().maintenance_mode;this.workerService.setMaintenance(this.worker().id,n,this.maintenanceReason()).pipe(U(this.destroyRef)).subscribe(a=>{this.isUpdating.set(!1),a&&(this.showSuccess.set(!0),setTimeout(()=>this.showSuccess.set(!1),3e3),this.workerUpdated.emit()),this.closeDialog()})}confirmPause(){this.isUpdating.set(!0);let n=!this.worker().paused;this.workerService.setPaused(this.worker().id,n).pipe(U(this.destroyRef)).subscribe(a=>{this.isUpdating.set(!1),a&&(this.showSuccess.set(!0),setTimeout(()=>this.showSuccess.set(!1),3e3),this.workerUpdated.emit()),this.closeDialog()})}openDeleteDialog(){this.dialogType.set("delete"),this.deleteError.set(null),this.dialogOpen.set(!0)}confirmDelete(){this.isUpdating.set(!0),this.deleteError.set(null),this.workerService.deleteWorker(this.worker().id).pipe(U(this.destroyRef)).subscribe(n=>{this.isUpdating.set(!1),n?(this.workerDeleted.emit(this.worker().id),this.closeDialog()):this.deleteError.set("delete_failed")})}getPerformanceUnit(){let n=this.worker(),a=parseFloat(n.performance);return isNaN(a)||a===0?null:n.type==="image"?this.unitConversion.formatWorkerPerformanceImage(a):n.type==="text"?this.unitConversion.formatWorkerPerformanceText(a):null}getMpsGeneratedUnit(){let n=this.worker();return n.type!=="image"||n.megapixelsteps_generated===void 0?null:this.unitConversion.formatWorkerMegapixelstepsGenerated(n.megapixelsteps_generated)}getTokensGeneratedUnit(){let n=this.worker();return n.type!=="text"||n.tokens_generated===void 0?null:this.unitConversion.formatWorkerTokensGenerated(n.tokens_generated)}openTeamDialog(){this.canChangeTeam()&&(this.dialogType.set("team"),this.selectedTeamId.set(this.worker().team?.id??""),this.dialogOpen.set(!0))}onTeamSelectChange(n){let a=n.target;this.selectedTeamId.set(a.value)}confirmTeamChange(){this.isUpdating.set(!0);let n=this.selectedTeamId();this.workerService.updateWorker(this.worker().id,{team:n}).pipe(U(this.destroyRef)).subscribe(a=>{this.isUpdating.set(!1),a&&(this.showSuccess.set(!0),setTimeout(()=>this.showSuccess.set(!1),3e3),this.workerUpdated.emit()),this.closeDialog()})}};d.\u0275fac=function(a){return new(a||d)},d.\u0275cmp=H({type:d,selectors:[["app-worker-card"]],inputs:{worker:[1,"worker"],isModerator:[1,"isModerator"],viewMode:[1,"viewMode"],availableTeams:[1,"availableTeams"],highlighted:[1,"highlighted"]},outputs:{workerUpdated:"workerUpdated",workerDeleted:"workerDeleted",clearHighlight:"clearHighlight"},decls:92,vars:68,consts:[[1,"toast","toast-success"],[1,"worker-modal-overlay"],[1,"p-4"],[1,"flex","items-start","justify-between"],[1,"flex","items-center","gap-3"],[1,"worker-status-icon","worker-status-icon-success",3,"title"],[1,"worker-status-icon","worker-status-icon-error",3,"title"],[1,"min-w-0"],[1,"flex","items-center","gap-2","mb-1"],[1,"heading-item","truncate",3,"title"],[1,"badge-base","badge-info"],[1,"badge-base","badge-success"],[1,"badge-base","badge-purple"],["type","button",1,"badge-base","badge-warning","badge-dismissible"],[1,"text-xs","text-secondary","truncate"],[1,"flex","items-center","gap-1","shrink-0"],[1,"p-1",3,"title"],[1,"p-4","text-sm","worker-card-section"],[1,"space-y-1","mb-3"],[1,"worker-card-row"],[1,"worker-card-label"],[1,"worker-link","truncate",3,"routerLink","title"],[1,"worker-card-value",3,"title"],[1,"flex","flex-col"],[1,"space-y-1","mb-3","pt-3","border-t","border-gray-200","dark:border-gray-700"],[1,"worker-card-value"],[1,"space-y-1","pt-3","border-t","border-gray-200","dark:border-gray-700"],[1,"mt-3","pt-3","worker-card-section"],[1,"px-4","py-3","worker-card-section","flex","gap-2","flex-wrap"],[1,"worker-btn-models","text-sm",3,"click","title"],[1,"worker-btn","text-sm",3,"title"],[1,"worker-btn-maintenance","text-sm",3,"title"],[1,"worker-btn-pause","text-sm",3,"title"],[1,"btn-danger","text-sm",3,"title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"modal-backdrop",3,"click"],[1,"worker-modal-panel","worker-modal-panel-large"],[1,"heading-card","mb-4"],[1,"text-secondary","text-sm","font-normal","ml-2"],[1,"text-secondary","text-sm"],[1,"flex","justify-end","mt-6"],[1,"worker-btn-models",3,"click"],[1,"mb-4"],["type","text",1,"form-input",3,"input","value","placeholder"],[1,"worker-modal-scroll"],[1,"worker-models-list"],[1,"worker-models-list-item"],[1,"worker-link",3,"routerLink"],[1,"flex","justify-end","gap-3"],[1,"worker-btn",3,"click"],[1,"worker-btn-maintenance",3,"click","disabled"],[1,"text-sm","text-secondary","mb-2","block"],["rows","3",1,"form-input",3,"input","value"],[1,"worker-btn-pause",3,"click","disabled"],[1,"mb-4","space-y-3"],[1,"p-3","rounded-lg","bg-red-100","dark:bg-red-900/30","border","border-red-300","dark:border-red-700"],[1,"text-sm","text-red-800","dark:text-red-200","font-medium"],[1,"p-3","rounded-lg","bg-amber-100","dark:bg-amber-900/30","border","border-amber-300","dark:border-amber-700"],[1,"text-sm","text-amber-800","dark:text-amber-200"],[1,"btn-danger",3,"click","disabled"],[1,"text-sm","text-red-800","dark:text-red-200"],["for","team-select",1,"form-label"],["id","team-select",1,"form-input",3,"change","value"],["value",""],[3,"value"],[1,"text-xs","text-secondary","mt-2"],[1,"btn-primary",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"],["type","button",1,"badge-base","badge-warning","badge-dismissible",3,"click"],["aria-hidden","true"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","worker-indicator-yellow",2,"transform","scaleX(-1)"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 10V3L4 14h7v7l9-11h-7z"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","worker-indicator-yellow"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","worker-indicator-red"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","worker-indicator-green"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"],[1,"worker-card-value","truncate",3,"title"],[1,"worker-card-value","break-all"],[1,"worker-card-value","font-mono","text-xs"],[3,"unit","primaryOverride"],[1,"worker-card-value","break-words"],[1,"worker-card-label","text-xs","block","mb-2"],[1,"flex","flex-wrap","gap-1"],[1,"worker-badge"],[1,"space-y-2","max-h-24","overflow-y-auto"],[1,"worker-message"],[1,"worker-card-label","ml-1"],[1,"worker-btn","text-sm",3,"click","title"],[1,"worker-btn-maintenance","text-sm",3,"click","title"],[1,"worker-btn-pause","text-sm",3,"click","title"],[1,"btn-danger","text-sm",3,"click","title"]],template:function(a,p){if(a&1&&(C(0,se,6,3,"div",0),C(1,ye,8,1,"div",1),o(2,"div")(3,"div",2)(4,"div",3)(5,"div",4),C(6,Ie,4,3,"div",5)(7,We,4,3,"div",6),o(8,"div",7)(9,"div",8)(10,"h3",9),l(11),r(),C(12,Be,3,3,"span",10)(13,Ve,3,3,"span",11)(14,Me,3,3,"span",12),C(15,Ue,6,6,"button",13),r(),o(16,"p",14),l(17),r()()(),o(18,"div",15),C(19,De,4,3,"div",16),C(20,Oe,4,3,"div",16),C(21,Fe,4,3,"div",16),C(22,Le,4,3,"div",16),C(23,Ne,4,3,"div",16),C(24,Pe,4,3,"div",16),r()()(),o(25,"div",17)(26,"div",18)(27,"div",19),C(28,Ge,3,3,"span",20),C(29,Re,2,5,"a",21)(30,$e,2,5,"a",21)(31,je,2,2,"span",22),r(),C(32,ze,6,4,"div",19),o(33,"div",23)(34,"span",20),l(35),s(36,"transloco"),r(),C(37,qe,2,3,"span",22)(38,Xe,2,2,"span",22),r(),C(39,Je,6,4,"div",23),C(40,Ke,6,4,"div",23),C(41,Qe,6,4,"div",19),r(),o(42,"div",24)(43,"div",19)(44,"span",20),l(45),s(46,"transloco"),r(),o(47,"span",25),l(48),r()(),o(49,"div",19)(50,"span",20),l(51),s(52,"transloco"),r(),C(53,Ye,3,3,"span",25)(54,Ze,2,1,"span",25),r(),o(55,"div",19)(56,"span",20),l(57),s(58,"transloco"),r(),o(59,"span",25),l(60),r()(),o(61,"div",19)(62,"span",20),l(63),s(64,"transloco"),r(),o(65,"span",25),l(66),s(67,"formatNumber"),r()(),C(68,it,6,4,"div",19),C(69,rt,6,4,"div",19),r(),o(70,"div",26),C(71,dt,2,1),C(72,st,6,4,"div",19),o(73,"div",19)(74,"span",20),l(75),s(76,"transloco"),r(),o(77,"span",25),l(78),s(79,"transloco"),s(80,"transloco"),r()()(),C(81,kt,11,9,"div",27),C(82,gt,7,5,"div",27),r(),o(83,"div",28)(84,"button",29),s(85,"transloco"),w("click",function(){return p.openModelsDialog()}),l(86),s(87,"transloco"),r(),C(88,ft,4,6,"button",30),C(89,St,4,4,"button",31),C(90,Et,5,6,"button",32),C(91,yt,4,6,"button",33),r()()),a&2){let b,I,V,N,P,G,R;u(p.showSuccess()?0:-1),i(),u(p.dialogOpen()?1:-1),i(),q(p.getCardBackground()),i(4),u(p.hasIssue()?7:6),i(4),k("title",p.worker().name),i(),_(" ",p.truncateName(p.worker().name)," "),i(),u((b=p.worker().type)==="image"?12:b==="text"?13:b==="interrogation"?14:-1),i(3),u(p.highlighted()?15:-1),i(2),x(p.worker().id),i(2),u(p.isLowSpeed()?19:-1),i(),u(p.isHighSpeed()?20:-1),i(),u(p.worker().paused?21:-1),i(),u(p.worker().maintenance_mode?22:-1),i(),u(p.worker().flagged?23:-1),i(),u(p.worker().trusted?24:-1),i(4),u(p.hasOwnerName()||p.getOwnerUserId()?28:-1),i(),u(p.getOwnerUserId()&&p.isModerator()?29:p.hasOwnerName()&&p.getOwnerUserId()?30:p.hasOwnerName()?31:-1),i(3),u((I=p.worker().team)!=null&&I.name||(I=p.worker().team)!=null&&I.id?32:-1),i(3),_("",c(36,46,"admin.workers.card.bridge_agent"),":"),i(2),u((V=p.getParsedBridgeAgent())?37:38,V),i(2),u((N=p.getParsedBridgeAgent())?39:-1,N),i(),u(p.worker().contact&&p.isModerator()?40:-1),i(),u(p.worker().ipaddr&&p.isModerator()?41:-1),i(4),_("",c(46,48,"admin.workers.card.uptime"),":"),i(3),x(p.formatUptime(p.worker().uptime)),i(3),_("",c(52,50,"admin.workers.card.speed"),":"),i(2),u((P=p.getPerformanceUnit())?53:54,P),i(4),_("",c(58,52,"admin.workers.card.threads"),":"),i(3),x(p.worker().threads),i(3),_("",c(64,54,"admin.workers.card.requests_fulfilled"),":"),i(3),x(c(67,56,p.worker().requests_fulfilled)),i(2),u(p.worker().type==="image"&&p.worker().megapixelsteps_generated!==void 0?68:-1),i(),u(p.worker().type==="text"&&p.worker().tokens_generated!==void 0?69:-1),i(2),u(p.worker().type!=="interrogation"?71:-1),i(),u(p.worker().type==="interrogation"&&(((G=p.worker().forms)==null?null:G.length)??0)>0?72:-1),i(3),_("",c(76,58,"admin.workers.card.nsfw"),":"),i(3),x(p.worker().nsfw?c(79,60,"admin.common.yes"):c(80,62,"admin.common.no")),i(3),u(p.worker().type==="image"&&p.hasImageCapabilities()?81:-1),i(),u((((R=p.worker().messages)==null?null:R.length)??0)>0&&p.isModerator()?82:-1),i(2),k("title",c(85,64,"admin.workers.action.show_models")),i(2),_(" ",c(87,66,"admin.workers.button.models")," "),i(2),u(p.canChangeTeam()?88:-1),i(),u(p.canToggleMaintenance()?89:-1),i(),u(p.canTogglePause()?90:-1),i(),u(p.canDelete()?91:-1)}},dependencies:[Q,Y,ie,J,Z],encapsulation:2,changeDetection:0});let e=d;return e})();export{Gt as a};
