import{a as e,b as c}from"./chunk-HLFKHDP3.js";import{a as g}from"./chunk-LYJSE2CR.js";import{A as h,P as l,S as u,X as d,ja as n,k as a,kc as _}from"./chunk-7X6QMTFM.js";var U=(()=>{let s=class s{constructor(){this.database=d(c),this.aiHorde=d(g),this._currentUser=n(null),this._isLoading=n(!1),this._isInitialized=n(!1),this.currentUser=this._currentUser.asReadonly(),this.isLoading=this._isLoading.asReadonly(),this.isLoggedIn=_(()=>this._currentUser()!==null),this.isInitialized=this._isInitialized.asReadonly(),this.initializeFromStorage()}initializeFromStorage(){let i=this.database.get("remember_api_key",!0),t=this.database.get("api_key",null,i?e.Permanent:e.Session);t?(this._isLoading.set(!0),this.aiHorde.getUserByApiKey(t).subscribe({next:r=>{this._currentUser.set(r),this._isLoading.set(!1),this._isInitialized.set(!0)},error:()=>{this._isLoading.set(!1),this._isInitialized.set(!0)}})):this._isInitialized.set(!0)}login(i,t=!1){return this._isLoading.set(!0),this.aiHorde.getUserByApiKey(i).pipe(l(r=>{r&&(this.database.store("remember_api_key",t),this.database.store("api_key",i,t?e.Permanent:e.Session),this._currentUser.set(r)),this._isLoading.set(!1)}),h(()=>(this._isLoading.set(!1),a(null))))}logout(){this._currentUser.set(null),this.database.store("api_key","",e.Permanent),this.database.store("api_key","",e.Session)}refreshUser(){let i=this.database.get("remember_api_key",!0),t=this.database.get("api_key",null,i?e.Permanent:e.Session);return t?(this._isLoading.set(!0),this.aiHorde.getUserByApiKey(t).pipe(l(r=>{this._currentUser.set(r),this._isLoading.set(!1)}),h(()=>(this._isLoading.set(!1),a(null))))):a(null)}getStoredApiKey(){let i=this.database.get("remember_api_key",!0);return this.database.get("api_key",null,i?e.Permanent:e.Session)}};s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();export{U as a};
