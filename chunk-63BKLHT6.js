import{a as fe}from"./chunk-ZQ5HKBLG.js";import{a as Z}from"./chunk-VPTPSFW4.js";import{c as ee,d as v,e as te,f as ie,g as re,h as f,i as ne,j as oe,k as ae,l as se,m as le,n as pe,o as me,q as de,r as ue,u as ce}from"./chunk-F3G3ZQGW.js";import{a as he}from"./chunk-YTTO6GBW.js";import{a as Y}from"./chunk-2KXHES2T.js";import{b as Q,c as W,d as X}from"./chunk-YOLUTX5D.js";import{a as U,b as z}from"./chunk-RN7KHVWD.js";import{b as L,e as O}from"./chunk-KSNJMSYC.js";import{a as J}from"./chunk-3PZAYDWK.js";import{k as G}from"./chunk-DWXO5IB4.js";import{k as u,m as j}from"./chunk-HKCT6KYV.js";import{A as E,Ab as $,Bb as A,Ma as i,Mb as x,Pb as a,Qb as m,Rb as C,Sb as H,V as h,Xa as D,_b as T,ab as R,bc as s,cc as p,dc as V,ea as q,ha as S,ic as F,mb as b,nb as _,pb as M,qb as P,rb as c,sb as o,tb as r,ub as k,vb as N,wb as K}from"./chunk-T5FNS33L.js";import{d as w}from"./chunk-4CLCTAJ7.js";var _e=t=>({exampleUser:t}),be=t=>({user:t}),ve=t=>({amountFormatted:t}),ge=(t,n)=>n.id;function ye(t,n){if(t&1&&(N(0),a(1),K()),t&2){let l=n.$implicit;i(),C(" ",l("transfer.title")," ")}}function xe(t,n){if(t&1&&(N(0),a(1),o(2,"a",26),a(3),r(),a(4," . "),K()),t&2){let l=n.$implicit;i(),C(" ",l("transfer.visit_old_pre")," "),i(2),m(l("transfer.visit_old_link_text"))}}function Ce(t,n){t&1&&(o(0,"p",14)(1,"small"),a(2),s(3,"transloco"),r()()),t&2&&(i(2),m(p(3,1,"invalid_api_key")))}function Se(t,n){if(t&1&&(o(0,"p",15)(1,"small"),a(2),s(3,"transloco"),r()()),t&2){let l=A();i(2),m(V(3,1,"current_user",T(4,be,l.currentUser().username)))}}function ke(t,n){if(t&1&&(o(0,"option",30),a(1),s(2,"transloco"),r(),o(3,"option",30),a(4),s(5,"formatNumber"),s(6,"transloco"),r()),t&2){let l=n.$implicit;c("value",null),i(),C(" ",p(2,5,"option.empty")," "),i(2),c("value",l.id),i(),H(" ",l.username," (",V(6,9,"transfer.account.kudos_amount",T(12,ve,p(5,7,l.kudos))),") ")}}function Te(t,n){if(t&1&&(o(0,"div",27)(1,"p",15)(2,"small"),a(3),s(4,"transloco"),o(5,"sup")(6,"a",28),a(7,"1"),r()()()(),o(8,"select",29),M(9,ke,7,14,null,null,ge),r()()),t&2){let l=A();x("mb-5",l.form.value.targetUserValidated!==!1)("mb-1",l.form.value.targetUserValidated===!1),i(3),m(p(4,5,"transfer.donate")),i(6),P(l.educatorAccounts())}}function Ve(t,n){t&1&&(o(0,"p",21)(1,"small"),a(2),s(3,"transloco"),r()()),t&2&&(i(2),m(p(3,1,"invalid_target_user")))}function Ue(t,n){t&1&&(o(0,"p",21)(1,"small"),a(2),s(3,"transloco"),r()()),t&2&&(i(2),m(p(3,1,"transfer.too_many_kudos")))}function Ee(t,n){t&1&&(o(0,"p",31),a(1),s(2,"transloco"),r()),t&2&&(i(),C(" ",p(2,1,"transfer.success")," "))}function Ae(t,n){t&1&&(o(0,"p",21),a(1),s(2,"transloco"),r()),t&2&&(i(),m(p(2,1,"transfer.error")))}function Be(t,n){if(t&1&&b(0,Ee,3,3,"p",31)(1,Ae,3,3,"p",21),t&2){let l=A();_(l.sentSuccessfully()?0:1)}}var Qe=(()=>{let n=class n{constructor(){this.title=h(G),this.translator=h(Y),this.footerColor=h(Z),this.database=h(z),this.aiHorde=h(J),this.activatedRoute=h(L),this.destroyRef=h(q),this.exampleUsers=S(["db0#1","Tazlin#6572","Rikudou#185676"]),this.exampleUser=F(()=>this.exampleUsers()[Math.floor(Math.random()*this.exampleUsers().length)]),this.currentUser=S(null),this.sentSuccessfully=S(null),this.maximumKudos=F(()=>this.currentUser()?this.currentUser().kudos:null),this.educatorAccounts=j(this.aiHorde.getEducatorAccounts()),this.fragment=S(null),this.form=new re({apiKey:new f("",[v.required]),remember:new f(!1),targetUser:new f("",[v.required]),kudosAmount:new f(1,[v.required,v.min(1)]),educatorAccount:new f(null),apiKeyValidated:new f(null,[v.requiredTrue]),targetUserValidated:new f(null,[v.requiredTrue]),kudosAmountValidated:new f(null,[v.requiredTrue])})}ngOnInit(){this.translator.get("transfer.title").pipe(u(this.destroyRef)).subscribe(e=>{this.translator.get("app_title").subscribe(d=>{this.title.setTitle(`${e} | ${d}`)})}),this.footerColor.setDarkMode(!0);let y=this.database.get("remember_api_key",!0),g=this.database.get("api_key",y?U.Permanent:U.Session);this.form.controls.apiKey.valueChanges.pipe(u(this.destroyRef)).subscribe(()=>{this.currentUser.set(null),this.form.patchValue({apiKeyValidated:null})}),this.form.controls.targetUser.valueChanges.pipe(u(this.destroyRef)).subscribe(()=>{this.form.patchValue({targetUserValidated:null})}),this.form.controls.kudosAmount.valueChanges.pipe(u(this.destroyRef)).subscribe(e=>{if(e??=0,this.maximumKudos()===null){this.form.patchValue({kudosAmountValidated:null});return}this.form.patchValue({kudosAmountValidated:e<=this.maximumKudos()})}),this.form.controls.educatorAccount.valueChanges.pipe(u(this.destroyRef)).subscribe(e=>{if(e==="null"&&(e=null),!e){this.form.controls.targetUser.enable(),this.form.patchValue({targetUser:""});return}e=Number(e);let d=this.educatorAccounts().filter(B=>B.id===e)[0];this.form.controls.targetUser.disable(),this.form.patchValue({targetUser:d.username})}),this.form.controls.apiKey.valueChanges.pipe(E(500),u(this.destroyRef)).subscribe(e=>w(this,null,function*(){e&&this.aiHorde.getUserByApiKey(e).subscribe(d=>{this.currentUser.set(d),this.form.patchValue({apiKeyValidated:d!==null})})})),this.form.controls.targetUser.valueChanges.pipe(E(500),u(this.destroyRef)).subscribe(e=>w(this,null,function*(){if(!e)return;let d=e.split("#");if(d.length!==2){this.form.patchValue({targetUserValidated:!1});return}let B=Number(d[1]);this.aiHorde.getUserById(B).subscribe(I=>{this.form.patchValue({targetUserValidated:I!==null&&e.toLowerCase()===I.username.toLowerCase()})})})),this.form.patchValue({remember:y}),g&&this.form.patchValue({apiKey:g}),this.form.valueChanges.pipe(E(300),u(this.destroyRef)).subscribe(e=>{this.database.store("remember_api_key",e.remember??!1),this.database.store("api_key",e.apiKey??"",e.remember?U.Permanent:U.Session),this.sentSuccessfully.set(null)}),this.activatedRoute.fragment.pipe(u(this.destroyRef)).subscribe(e=>{this.fragment.set(e),e&&typeof document<"u"&&document.querySelector(`#${e}`)?.scrollIntoView()})}transfer(){this.sentSuccessfully.set(null),this.form.valid&&this.aiHorde.transferKudos(this.form.value.apiKey,this.form.controls.targetUser.value,this.form.value.kudosAmount).subscribe(y=>{this.sentSuccessfully.set(y)})}};n.\u0275fac=function(g){return new(g||n)},n.\u0275cmp=D({type:n,selectors:[["app-transfer"]],decls:47,vars:60,consts:[[1,"section-primary"],[1,"container-page-header"],[1,"place-center"],[1,"heading-hero"],[4,"transloco"],[1,"section-secondary"],[1,"container-spaced"],[1,"grid-items"],[1,"text-secondary","sm:text-lg"],[1,"mb-6"],[1,"max-w-sm","mx-auto",3,"ngSubmit","formGroup"],[1,"mb-2"],["for","source_api_key",1,"form-label"],["formControlName","apiKey","type","text","id","source_api_key","required","",1,"form-input",3,"placeholder"],[1,"mb-1","text-error"],[1,"mb-1"],[1,"mb-5"],["formControlName","remember",3,"description"],["for","target_user",1,"form-label"],["formControlName","targetUser","type","text","id","target_user","required","",1,"form-input",3,"placeholder"],[1,"text-primary",3,"mb-5","mb-1"],[1,"mb-5","text-error"],["for","kudos_amount",1,"form-label"],["formControlName","kudosAmount","type","number","min","1","id","kudos_amount","required","",1,"form-input",3,"placeholder"],["type","submit",1,"hover:bg-blue-800","focus:ring-4","focus:outline-none","focus:ring-blue-300","font-medium","rounded-lg","text-sm","w-full","sm:w-auto","px-5","py-2.5","text-center","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800",3,"disabled"],["id","note1",1,"mt-6"],["href","/transfer",1,"link"],[1,"text-primary"],["routerLink","/v2-transfer/","fragment","note1",1,"text-blue-600","dark:text-green-400"],["formControlName","educatorAccount",1,"form-input"],[3,"value"],[1,"mb-5","text-success"]],template:function(g,e){g&1&&(o(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),R(4,ye,2,1,"ng-container",4),r()()()(),o(5,"section",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"p",9),R(10,xe,5,2,"ng-container",4),r(),o(11,"form",10),$("ngSubmit",function(){return e.transfer()}),o(12,"div",11)(13,"label",12),a(14),s(15,"transloco"),r(),k(16,"input",13),s(17,"transloco"),r(),b(18,Ce,4,3,"p",14),b(19,Se,4,6,"p",15),o(20,"div",16),k(21,"app-toggle-checkbox",17),s(22,"transloco"),r(),o(23,"div")(24,"label",18),a(25),s(26,"transloco"),r(),k(27,"input",19),s(28,"transloco"),r(),b(29,Te,11,7,"div",20),b(30,Ve,4,3,"p",21),o(31,"div")(32,"label",22),a(33),s(34,"transloco"),r(),k(35,"input",23),s(36,"transloco"),s(37,"transloco"),r(),b(38,Ue,4,3,"p",21),b(39,Be,2,1),o(40,"button",24),a(41," Submit "),r()(),o(42,"p",25)(43,"sup"),a(44,"1"),r(),a(45),s(46,"transloco"),r()()()()()),g&2&&(i(11),c("formGroup",e.form),i(3),m(p(15,36,"transfer.source_api_key")),i(2),c("placeholder",p(17,38,"transfer.source_api_key.description")),i(2),_(e.form.value.apiKeyValidated===!1?18:-1),i(),_(e.currentUser()?19:-1),i(2),c("description",p(22,40,"transfer.source_api_key.remember")),i(2),x("mb-1",e.educatorAccounts())("mb-5",!e.educatorAccounts()),i(2),m(p(26,42,"transfer.target_user")),i(2),c("placeholder",V(28,44,"transfer.target_user.description",T(56,_e,e.exampleUser()))),i(2),_(e.educatorAccounts()?29:-1),i(),_(e.form.value.targetUserValidated===!1?30:-1),i(),x("mb-5",e.form.value.kudosAmountValidated!==!1)("mb-1",e.form.value.kudosAmountValidated===!1),i(2),m(p(34,47,"transfer.kudos_amount")),i(2),c("placeholder",V(37,51,"transfer.kudos_amount.description",T(58,be,e.form.value.targetUser||p(36,49,"transfer.kudos_amount.description.user_placeholder")))),i(3),_(e.form.value.kudosAmountValidated===!1?38:-1),i(),_(e.sentSuccessfully()!==null?39:-1),i(),x("cursor-not-allowed",!e.form.valid)("bg-gray-600",!e.form.valid)("text-gray-500",!e.form.valid)("bg-blue-700",e.form.valid)("text-white",e.form.valid),c("disabled",!e.form.valid),i(2),x("active",e.fragment()==="note1"),i(3),C(" ",p(46,54,"educators.explanation")," "))},dependencies:[W,X,Q,fe,ce,ne,pe,me,ee,oe,le,te,ie,ue,de,ae,se,he,O],encapsulation:2});let t=n;return t})();export{Qe as TransferComponent};
