import{a as J}from"./chunk-C4TABRAY.js";import{c as z}from"./chunk-FTBVTQIQ.js";import{a as O}from"./chunk-GNQEPVMX.js";import"./chunk-2I7QPWUU.js";import{e as Y}from"./chunk-YVUAGCMM.js";import{a as q}from"./chunk-ZSSS3M63.js";import{f as $,k as j}from"./chunk-GZJELONB.js";import{k as D}from"./chunk-G5JR4JTT.js";import{$ as B,Bb as T,Cb as C,E as F,Na as t,Nb as R,Qb as r,Rb as h,Sb as u,W as E,Ya as V,aa as K,ba as y,ca as L,cc as l,dc as s,fa as G,ia as v,jc as U,nb as f,ob as b,p as k,qb as Z,r as H,rb as A,sb as I,tb as i,ub as o,vb as g,yb as P}from"./chunk-DAYIYFOB.js";import{d as w}from"./chunk-4CLCTAJ7.js";var Q=(e,n)=>n.id;function W(e,n){e&1&&g(0,"div",3)}function X(e,n){e&1&&(y(),i(0,"svg",4),g(1,"path",8),o())}function ee(e,n){if(e&1){let c=P();i(0,"div",5),y(),i(1,"svg",9),g(2,"path",10),o(),L(),i(3,"p"),r(4),o(),i(5,"button",11),T("click",function(){B(c);let m=C();return K(m.loadLeaderboard())}),r(6),l(7,"transloco"),o()()}if(e&2){let c=C();t(4),h(c.error()),t(2),u(" ",s(7,2,"details.leaderboard.retry")," ")}}function te(e,n){e&1&&(i(0,"div",6),g(1,"div",12),i(2,"p"),r(3),l(4,"transloco"),o()()),e&2&&(t(3),h(s(4,1,"details.leaderboard.loading")))}function ie(e,n){e&1&&(i(0,"div",41),y(),i(1,"svg",42),g(2,"path",17),o(),L(),i(3,"span"),r(4),l(5,"transloco"),o()()),e&2&&(t(4),h(s(5,1,"details.leaderboard.thank_you_message")))}function ne(e,n){if(e&1&&(i(0,"div",20)(1,"div",37)(2,"div",38)(3,"span",39),r(4),l(5,"transloco"),o(),i(6,"span",40),r(7),l(8,"number"),o()(),f(9,ie,6,3,"div",41),o()()),e&2){let c=C(2);t(4),h(s(5,3,"details.leaderboard.your_rank")),t(3),u("#",s(8,5,c.userRank())),t(2),b(c.showThankYou()?9:-1)}}function ae(e,n){e&1&&(g(0,"div",3),r(1),l(2,"transloco")),e&2&&(t(),u(" ",s(2,1,"details.leaderboard.searching")," "))}function oe(e,n){e&1&&(r(0),l(1,"transloco")),e&2&&u(" ",s(1,1,"details.leaderboard.login_to_rate")," ")}function re(e,n){e&1&&(r(0),l(1,"transloco")),e&2&&u(" ",s(1,1,"details.leaderboard.find_my_rank_button")," ")}function de(e,n){e&1&&r(0," \u{1F947} ")}function le(e,n){e&1&&r(0," \u{1F948} ")}function se(e,n){e&1&&r(0," \u{1F949} ")}function pe(e,n){if(e&1&&r(0),e&2){let c=C().$index;u(" ",c+1," ")}}function ce(e,n){if(e&1&&(i(0,"div",35)(1,"div",43)(2,"span",44),f(3,de,1,0)(4,le,1,0)(5,se,1,0)(6,pe,1,1),o()(),i(7,"div",45)(8,"span",46),r(9),o()(),i(10,"div",43)(11,"span",47),r(12),l(13,"transloco"),o(),i(14,"span",48),r(15),l(16,"number"),o()()()),e&2){let c=n.$implicit,a=n.$index;t(2),R("rank-1",a===0)("rank-2",a===1)("rank-3",a===2),t(),b(a===0?3:a===1?4:a===2?5:6),t(5),I("title",c.username),t(),u(" ",c.username," "),t(3),h(s(13,11,"details.leaderboard.kudos")),t(3),u(" ",s(16,13,c.kudos)," ")}}function me(e,n){if(e&1){let c=P();i(0,"div",13)(1,"div",14)(2,"div",15),y(),i(3,"svg",16),g(4,"path",17),o(),L(),i(5,"div")(6,"h3",18),r(7),l(8,"transloco"),o(),i(9,"p",19),r(10),l(11,"transloco"),o()()()(),i(12,"div",20)(13,"h3",21),r(14),l(15,"transloco"),o(),i(16,"div",22)(17,"p"),r(18),l(19,"transloco"),o(),i(20,"p",23),r(21),l(22,"transloco"),o(),i(23,"p",23)(24,"a",24),r(25),l(26,"transloco"),o()()()()(),i(27,"div",25)(28,"div",26)(29,"div",27)(30,"h3",21),r(31),l(32,"transloco"),o(),i(33,"p",28),r(34),l(35,"transloco"),o()(),f(36,ne,10,7,"div",20),i(37,"div",29)(38,"button",30),l(39,"transloco"),T("click",function(){B(c);let m=C();return K(m.findMyRank())}),f(40,ae,3,3)(41,oe,2,3)(42,re,2,3),o()()()(),i(43,"div",31)(44,"div",32)(45,"span",33),r(46),l(47,"transloco"),o(),i(48,"span",33),r(49),l(50,"transloco"),o(),i(51,"span",34),r(52),l(53,"transloco"),o()(),Z(54,ce,17,15,"div",35,Q),o(),i(56,"div",14)(57,"p",36),r(58),l(59,"transloco"),o()()}if(e&2){let c=C();t(7),u(" ",s(8,18,"details.leaderboard.appreciation_title")," "),t(3),u(" ",s(11,20,"details.leaderboard.appreciation_message")," "),t(4),u(" ",s(15,22,"details.leaderboard.what_kudos_represent")," "),t(4),h(s(19,24,"details.leaderboard.kudos_explanation_1")),t(3),u(" ",s(22,26,"details.leaderboard.kudos_explanation_2")," "),t(4),u(" ",s(26,28,"details.leaderboard.learn_more_faq")," "),t(6),u(" ",s(32,30,"details.leaderboard.find_my_rank")," "),t(3),u(" ",s(35,32,"details.leaderboard.find_my_rank_description")," "),t(2),b(c.rankSearched()&&c.userRank()!==null?36:-1),t(2),R("btn-disabled",!c.isLoggedIn()),I("disabled",!c.isLoggedIn()||c.searchingRank())("title",c.isLoggedIn()?"":s(39,34,"details.leaderboard.login_to_rate")),t(2),b(c.searchingRank()?40:c.isLoggedIn()?42:41),t(6),h(s(47,36,"details.leaderboard.rank")),t(3),h(s(50,38,"details.leaderboard.username")),t(3),h(s(53,40,"details.leaderboard.kudos")),t(2),A(c.users()),t(4),u(" ",s(59,42,"details.leaderboard.footer_note")," ")}}function ue(e,n){e&1&&(i(0,"div",7)(1,"p"),r(2),l(3,"transloco"),o()()),e&2&&(t(2),h(s(3,1,"details.leaderboard.no_users")))}var Ie=(()=>{let n=class n{constructor(){this.title=E(j),this.translator=E(J),this.aiHorde=E(q),this.auth=E(O),this.destroyRef=E(G),this.loading=v(!1),this.error=v(null),this.users=v([]),this.totalKudos=U(()=>this.users().reduce((a,m)=>a+m.kudos,0)),this.isLoggedIn=this.auth.isLoggedIn,this.currentUser=this.auth.currentUser,this.searchingRank=v(!1),this.userRank=v(null),this.rankSearched=v(!1),this.showThankYou=v(!1)}ngOnInit(){H([this.translator.get("details.leaderboard.title"),this.translator.get("app_title")]).pipe(D(this.destroyRef)).subscribe(([a,m])=>{this.title.setTitle(`${a} | ${m}`)}),this.loadLeaderboard()}loadLeaderboard(){this.loading.set(!0),this.error.set(null),this.aiHorde.getKudosLeaderboard(1,25).pipe(D(this.destroyRef),F(()=>this.loading.set(!1))).subscribe({next:a=>{this.users.set(a)},error:()=>{this.error.set("Failed to load kudos leaderboard")}})}findMyRank(){return w(this,null,function*(){let a=this.currentUser();if(a){this.searchingRank.set(!0),this.userRank.set(null),this.rankSearched.set(!1),this.showThankYou.set(!1);try{let m=yield this.binarySearchRank(a.kudos,a.id);this.userRank.set(m),this.rankSearched.set(!0),this.showThankYou.set(!0)}catch{this.userRank.set(null),this.rankSearched.set(!0),this.showThankYou.set(!1)}finally{this.searchingRank.set(!1)}}})}binarySearchRank(a,m){return w(this,null,function*(){let d=1,x=1,_=yield k(this.aiHorde.getKudosLeaderboardPage(x));for(;_.length===n.PAGE_SIZE&&!(_[_.length-1].kudos<a);)d=x,x*=2,_=yield k(this.aiHorde.getKudosLeaderboardPage(x));for(;d<x;){let p=Math.floor((d+x)/2);if(_=yield k(this.aiHorde.getKudosLeaderboardPage(p)),_.length===0){x=p;continue}let S=_[0].kudos,N=_[_.length-1].kudos;a>S?x=p:a<N?d=p+1:(d=p,x=p)}_=yield k(this.aiHorde.getKudosLeaderboardPage(d));for(let p=0;p<_.length;p++)if(_[p].id===m)return(d-1)*n.PAGE_SIZE+p+1;if(d>1){let p=yield k(this.aiHorde.getKudosLeaderboardPage(d-1));for(let S=0;S<p.length;S++)if(p[S].id===m)return(d-2)*n.PAGE_SIZE+S+1}let M=yield k(this.aiHorde.getKudosLeaderboardPage(d+1));for(let p=0;p<M.length;p++)if(M[p].id===m)return d*n.PAGE_SIZE+p+1;for(let p=0;p<_.length;p++)if(_[p].kudos<=a)return(d-1)*n.PAGE_SIZE+p+1;return(d-1)*n.PAGE_SIZE+_.length+1})}formatKudos(a){return a>=1e9?(a/1e9).toFixed(1)+"B":a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a.toLocaleString()}};n.PAGE_SIZE=25,n.\u0275fac=function(m){return new(m||n)},n.\u0275cmp=V({type:n,selectors:[["app-kudos-leaderboard"]],decls:11,vars:9,consts:[[1,"stack-lg"],[1,"details-tabs"],["type","button",1,"btn-source-control",3,"click","disabled"],["aria-hidden","true",1,"spinner","spinner-sm"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"icon-sm"],[1,"state-container","state-container-sm","state-error"],[1,"state-container","state-container-sm","text-secondary"],[1,"state-container","state-container-sm","state-muted"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"state-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"],["type","button",1,"btn-source-control",3,"click"],[1,"spinner","spinner-md"],[1,"usage-totals-grid"],[1,"card","card-bg-secondary"],[1,"flex","items-start","gap-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"icon-sm","text-brand-purple","flex-shrink-0","mt-0.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"],[1,"font-semibold","text-primary"],[1,"text-secondary","text-sm","mt-1"],[1,"card","card-bg-primary"],[1,"heading-card"],[1,"prose-content","text-sm"],[1,"mt-2"],["routerLink","/faq",1,"link"],[1,"card","card-bg-secondary","card-full"],[1,"stack-sm"],[1,"text-center"],[1,"text-secondary","text-sm"],[1,"flex","justify-center"],["type","button",1,"btn-primary",3,"click","disabled","title"],[1,"models-table"],[1,"models-table-header","usage-table-header"],[1,"models-table-th"],[1,"models-table-th","models-table-th-right"],[1,"models-table-row","usage-table-row"],[1,"text-secondary","text-sm","text-center"],[1,"flex","flex-col","items-center","gap-3"],[1,"flex","flex-col","items-center","gap-1"],[1,"text-secondary","text-sm","font-medium"],[1,"text-5xl","font-bold","text-primary",2,"font-variant-numeric","tabular-nums"],[1,"flex","items-center","gap-2","text-brand-purple","text-sm","font-medium"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"icon-sm","flex-shrink-0"],[1,"models-table-cell"],[1,"model-rank-badge"],[1,"models-table-cell-name"],[1,"models-table-name",3,"title"],[1,"models-table-label"],[1,"models-table-value","kudos-value"]],template:function(m,d){m&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),T("click",function(){return d.loadLeaderboard()}),f(3,W,1,0,"div",3)(4,X,2,0,":svg:svg",4),r(5),l(6,"transloco"),o()(),f(7,ee,8,4,"div",5),f(8,te,5,3,"div",6),f(9,me,60,44),f(10,ue,4,3,"div",7),o()),m&2&&(t(2),I("disabled",d.loading()),t(),b(d.loading()?3:4),t(2),u(" ",s(6,7,"details.leaderboard.refresh")," "),t(2),b(d.error()?7:-1),t(),b(d.loading()&&!d.error()?8:-1),t(),b(!d.loading()&&!d.error()&&d.users().length>0?9:-1),t(),b(!d.loading()&&!d.error()&&d.users().length===0?10:-1))},dependencies:[z,$,Y],styles:[".kudos-value[_ngcontent-%COMP%]{font-variant-numeric:tabular-nums}"],changeDetection:0});let e=n;return e})();export{Ie as KudosLeaderboardComponent};
