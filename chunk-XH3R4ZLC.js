import{a as ne}from"./chunk-OXDKZCOM.js";import{a as ie}from"./chunk-FJFZRYE7.js";import{a as oe}from"./chunk-BQ3SFYXW.js";import{o as Z,p as ee,u as te}from"./chunk-7P7BAAIV.js";import{a as V}from"./chunk-Z4QX4XJM.js";import"./chunk-T6V27EFK.js";import{a as X}from"./chunk-ISHBUXAM.js";import"./chunk-VFTR325L.js";import{c as Y,d as J}from"./chunk-BMIYH3UD.js";import{l as N}from"./chunk-3GXWXVSS.js";import{g as z,k as I}from"./chunk-GZDNXZTC.js";import{$b as O,A as B,Cb as x,Db as v,F as w,Oa as i,Rb as r,S as K,Sb as _,Tb as m,Ub as L,X as S,Za as q,aa as E,ba as P,ca as T,da as R,ga as G,gc as s,hc as d,ja as h,k as C,nc as U,ob as f,pb as k,q as $,qb as A,r as j,rb as W,sb as F,tb as g,ub as n,vb as o,wb as y,zb as D}from"./chunk-QF4LG6ZD.js";import"./chunk-4CLCTAJ7.js";var ae=(()=>{let c=class c{constructor(){this.httpClient=S(z),this.auth=S(V),this.baseUrl="https://aihorde.net/api/v2"}getHeaders(){let e=this.auth.getStoredApiKey();return e?{apikey:e}:{}}getIPTimeouts(){return this.httpClient.get(`${this.baseUrl}/operations/ipaddr`,{headers:this.getHeaders()}).pipe(B(()=>C([])))}getIPTimeout(e){let p=encodeURIComponent(e);return this.httpClient.get(`${this.baseUrl}/operations/ipaddr/${p}`,{headers:this.getHeaders()}).pipe($(a=>a&&a.length>0?a[0]:null),B(()=>C(null)))}addIPTimeout(e){let p=this.auth.getStoredApiKey();return p?this.httpClient.post(`${this.baseUrl}/operations/ipaddr`,e,{headers:{apikey:p}}).pipe(B(()=>C(null))):C(null)}removeIPTimeout(e){let p=this.auth.getStoredApiKey();return p?this.httpClient.delete(`${this.baseUrl}/operations/ipaddr`,{headers:{apikey:p},body:{ipaddr:e}}).pipe($(()=>!0),B(()=>C(!1))):C(!1)}blockWorkerIP(e,p){let a=this.auth.getStoredApiKey();if(!a)return C(null);let u={days:p};return this.httpClient.put(`${this.baseUrl}/operations/block_worker_ipaddr/${e}`,u,{headers:{apikey:a}}).pipe(B(()=>C(null)))}unblockWorkerIP(e){let p=this.auth.getStoredApiKey();return p?this.httpClient.delete(`${this.baseUrl}/operations/block_worker_ipaddr/${e}`,{headers:{apikey:p}}).pipe($(()=>!0),B(()=>C(!1))):C(!1)}};c.\u0275fac=function(p){return new(p||c)},c.\u0275prov=K({token:c,factory:c.\u0275fac,providedIn:"root"});let t=c;return t})();var le=(t,c)=>c.ipaddr,se=(t,c)=>c.id;function de(t,c){t&1&&(n(0,"div",10),T(),n(1,"svg",49),y(2,"circle",50)(3,"path",51),o(),R(),n(4,"span",52),r(5),s(6,"transloco"),o()()),t&2&&(i(5),_(d(6,1,"admin.operations.ip_timeouts.loading")))}function pe(t,c){t&1&&(n(0,"div",11),T(),n(1,"svg",53),y(2,"path",54),o(),R(),n(3,"span",55),r(4),s(5,"transloco"),o()()),t&2&&(i(4),_(d(5,1,"admin.operations.ip_timeouts.no_timeouts")))}function ce(t,c){if(t&1){let l=D();n(0,"tr")(1,"td")(2,"code",58),r(3),o()(),n(4,"td")(5,"span",59),r(6),o()(),n(7,"td")(8,"div",60)(9,"button",61),s(10,"transloco"),x("click",function(){let p=E(l).$implicit,a=v(2);return P(a.openRefreshIPDialog(p))}),T(),n(11,"svg",62),y(12,"path",63),o()(),R(),n(13,"button",64),s(14,"transloco"),x("click",function(){let p=E(l).$implicit,a=v(2);return P(a.openDeleteIPDialog(p))}),T(),n(15,"svg",62),y(16,"path",65),o()()()()()}if(t&2){let l=c.$implicit,e=v(2);i(3),_(l.ipaddr),i(3),_(e.formatDuration(l.seconds)),i(3),g("title",O(d(10,6,"admin.operations.ip_timeouts.refresh"))),i(4),g("title",O(d(14,8,"admin.operations.ip_timeouts.remove")))}}function me(t,c){if(t&1&&(n(0,"div",12)(1,"div",56)(2,"table",57)(3,"thead")(4,"tr")(5,"th"),r(6),s(7,"transloco"),o(),n(8,"th"),r(9),s(10,"transloco"),o(),n(11,"th"),r(12),s(13,"transloco"),o()()(),n(14,"tbody"),W(15,ce,17,10,"tr",null,le),o()()()()),t&2){let l=v();i(6),_(d(7,3,"admin.operations.ip_timeouts.table.ip")),i(3),_(d(10,5,"admin.operations.ip_timeouts.table.remaining")),i(3),_(d(13,7,"admin.operations.ip_timeouts.table.actions")),i(3),F(l.filteredTimeouts())}}function ue(t,c){if(t&1&&(n(0,"p",20),T(),n(1,"svg",31),y(2,"path",32),o(),r(3),o()),t&2){let l=v();i(3),m(" ",l.addIPWarning()," ")}}function _e(t,c){if(t&1&&(n(0,"option",23),r(1),o()),t&2){let l=c.$implicit;g("value",l),i(),L("",l," ",l===1?"hour":"hours")}}function he(t,c){t&1&&(r(0),s(1,"transloco")),t&2&&m(" ",d(1,1,"admin.operations.add_ip.adding")," ")}function fe(t,c){t&1&&(r(0),s(1,"transloco")),t&2&&m(" ",d(1,1,"admin.operations.add_ip.add_button")," ")}function ke(t,c){t&1&&(r(0),s(1,"transloco")),t&2&&m(" ",d(1,1,"admin.operations.check_ip.checking")," ")}function ge(t,c){t&1&&(r(0),s(1,"transloco")),t&2&&m(" ",d(1,1,"admin.operations.check_ip.check_button")," ")}function ve(t,c){if(t&1){let l=D();n(0,"button",66),x("click",function(){E(l);let p=v();return P(p.clearCheckResult())}),r(1),s(2,"transloco"),o()}t&2&&(i(),m(" ",d(2,1,"admin.operations.check_ip.clear")," "))}function xe(t,c){t&1&&(n(0,"div",67)(1,"div",69)(2,"span",70),r(3),s(4,"transloco"),o(),n(5,"span",71),r(6),s(7,"transloco"),o()()()),t&2&&(i(3),_(d(4,2,"admin.operations.check_ip.not_blocked")),i(3),_(d(7,4,"admin.operations.check_ip.not_blocked_message")))}function be(t,c){if(t&1&&(n(0,"div",68)(1,"div",69)(2,"span",72),r(3),s(4,"transloco"),o(),n(5,"span",71),r(6),s(7,"transloco"),n(8,"strong"),r(9),o()()()()),t&2){let l=v(2);i(3),_(d(4,3,"admin.operations.check_ip.blocked")),i(3),m(" ",d(7,5,"admin.operations.check_ip.blocked_message")," "),i(3),_(l.formatDuration(l.checkResult().seconds))}}function Ce(t,c){if(t&1&&(n(0,"div"),f(1,xe,8,6,"div",67)(2,be,10,7,"div",68),o()),t&2){let l=v();i(),k(l.checkResult()===null?1:2)}}function Ie(t,c){if(t&1){let l=D();n(0,"button",73),s(1,"transloco"),x("click",function(){E(l);let p=v();return P(p.clearWorkerSelection())}),T(),n(2,"svg",74),y(3,"path",75),o()()}t&2&&g("title",O(d(1,2,"admin.operations.worker_block.clear_selection")))}function we(t,c){t&1&&(n(0,"div",76),r(1),s(2,"transloco"),o()),t&2&&(i(),m(" ",d(2,1,"admin.operations.worker_block.loading_workers")," "))}function Se(t,c){t&1&&(n(0,"span",81),r(1,"Online"),o())}function Te(t,c){t&1&&(n(0,"span",82),r(1,"Offline"),o())}function ye(t,c){if(t&1){let l=D();n(0,"button",78),x("mousedown",function(){let p=E(l).$implicit,a=v(3);return P(a.selectWorker(p))}),n(1,"span",79),r(2),o(),n(3,"span",80),r(4),o(),f(5,Se,2,0,"span",81)(6,Te,2,0,"span",82),o()}if(t&2){let l=c.$implicit;i(2),_(l.name),i(2),m("",l.id.slice(0,8),"..."),i(),k(l.online?5:6)}}function Ee(t,c){if(t&1&&W(0,ye,7,3,"button",77,se),t&2){let l=v(2);F(l.filteredWorkers())}}function Pe(t,c){if(t&1&&(n(0,"div",40),f(1,we,3,3,"div",76)(2,Ee,2,0),o()),t&2){let l=v();i(),k(l.loadingWorkers()?1:2)}}function Oe(t,c){if(t&1&&(n(0,"option",23),r(1),o()),t&2){let l=c.$implicit;g("value",l),i(),L("",l," ",l===1?"day":"days")}}function Be(t,c){t&1&&(n(0,"span",70),r(1,"Online"),o())}function De(t,c){t&1&&(n(0,"span",89),r(1,"Offline"),o())}function We(t,c){t&1&&(n(0,"span",59),r(1,"Maintenance"),o())}function Fe(t,c){t&1&&(n(0,"span",89),r(1,"Paused"),o())}function Le(t,c){t&1&&(n(0,"span",70),r(1,"Yes"),o())}function Re(t,c){t&1&&(n(0,"span",89),r(1,"No"),o())}function $e(t,c){if(t&1&&(n(0,"div",90)(1,"span",86),r(2),s(3,"transloco"),o(),n(4,"span",87),r(5),o()()),t&2){let l=v();i(2),m("",d(3,2,"admin.operations.worker_block.worker_owner"),":"),i(3),_(l.owner)}}function Ae(t,c){if(t&1&&(n(0,"div",90)(1,"span",86),r(2),s(3,"transloco"),o(),n(4,"code",58),r(5),o()()),t&2){let l=v();i(2),m("",d(3,2,"admin.operations.worker_block.worker_ip"),":"),i(3),_(l.ipaddr)}}function Ue(t,c){if(t&1&&(n(0,"div",90)(1,"span",86),r(2),s(3,"transloco"),o(),n(4,"span",87),r(5),o()()),t&2){let l=v();i(2),m("",d(3,3,"admin.operations.worker_block.worker_models"),":"),i(3),L("",l.models.slice(0,5).join(", "),"",l.models.length>5?" (+"+(l.models.length-5)+" more)":"")}}function Ve(t,c){if(t&1&&(n(0,"div",44)(1,"h4",83),r(2),s(3,"transloco"),o(),n(4,"div",84)(5,"div",85)(6,"span",86),r(7),s(8,"transloco"),o(),n(9,"span",87),r(10),o()(),n(11,"div",85)(12,"span",86),r(13),s(14,"transloco"),o(),n(15,"span",88),f(16,Be,2,0,"span",70)(17,De,2,0,"span",89),f(18,We,2,0,"span",59),f(19,Fe,2,0,"span",89),o()(),n(20,"div",90)(21,"span",86),r(22,"UUID:"),o(),n(23,"code",58),r(24),o()(),n(25,"div",85)(26,"span",86),r(27),s(28,"transloco"),o(),n(29,"span",87),r(30),o()(),n(31,"div",85)(32,"span",86),r(33),s(34,"transloco"),o(),f(35,Le,2,0,"span",70)(36,Re,2,0,"span",89),o(),f(37,$e,6,4,"div",90),f(38,Ae,6,4,"div",90),f(39,Ue,6,5,"div",90),o()()),t&2){let l=c;i(2),_(d(3,15,"admin.operations.worker_block.selected_worker")),i(5),m("",d(8,17,"admin.operations.worker_block.worker_name"),":"),i(3),_(l.name),i(3),m("",d(14,19,"admin.operations.worker_block.worker_status"),":"),i(3),k(l.online?16:17),i(2),k(l.maintenance_mode?18:-1),i(),k(l.paused?19:-1),i(5),_(l.id),i(3),m("",d(28,21,"admin.operations.worker_block.worker_type"),":"),i(3),_(l.type),i(3),m("",d(34,23,"admin.operations.worker_block.worker_trusted"),":"),i(2),k(l.trusted?35:36),i(2),k(l.owner?37:-1),i(),k(l.ipaddr?38:-1),i(),k(l.models&&l.models.length>0?39:-1)}}function Me(t,c){t&1&&(r(0),s(1,"transloco")),t&2&&m(" ",d(1,1,"admin.operations.worker_block.looking_up")," ")}function He(t,c){t&1&&(r(0),s(1,"transloco")),t&2&&m(" ",d(1,1,"admin.operations.worker_block.lookup_worker")," ")}function Qe(t,c){if(t&1){let l=D();n(0,"div",91)(1,"span",93),r(2),s(3,"transloco"),o(),n(4,"button",94),x("click",function(){E(l);let p=v(2);return P(p.lookupWorkerByUUID())}),f(5,Me,2,3)(6,He,2,3),o()()}if(t&2){let l=v(2);i(2),_(d(3,3,"admin.operations.worker_block.uuid_detected")),i(2),g("disabled",l.fetchingWorkerInfo()),i(),k(l.fetchingWorkerInfo()?5:6)}}function je(t,c){if(t&1&&(n(0,"p",92),T(),n(1,"svg",31),y(2,"path",32),o(),r(3),o()),t&2){let l=v(2);i(3),m(" ",l.workerFetchError()," ")}}function Ke(t,c){if(t&1&&(n(0,"div",44),f(1,Qe,7,5,"div",91),f(2,je,4,1,"p",92),o()),t&2){let l=v();i(),k(l.isUUIDFormat()?1:-1),i(),k(l.workerFetchError()?2:-1)}}function Ge(t,c){if(t&1&&(n(0,"div",46)(1,"div",95)(2,"div",85)(3,"span",86),r(4),s(5,"transloco"),o(),n(6,"code",58),r(7),o()(),n(8,"div",85)(9,"span",86),r(10),s(11,"transloco"),o(),n(12,"span",59),r(13),o()()()()),t&2){let l=c,e=v();i(4),m("",d(5,4,"admin.operations.ip_timeouts.table.ip"),":"),i(3),_(l.ipaddr),i(3),m("",d(11,6,"admin.operations.ip_timeouts.table.remaining"),":"),i(3),_(e.formatDuration(l.seconds))}}function qe(t,c){if(t&1&&(n(0,"option",23),r(1),o()),t&2){let l=c.$implicit;g("value",l),i(),L("",l," ",l===1?"hour":"hours")}}function ze(t,c){if(t&1){let l=D();n(0,"div",96)(1,"div",95)(2,"div",85)(3,"span",86),r(4),s(5,"transloco"),o(),n(6,"code",58),r(7),o()(),n(8,"div",85)(9,"span",86),r(10),s(11,"transloco"),o(),n(12,"span",59),r(13),o()()()(),n(14,"div",16)(15,"label",97),r(16),s(17,"transloco"),o(),n(18,"select",98),x("change",function(p){E(l);let a=v();return P(a.onRefreshIPHoursChange(p))}),W(19,qe,2,3,"option",23,A),o()()}if(t&2){let l=c,e=v();i(4),m("",d(5,6,"admin.operations.ip_timeouts.table.ip"),":"),i(3),_(l.ipaddr),i(3),m("",d(11,8,"admin.operations.ip_timeouts.table.remaining"),":"),i(3),_(e.formatDuration(l.seconds)),i(3),m(" ",d(17,10,"admin.operations.dialog.refresh_duration")," "),i(2),g("value",e.refreshIPHours()),i(),F(e.hourOptions)}}function Ne(t,c){if(t&1&&(n(0,"div",46)(1,"div",95)(2,"div",85)(3,"span",86),r(4),s(5,"transloco"),o(),n(6,"span",87),r(7),o()(),n(8,"div",85)(9,"span",86),r(10,"ID:"),o(),n(11,"code",99),r(12),o()(),n(13,"div",85)(14,"span",86),r(15),s(16,"transloco"),o(),n(17,"span",59),r(18),o()()()()),t&2){let l=c,e=v();i(4),m("",d(5,6,"admin.operations.worker_block.worker_label"),":"),i(3),_(l.name),i(5),_(l.id),i(3),m("",d(16,8,"admin.operations.worker_block.days_label"),":"),i(3),L("",e.blockDays()," ",e.blockDays()===1?"day":"days")}}function Ye(t,c){if(t&1&&(n(0,"div",46)(1,"div",95)(2,"div",85)(3,"span",86),r(4),s(5,"transloco"),o(),n(6,"span",87),r(7),o()(),n(8,"div",85)(9,"span",86),r(10,"ID:"),o(),n(11,"code",99),r(12),o()()()()),t&2){let l=c;i(4),m("",d(5,3,"admin.operations.worker_block.worker_label"),":"),i(3),_(l.name),i(5),_(l.id)}}var gt=(()=>{let c=class c{constructor(){this.title=S(N),this.translator=S(X),this.destroyRef=S(G),this.operationsService=S(ae),this.workerService=S(ie),this.auth=S(V),this.ipTimeouts=h([]),this.loadingTimeouts=h(!1),this.searchQuery=h(""),this.addIPAddress=h(""),this.addIPHours=h(24),this.addingIP=h(!1),this.addIPWarning=U(()=>{let e=this.addIPAddress().trim();return!e||e.includes("/")?null:e.match(/\.0$/)?"This IP ends in .0 - did you forget to add a CIDR mask (e.g., /24)?":e.match(/::$/)?"This IP ends in :: - did you forget to add a CIDR mask (e.g., /64)?":null}),this.checkIPAddress=h(""),this.checkResult=h(void 0),this.checkingIP=h(!1),this.workers=h([]),this.loadingWorkers=h(!1),this.workerSearchQuery=h(""),this.selectedWorker=h(null),this.blockDays=h(1),this.blockingWorker=h(!1),this.workerDropdownOpen=h(!1),this.fetchingWorkerInfo=h(!1),this.workerFetchError=h(null),this.dialogOpen=h(!1),this.dialogType=h("deleteIP"),this.selectedIPForDelete=h(null),this.selectedIPForRefresh=h(null),this.refreshIPHours=h(24),this.selectedWorkerForUnblock=h(null),this.isDialogLoading=h(!1),this.toasts=h([]),this.hourOptions=[720,336,168,72,48,24,12,8,4,2,1],this.dayOptions=Array.from({length:30},(e,p)=>p+1),this.filteredTimeouts=U(()=>{let e=this.searchQuery().toLowerCase().trim();return e?this.ipTimeouts().filter(p=>p.ipaddr.toLowerCase().includes(e)):this.ipTimeouts()}),this.filteredWorkers=U(()=>{let e=this.workerSearchQuery().toLowerCase().trim();return e?this.workers().filter(p=>p.name.toLowerCase().includes(e)||p.id.toLowerCase().includes(e)).slice(0,50):this.workers().slice(0,50)})}ngOnInit(){j([this.translator.get("admin.operations.title"),this.translator.get("app_title")]).pipe(I(this.destroyRef)).subscribe(([e,p])=>{this.title.setTitle(`${e} | ${p}`)}),this.loadIPTimeouts(),this.loadWorkers()}loadIPTimeouts(){this.loadingTimeouts.set(!0),this.operationsService.getIPTimeouts().pipe(I(this.destroyRef),w(()=>this.loadingTimeouts.set(!1))).subscribe({next:e=>{this.ipTimeouts.set(e)},error:()=>{this.showToast("error","Failed to load IP timeouts.")}})}onSearchChange(e){let p=e.target;this.searchQuery.set(p.value)}formatDuration(e){if(e<60)return`${e}s`;if(e<3600)return`${Math.floor(e/60)}m`;if(e<86400)return`${Math.floor(e/3600)}h ${Math.floor(e%3600/60)}m`;let p=Math.floor(e/86400),a=Math.floor(e%86400/3600);return`${p}d ${a}h`}openDeleteIPDialog(e){this.selectedIPForDelete.set(e),this.dialogType.set("deleteIP"),this.dialogOpen.set(!0)}openRefreshIPDialog(e){this.selectedIPForRefresh.set(e),this.refreshIPHours.set(24),this.dialogType.set("refreshIP"),this.dialogOpen.set(!0)}onRefreshIPHoursChange(e){let p=e.target;this.refreshIPHours.set(parseInt(p.value,10))}onAddIPAddressChange(e){let p=e.target;this.addIPAddress.set(p.value)}onAddIPHoursChange(e){let p=e.target;this.addIPHours.set(parseInt(p.value,10))}addIPTimeout(){let e=this.addIPAddress().trim();if(!e){this.showToast("error","IP address is required.");return}e.includes("/")||(e.includes(":")?e=`${e}/128`:e=`${e}/32`),this.addingIP.set(!0),this.operationsService.addIPTimeout({ipaddr:e,hours:this.addIPHours()}).pipe(I(this.destroyRef),w(()=>this.addingIP.set(!1))).subscribe({next:p=>{p?(this.showToast("success","IP timeout added successfully."),this.addIPAddress.set(""),this.loadIPTimeouts()):this.showToast("error","Failed to add IP timeout.")},error:()=>{this.showToast("error","Failed to add IP timeout.")}})}onCheckIPAddressChange(e){let p=e.target;this.checkIPAddress.set(p.value),this.checkResult.set(void 0)}checkIP(){let e=this.checkIPAddress().trim();if(!e){this.showToast("error","IP address is required.");return}this.checkingIP.set(!0),this.checkResult.set(void 0),this.operationsService.getIPTimeout(e).pipe(I(this.destroyRef),w(()=>this.checkingIP.set(!1))).subscribe({next:p=>{this.checkResult.set(p)},error:()=>{this.showToast("error","Failed to check IP.")}})}clearCheckResult(){this.checkIPAddress.set(""),this.checkResult.set(void 0)}loadWorkers(){this.loadingWorkers.set(!0),this.workerService.getWorkers().pipe(I(this.destroyRef),w(()=>this.loadingWorkers.set(!1))).subscribe({next:e=>{this.workers.set(e)},error:()=>{this.showToast("error","Failed to load workers.")}})}onWorkerSearchChange(e){let a=e.target.value;this.workerSearchQuery.set(a),this.workerDropdownOpen.set(!0),this.workerFetchError.set(null),a.trim()||this.selectedWorker.set(null)}selectWorker(e){this.selectedWorker.set(e),this.workerSearchQuery.set(`${e.name} (${e.id.slice(0,8)}...)`),this.workerDropdownOpen.set(!1)}clearWorkerSelection(){this.selectedWorker.set(null),this.workerSearchQuery.set(""),this.workerFetchError.set(null)}lookupWorkerByUUID(){let e=this.workerSearchQuery().trim();if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)){this.workerFetchError.set("Invalid UUID format. Expected format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx");return}let a=this.workers().find(u=>u.id.toLowerCase()===e.toLowerCase());if(a){this.selectWorker(a);return}this.fetchingWorkerInfo.set(!0),this.workerFetchError.set(null),this.workerService.getWorker(e).pipe(I(this.destroyRef),w(()=>this.fetchingWorkerInfo.set(!1))).subscribe({next:u=>{u?this.selectWorker(u):this.workerFetchError.set("Worker not found with this UUID.")},error:()=>{this.workerFetchError.set("Failed to fetch worker information.")}})}isUUIDFormat(){let e=this.workerSearchQuery().trim();return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}onBlockDaysChange(e){let p=e.target;this.blockDays.set(parseInt(p.value,10))}openBlockWorkerDialog(){if(!this.selectedWorker()){this.showToast("error","Please select a worker first.");return}this.dialogType.set("blockWorker"),this.dialogOpen.set(!0)}openUnblockWorkerDialog(e){this.selectedWorkerForUnblock.set(e),this.dialogType.set("unblockWorker"),this.dialogOpen.set(!0)}closeDialog(){this.dialogOpen.set(!1),this.selectedIPForDelete.set(null),this.selectedIPForRefresh.set(null),this.selectedWorkerForUnblock.set(null)}confirmDialog(){let e=this.dialogType();e==="deleteIP"?this.confirmDeleteIP():e==="refreshIP"?this.confirmRefreshIP():e==="blockWorker"?this.confirmBlockWorker():e==="unblockWorker"&&this.confirmUnblockWorker()}confirmDeleteIP(){let e=this.selectedIPForDelete();e&&(this.isDialogLoading.set(!0),this.operationsService.removeIPTimeout(e.ipaddr).pipe(I(this.destroyRef),w(()=>this.isDialogLoading.set(!1))).subscribe({next:p=>{p?(this.showToast("success","IP timeout removed successfully."),this.closeDialog(),this.loadIPTimeouts()):this.showToast("error","Failed to remove IP timeout.")},error:()=>{this.showToast("error","Failed to remove IP timeout.")}}))}confirmRefreshIP(){let e=this.selectedIPForRefresh();e&&(this.isDialogLoading.set(!0),this.operationsService.addIPTimeout({ipaddr:e.ipaddr,hours:this.refreshIPHours()}).pipe(I(this.destroyRef),w(()=>this.isDialogLoading.set(!1))).subscribe({next:p=>{p?(this.showToast("success","IP timeout refreshed successfully."),this.closeDialog(),this.loadIPTimeouts()):this.showToast("error","Failed to refresh IP timeout.")},error:()=>{this.showToast("error","Failed to refresh IP timeout.")}}))}confirmBlockWorker(){let e=this.selectedWorker();e&&(this.isDialogLoading.set(!0),this.operationsService.blockWorkerIP(e.id,this.blockDays()).pipe(I(this.destroyRef),w(()=>this.isDialogLoading.set(!1))).subscribe({next:p=>{p?(this.showToast("success",`Worker "${e.name}" IP blocked for ${this.blockDays()} day(s).`),this.closeDialog(),this.clearWorkerSelection()):this.showToast("error","Failed to block worker IP.")},error:()=>{this.showToast("error","Failed to block worker IP.")}}))}confirmUnblockWorker(){let e=this.selectedWorkerForUnblock();e&&(this.isDialogLoading.set(!0),this.operationsService.unblockWorkerIP(e.id).pipe(I(this.destroyRef),w(()=>this.isDialogLoading.set(!1))).subscribe({next:p=>{p?(this.showToast("success",`Worker "${e.name}" IP block removed.`),this.closeDialog()):this.showToast("error","Failed to unblock worker IP.")},error:()=>{this.showToast("error","Failed to unblock worker IP.")}}))}showToast(e,p,a=e==="success"){let u=`toast-${Date.now()}-${Math.random().toString(36).slice(2,7)}`;this.toasts.update(b=>[...b,{id:u,type:e,message:p}]),a&&setTimeout(()=>this.dismissToast(u),3e3)}dismissToast(e){this.toasts.update(p=>p.filter(a=>a.id!==e))}hasUnsavedChanges(){return this.dialogOpen()}onWorkerDropdownBlur(){setTimeout(()=>{this.workerDropdownOpen.set(!1)},200)}onWorkerInputFocus(){this.workerDropdownOpen.set(!0)}};c.\u0275fac=function(p){return new(p||c)},c.\u0275cmp=q({type:c,selectors:[["app-operations"]],decls:146,vars:159,consts:[[1,"admin-container-lg"],[1,"admin-header"],[1,"admin-heading-page"],["type","button",1,"btn-muted",3,"click","disabled"],[1,"mb-8"],[1,"admin-heading-section","mb-4"],[1,"admin-text-muted","mb-4"],[1,"filter-controls","mb-4"],[1,"filter-search"],["type","text",1,"form-input",3,"input","value","placeholder"],[1,"admin-loading"],[1,"admin-empty"],[1,"panel","overflow-hidden"],[1,"admin-grid-2-col"],[1,"panel","p-6"],[1,"stack-md"],[1,"form-group"],["for","add-ip-address",1,"form-label"],[1,"admin-text-red"],["id","add-ip-address","type","text",1,"form-input",3,"input","value","placeholder"],[1,"admin-text-warning","text-sm","mt-1"],["for","add-ip-hours",1,"form-label"],["id","add-ip-hours",1,"form-select",3,"change","value"],[3,"value"],["type","button",1,"btn-primary",3,"click","disabled"],["for","check-ip-address",1,"form-label"],["id","check-ip-address","type","text",1,"form-input",3,"input","value","placeholder"],[1,"admin-form-actions"],["type","button",1,"btn-primary","flex-1",3,"click","disabled"],["type","button",1,"btn-muted"],[1,"admin-text-warning","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"admin-icon-inline"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"],[1,"panel","p-6","max-w-3xl","overflow-visible"],[1,"admin-form-row"],[1,"form-group","flex-1"],["for","worker-search",1,"form-label"],[1,"relative"],["id","worker-search","type","text","autocomplete","off",1,"form-input",3,"input","focus","blur","value","placeholder"],["type","button",1,"input-clear-btn",3,"title"],[1,"worker-dropdown"],["for","block-days",1,"form-label"],["id","block-days",1,"form-select",3,"change","value"],["type","button",1,"btn-danger",3,"click","disabled"],[1,"admin-section-divider"],["variant","danger",3,"confirm","cancel","open","title","confirmLabel","cancelLabel","loading","loadingLabel"],[1,"panel","p-4"],[3,"confirm","cancel","open","title","confirmLabel","cancelLabel","loading","loadingLabel"],[3,"dismiss","toasts"],["fill","none","viewBox","0 0 24 24","aria-hidden","true",1,"admin-spinner"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"admin-spinner-track"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"admin-spinner-head"],[1,"admin-loading-text"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"admin-empty-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"admin-empty-text"],[1,"data-table-wrapper"],[1,"data-table"],[1,"data-table-mono","data-table-mono-primary"],[1,"badge-base","badge-warning"],[1,"data-table-actions"],["type","button",1,"btn-icon",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],["type","button",1,"btn-icon","btn-icon-danger",3,"click","title"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],["type","button",1,"btn-muted",3,"click"],[1,"test-result","test-result-safe"],[1,"test-result","test-result-blocked"],[1,"test-result-header"],[1,"badge-base","badge-success"],[1,"admin-text-muted","ml-2"],[1,"badge-base","badge-danger"],["type","button",1,"input-clear-btn",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"icon-sm"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"worker-dropdown-loading"],["type","button",1,"worker-dropdown-item"],["type","button",1,"worker-dropdown-item",3,"mousedown"],[1,"worker-dropdown-name"],[1,"worker-dropdown-id"],[1,"badge-base","badge-success","ml-auto"],[1,"badge-base","badge-muted","ml-auto"],[1,"admin-section-title"],[1,"admin-info-grid"],[1,"admin-info-item"],[1,"admin-info-label"],[1,"admin-info-value"],[1,"badge-container"],[1,"badge-base","badge-muted"],[1,"admin-info-item","admin-info-item-full"],[1,"admin-lookup-row"],[1,"admin-text-warning","text-sm","mt-2"],[1,"admin-text-muted","text-sm"],["type","button",1,"btn-muted","btn-sm",3,"click","disabled"],[1,"stack-sm"],[1,"panel","p-4","mb-4"],["for","refresh-ip-hours",1,"form-label"],["id","refresh-ip-hours",1,"form-select",3,"change","value"],[1,"data-table-mono"]],template:function(p,a){if(p&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),r(3),s(4,"transloco"),o(),n(5,"button",3),x("click",function(){return a.loadIPTimeouts()}),r(6),s(7,"transloco"),o()(),n(8,"section",4)(9,"h2",5),r(10),s(11,"transloco"),o(),n(12,"p",6),r(13),s(14,"transloco"),o(),n(15,"div",7)(16,"div",8)(17,"input",9),s(18,"transloco"),x("input",function(b){return a.onSearchChange(b)}),o()()(),f(19,de,7,3,"div",10)(20,pe,6,3,"div",11)(21,me,17,9,"div",12),o(),n(22,"div",13)(23,"section")(24,"h2",5),r(25),s(26,"transloco"),o(),n(27,"p",6),r(28),s(29,"transloco"),o(),n(30,"div",14)(31,"div",15)(32,"div",16)(33,"label",17),r(34),s(35,"transloco"),n(36,"span",18),r(37,"*"),o()(),n(38,"input",19),s(39,"transloco"),x("input",function(b){return a.onAddIPAddressChange(b)}),o(),f(40,ue,4,1,"p",20),o(),n(41,"div",16)(42,"label",21),r(43),s(44,"transloco"),o(),n(45,"select",22),x("change",function(b){return a.onAddIPHoursChange(b)}),W(46,_e,2,3,"option",23,A),o()(),n(48,"button",24),x("click",function(){return a.addIPTimeout()}),f(49,he,2,3)(50,fe,2,3),o()()()(),n(51,"section")(52,"h2",5),r(53),s(54,"transloco"),o(),n(55,"p",6),r(56),s(57,"transloco"),o(),n(58,"div",14)(59,"div",15)(60,"div",16)(61,"label",25),r(62),s(63,"transloco"),o(),n(64,"input",26),s(65,"transloco"),x("input",function(b){return a.onCheckIPAddressChange(b)}),o()(),n(66,"div",27)(67,"button",28),x("click",function(){return a.checkIP()}),f(68,ke,2,3)(69,ge,2,3),o(),f(70,ve,3,3,"button",29),o(),f(71,Ce,3,1,"div"),o()()()(),n(72,"section",4)(73,"h2",5),r(74),s(75,"transloco"),o(),n(76,"p",6),r(77),s(78,"transloco"),o(),n(79,"p",30),T(),n(80,"svg",31),y(81,"path",32),o(),r(82),s(83,"transloco"),o(),R(),n(84,"div",33)(85,"div",34)(86,"div",35)(87,"label",36),r(88),s(89,"transloco"),n(90,"span",18),r(91,"*"),o()(),n(92,"div",37)(93,"input",38),s(94,"transloco"),x("input",function(b){return a.onWorkerSearchChange(b)})("focus",function(){return a.onWorkerInputFocus()})("blur",function(){return a.onWorkerDropdownBlur()}),o(),f(95,Ie,4,4,"button",39),f(96,Pe,3,1,"div",40),o()(),n(97,"div",16)(98,"label",41),r(99),s(100,"transloco"),o(),n(101,"select",42),x("change",function(b){return a.onBlockDaysChange(b)}),W(102,Oe,2,3,"option",23,A),o()(),n(104,"button",43),x("click",function(){return a.openBlockWorkerDialog()}),r(105),s(106,"transloco"),o()(),f(107,Ve,40,25,"div",44)(108,Ke,3,2,"div",44),o()()(),n(109,"app-admin-dialog",45),s(110,"transloco"),s(111,"transloco"),s(112,"transloco"),s(113,"transloco"),x("confirm",function(){return a.confirmDialog()})("cancel",function(){return a.closeDialog()}),n(114,"p",6),r(115),s(116,"transloco"),o(),f(117,Ge,14,8,"div",46),o(),n(118,"app-admin-dialog",47),s(119,"transloco"),s(120,"transloco"),s(121,"transloco"),s(122,"transloco"),x("confirm",function(){return a.confirmDialog()})("cancel",function(){return a.closeDialog()}),n(123,"p",6),r(124),s(125,"transloco"),o(),f(126,ze,21,12),o(),n(127,"app-admin-dialog",45),s(128,"transloco"),s(129,"transloco"),s(130,"transloco"),s(131,"transloco"),x("confirm",function(){return a.confirmDialog()})("cancel",function(){return a.closeDialog()}),n(132,"p",6),r(133),s(134,"transloco"),o(),f(135,Ne,19,10,"div",46),o(),n(136,"app-admin-dialog",47),s(137,"transloco"),s(138,"transloco"),s(139,"transloco"),s(140,"transloco"),x("confirm",function(){return a.confirmDialog()})("cancel",function(){return a.closeDialog()}),n(141,"p",6),r(142),s(143,"transloco"),o(),f(144,Ye,13,5,"div",46),o(),n(145,"app-admin-toast-bar",48),x("dismiss",function(b){return a.dismissToast(b)}),o()),p&2){let u,b,M,H,Q;i(3),_(d(4,77,"admin.operations.title")),i(2),g("disabled",a.loadingTimeouts()),i(),m(" ",d(7,79,"admin.operations.refresh")," "),i(4),m(" ",d(11,81,"admin.operations.ip_timeouts.title")," "),i(3),m(" ",d(14,83,"admin.operations.ip_timeouts.description")," "),i(4),g("placeholder",O(d(18,85,"admin.operations.ip_timeouts.search_placeholder")))("value",a.searchQuery()),i(2),k(a.loadingTimeouts()?19:a.filteredTimeouts().length===0?20:21),i(6),m(" ",d(26,87,"admin.operations.add_ip.title")," "),i(3),m(" ",d(29,89,"admin.operations.add_ip.description")," "),i(6),m(" ",d(35,91,"admin.operations.add_ip.ip_label")," "),i(4),g("placeholder",O(d(39,93,"admin.operations.add_ip.ip_placeholder")))("value",a.addIPAddress()),i(2),k(a.addIPWarning()?40:-1),i(3),m(" ",d(44,95,"admin.operations.add_ip.hours_label")," "),i(2),g("value",a.addIPHours()),i(),F(a.hourOptions),i(2),g("disabled",a.addingIP()||!a.addIPAddress().trim()),i(),k(a.addingIP()?49:50),i(4),m(" ",d(54,97,"admin.operations.check_ip.title")," "),i(3),m(" ",d(57,99,"admin.operations.check_ip.description")," "),i(6),m(" ",d(63,101,"admin.operations.check_ip.ip_label")," "),i(2),g("placeholder",O(d(65,103,"admin.operations.check_ip.ip_placeholder")))("value",a.checkIPAddress()),i(3),g("disabled",a.checkingIP()||!a.checkIPAddress().trim()),i(),k(a.checkingIP()?68:69),i(2),k(a.checkResult()!==void 0?70:-1),i(),k(a.checkResult()!==void 0?71:-1),i(3),m(" ",d(75,105,"admin.operations.worker_block.title")," "),i(3),m(" ",d(78,107,"admin.operations.worker_block.description")," "),i(5),m(" ",d(83,109,"admin.operations.worker_block.active_workers_note")," "),i(6),m(" ",d(89,111,"admin.operations.worker_block.worker_label")," "),i(5),g("placeholder",O(d(94,113,"admin.operations.worker_block.worker_placeholder")))("value",a.workerSearchQuery()),i(2),k(a.selectedWorker()?95:-1),i(),k(a.workerDropdownOpen()&&!a.selectedWorker()&&a.filteredWorkers().length>0?96:-1),i(3),m(" ",d(100,115,"admin.operations.worker_block.days_label")," "),i(2),g("value",a.blockDays()),i(),F(a.dayOptions),i(2),g("disabled",a.blockingWorker()||!a.selectedWorker()),i(),m(" ",d(106,117,"admin.operations.worker_block.block_button")," "),i(2),k((u=a.selectedWorker())?107:!a.selectedWorker()&&a.workerSearchQuery().trim()&&!a.workerDropdownOpen()?108:-1,u),i(2),g("open",a.dialogOpen()&&a.dialogType()==="deleteIP")("title",d(110,119,"admin.operations.dialog.delete_ip_title"))("confirmLabel",d(111,121,"admin.operations.dialog.delete"))("cancelLabel",d(112,123,"admin.operations.dialog.cancel"))("loading",a.isDialogLoading())("loadingLabel",d(113,125,"admin.operations.dialog.deleting")),i(6),m(" ",d(116,127,"admin.operations.dialog.delete_ip_confirm")," "),i(2),k((b=a.selectedIPForDelete())?117:-1,b),i(),g("open",a.dialogOpen()&&a.dialogType()==="refreshIP")("title",d(119,129,"admin.operations.dialog.refresh_ip_title"))("confirmLabel",d(120,131,"admin.operations.dialog.refresh"))("cancelLabel",d(121,133,"admin.operations.dialog.cancel"))("loading",a.isDialogLoading())("loadingLabel",d(122,135,"admin.operations.dialog.refreshing")),i(6),m(" ",d(125,137,"admin.operations.dialog.refresh_ip_confirm")," "),i(2),k((M=a.selectedIPForRefresh())?126:-1,M),i(),g("open",a.dialogOpen()&&a.dialogType()==="blockWorker")("title",d(128,139,"admin.operations.dialog.block_worker_title"))("confirmLabel",d(129,141,"admin.operations.dialog.block"))("cancelLabel",d(130,143,"admin.operations.dialog.cancel"))("loading",a.isDialogLoading())("loadingLabel",d(131,145,"admin.operations.dialog.blocking")),i(6),m(" ",d(134,147,"admin.operations.dialog.block_worker_confirm")," "),i(2),k((H=a.selectedWorker())?135:-1,H),i(),g("open",a.dialogOpen()&&a.dialogType()==="unblockWorker")("title",d(137,149,"admin.operations.dialog.unblock_worker_title"))("confirmLabel",d(138,151,"admin.operations.dialog.unblock"))("cancelLabel",d(139,153,"admin.operations.dialog.cancel"))("loading",a.isDialogLoading())("loadingLabel",d(140,155,"admin.operations.dialog.unblocking")),i(6),m(" ",d(143,157,"admin.operations.dialog.unblock_worker_confirm")," "),i(2),k((Q=a.selectedWorkerForUnblock())?144:-1,Q),i(),g("toasts",a.toasts())}},dependencies:[Y,J,te,Z,ee,oe,ne],encapsulation:2,changeDetection:0});let t=c;return t})();export{gt as OperationsComponent};
