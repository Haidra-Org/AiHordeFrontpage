import{e as N}from"./chunk-J27YOVZ5.js";import{a as J}from"./chunk-Z4QX4XJM.js";import"./chunk-T6V27EFK.js";import{a as W}from"./chunk-ISHBUXAM.js";import{a as z}from"./chunk-VFTR325L.js";import{c as Q}from"./chunk-BMIYH3UD.js";import{g as O,l as q}from"./chunk-3GXWXVSS.js";import{k as A}from"./chunk-GZDNXZTC.js";import{Cb as K,Db as S,K as $,Oa as t,Ob as H,Rb as d,Sb as f,Tb as _,X as L,Za as V,aa as P,ba as R,ca as I,da as T,ga as F,gb as Z,gc as p,hc as c,ja as b,nc as Y,ob as x,p as C,pb as g,q as y,r as G,rb as U,sb as j,tb as w,ub as n,vb as o,wb as k,x as M,zb as D}from"./chunk-QF4LG6ZD.js";import{d as B}from"./chunk-4CLCTAJ7.js";var ee=(e,i)=>i.id;function te(e,i){e&1&&k(0,"div",3)}function ie(e,i){e&1&&(I(),n(0,"svg",4),k(1,"path",8),o())}function ne(e,i){if(e&1){let m=D();n(0,"div",5),I(),n(1,"svg",9),k(2,"path",10),o(),T(),n(3,"p"),d(4),o(),n(5,"button",11),K("click",function(){P(m);let u=S();return R(u.loadLeaderboard())}),d(6),p(7,"transloco"),o()()}if(e&2){let m=S();t(4),f(m.error()),t(2),_(" ",c(7,2,"details.leaderboard.retry")," ")}}function ae(e,i){e&1&&(n(0,"div",6),k(1,"div",12),n(2,"p"),d(3),p(4,"transloco"),o()()),e&2&&(t(3),f(c(4,1,"details.leaderboard.loading")))}function oe(e,i){e&1&&(n(0,"div",41),I(),n(1,"svg",42),k(2,"path",17),o(),T(),n(3,"span"),d(4),p(5,"transloco"),o()()),e&2&&(t(4),f(c(5,1,"details.leaderboard.thank_you_message")))}function re(e,i){if(e&1&&(n(0,"div",20)(1,"div",37)(2,"div",38)(3,"span",39),d(4),p(5,"transloco"),o(),n(6,"span",40),d(7),p(8,"number"),o()(),x(9,oe,6,3,"div",41),o()()),e&2){let m=S(2);t(4),f(c(5,3,"details.leaderboard.your_rank")),t(3),_("#",c(8,5,m.userRank())),t(2),g(m.showThankYou()?9:-1)}}function de(e,i){e&1&&(k(0,"div",3),d(1),p(2,"transloco")),e&2&&(t(),_(" ",c(2,1,"details.leaderboard.searching")," "))}function le(e,i){e&1&&(d(0),p(1,"transloco")),e&2&&_(" ",c(1,1,"details.leaderboard.login_to_rate")," ")}function se(e,i){e&1&&(d(0),p(1,"transloco")),e&2&&_(" ",c(1,1,"details.leaderboard.find_my_rank_button")," ")}function pe(e,i){e&1&&d(0," \u{1F947} ")}function ce(e,i){e&1&&d(0," \u{1F948} ")}function me(e,i){e&1&&d(0," \u{1F949} ")}function ue(e,i){if(e&1&&d(0),e&2){let m=S().$index;_(" ",m+1," ")}}function _e(e,i){if(e&1&&(n(0,"div",35)(1,"div",43)(2,"span",44),x(3,pe,1,0)(4,ce,1,0)(5,me,1,0)(6,ue,1,1),o()(),n(7,"div",45)(8,"span",46),d(9),o()(),n(10,"div",43)(11,"span",47),d(12),p(13,"transloco"),o(),n(14,"span",48),d(15),p(16,"number"),o()()()),e&2){let m=i.$implicit,a=i.$index;t(2),H("rank-1",a===0)("rank-2",a===1)("rank-3",a===2),t(),g(a===0?3:a===1?4:a===2?5:6),t(5),w("title",m.username),t(),_(" ",m.username," "),t(3),f(c(13,11,"details.leaderboard.kudos")),t(3),_(" ",c(16,13,m.kudos)," ")}}function he(e,i){if(e&1){let m=D();n(0,"div",13)(1,"div",14)(2,"div",15),I(),n(3,"svg",16),k(4,"path",17),o(),T(),n(5,"div")(6,"h3",18),d(7),p(8,"transloco"),o(),n(9,"p",19),d(10),p(11,"transloco"),o()()()(),n(12,"div",20)(13,"h3",21),d(14),p(15,"transloco"),o(),n(16,"div",22)(17,"p"),d(18),p(19,"transloco"),o(),n(20,"p",23),d(21),p(22,"transloco"),o(),n(23,"p",23)(24,"a",24),d(25),p(26,"transloco"),o()()()()(),n(27,"div",25)(28,"div",26)(29,"div",27)(30,"h3",21),d(31),p(32,"transloco"),o(),n(33,"p",28),d(34),p(35,"transloco"),o()(),x(36,re,10,7,"div",20),n(37,"div",29)(38,"button",30),p(39,"transloco"),K("click",function(){P(m);let u=S();return R(u.findMyRank())}),x(40,de,3,3)(41,le,2,3)(42,se,2,3),o()()()(),n(43,"div",31)(44,"div",32)(45,"span",33),d(46),p(47,"transloco"),o(),n(48,"span",33),d(49),p(50,"transloco"),o(),n(51,"span",34),d(52),p(53,"transloco"),o()(),U(54,_e,17,15,"div",35,ee),o(),n(56,"div",14)(57,"p",36),d(58),p(59,"transloco"),o()()}if(e&2){let m=S();t(7),_(" ",c(8,18,"details.leaderboard.appreciation_title")," "),t(3),_(" ",c(11,20,"details.leaderboard.appreciation_message")," "),t(4),_(" ",c(15,22,"details.leaderboard.what_kudos_represent")," "),t(4),f(c(19,24,"details.leaderboard.kudos_explanation_1")),t(3),_(" ",c(22,26,"details.leaderboard.kudos_explanation_2")," "),t(4),_(" ",c(26,28,"details.leaderboard.learn_more_faq")," "),t(6),_(" ",c(32,30,"details.leaderboard.find_my_rank")," "),t(3),_(" ",c(35,32,"details.leaderboard.find_my_rank_description")," "),t(2),g(m.rankSearched()&&m.userRank()!==null?36:-1),t(2),H("btn-disabled",!m.isLoggedIn()),w("disabled",!m.isLoggedIn()||m.searchingRank())("title",m.isLoggedIn()?"":c(39,34,"details.leaderboard.login_to_rate")),t(2),g(m.searchingRank()?40:m.isLoggedIn()?42:41),t(6),f(c(47,36,"details.leaderboard.rank")),t(3),f(c(50,38,"details.leaderboard.username")),t(3),f(c(53,40,"details.leaderboard.kudos")),t(2),j(m.users()),t(4),_(" ",c(59,42,"details.leaderboard.footer_note")," ")}}function fe(e,i){e&1&&(n(0,"div",7)(1,"p"),d(2),p(3,"transloco"),o()()),e&2&&(t(2),f(c(3,1,"details.leaderboard.no_users")))}var Ke=(()=>{let i=class i{constructor(){this.title=L(q),this.translator=L(W),this.aiHorde=L(z),this.auth=L(J),this.destroyRef=L(F),this.loading=b(!1),this.pagesLoaded=b(0),this.error=b(null),this.users=b([]),this.totalKudos=Y(()=>this.users().reduce((a,u)=>a+u.kudos,0)),this.isLoggedIn=this.auth.isLoggedIn,this.currentUser=this.auth.currentUser,this.searchingRank=b(!1),this.userRank=b(null),this.rankSearched=b(!1),this.showThankYou=b(!1),Z(()=>{this.loadLeaderboard()})}ngOnInit(){G([this.translator.get("details.leaderboard.title"),this.translator.get("app_title")]).pipe(A(this.destroyRef)).subscribe(([a,u])=>{this.title.setTitle(`${a} | ${u}`)})}loadLeaderboard(){this.loading.set(!0),this.error.set(null),this.users.set([]),this.pagesLoaded.set(0);let a=this.aiHorde.getKudosLeaderboard(1,25).pipe(y(r=>({page:1,users:r}))),u=this.aiHorde.getKudosLeaderboard(2,25).pipe(y(r=>({page:2,users:r}))),s=this.aiHorde.getKudosLeaderboard(3,25).pipe(y(r=>({page:3,users:r}))),h=this.aiHorde.getKudosLeaderboard(4,25).pipe(y(r=>({page:4,users:r})));M(a,u,s,h).pipe(A(this.destroyRef),$((r,v)=>(r.pages[v.page]=v.users,r.loadedCount++,r),{pages:{},loadedCount:0})).subscribe({next:r=>{let v=[];for(let l=1;l<=i.TOTAL_PAGES;l++)r.pages[l]&&v.push(...r.pages[l]);this.users.set(v),this.pagesLoaded.set(r.loadedCount),r.loadedCount>=i.TOTAL_PAGES&&this.loading.set(!1)},error:()=>{this.error.set("Failed to load kudos leaderboard"),this.loading.set(!1)}})}findMyRank(){return B(this,null,function*(){let a=this.currentUser();if(a){this.searchingRank.set(!0),this.userRank.set(null),this.rankSearched.set(!1),this.showThankYou.set(!1);try{let u=yield this.binarySearchRank(a.kudos,a.id);this.userRank.set(u),this.rankSearched.set(!0),this.showThankYou.set(!0)}catch{this.userRank.set(null),this.rankSearched.set(!0),this.showThankYou.set(!1)}finally{this.searchingRank.set(!1)}}})}binarySearchRank(a,u){return B(this,null,function*(){let s=1,h=1,r=yield C(this.aiHorde.getKudosLeaderboardPage(h));for(;r.length===i.PAGE_SIZE&&!(r[r.length-1].kudos<a);)s=h,h*=2,r=yield C(this.aiHorde.getKudosLeaderboardPage(h));for(;s<h;){let l=Math.floor((s+h)/2);if(r=yield C(this.aiHorde.getKudosLeaderboardPage(l)),r.length===0){h=l;continue}let E=r[0].kudos,X=r[r.length-1].kudos;a>E?h=l:a<X?s=l+1:(s=l,h=l)}r=yield C(this.aiHorde.getKudosLeaderboardPage(s));for(let l=0;l<r.length;l++)if(r[l].id===u)return(s-1)*i.PAGE_SIZE+l+1;if(s>1){let l=yield C(this.aiHorde.getKudosLeaderboardPage(s-1));for(let E=0;E<l.length;E++)if(l[E].id===u)return(s-2)*i.PAGE_SIZE+E+1}let v=yield C(this.aiHorde.getKudosLeaderboardPage(s+1));for(let l=0;l<v.length;l++)if(v[l].id===u)return s*i.PAGE_SIZE+l+1;for(let l=0;l<r.length;l++)if(r[l].kudos<=a)return(s-1)*i.PAGE_SIZE+l+1;return(s-1)*i.PAGE_SIZE+r.length+1})}formatKudos(a){return a>=1e9?(a/1e9).toFixed(1)+"B":a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a.toLocaleString()}};i.PAGE_SIZE=25,i.TOTAL_PAGES=4,i.\u0275fac=function(u){return new(u||i)},i.\u0275cmp=V({type:i,selectors:[["app-kudos-leaderboard"]],decls:11,vars:9,consts:[[1,"stack-lg"],[1,"details-tabs"],["type","button",1,"btn-source-control",3,"click","disabled"],["aria-hidden","true",1,"spinner","spinner-sm"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"icon-sm"],[1,"state-container","state-container-sm","state-error"],[1,"state-container","state-container-sm","text-secondary"],[1,"state-container","state-container-sm","state-muted"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"state-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"],["type","button",1,"btn-source-control",3,"click"],[1,"spinner","spinner-md"],[1,"usage-totals-grid"],[1,"card","card-bg-secondary"],[1,"flex","items-start","gap-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"icon-sm","text-brand-purple","flex-shrink-0","mt-0.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"],[1,"font-semibold","text-primary"],[1,"text-secondary","text-sm","mt-1"],[1,"card","card-bg-primary"],[1,"heading-card"],[1,"prose-content","text-sm"],[1,"mt-2"],["routerLink","/faq",1,"link"],[1,"card","card-bg-secondary","card-full"],[1,"stack-sm"],[1,"text-center"],[1,"text-secondary","text-sm"],[1,"flex","justify-center"],["type","button",1,"btn-primary",3,"click","disabled","title"],[1,"models-table"],[1,"models-table-header","leaderboard-table-header"],[1,"models-table-th"],[1,"models-table-th","models-table-th-right"],[1,"models-table-row","leaderboard-table-row"],[1,"text-secondary","text-sm","text-center"],[1,"flex","flex-col","items-center","gap-3"],[1,"flex","flex-col","items-center","gap-1"],[1,"text-secondary","text-sm","font-medium"],[1,"text-5xl","font-bold","text-primary",2,"font-variant-numeric","tabular-nums"],[1,"flex","items-center","gap-2","text-brand-purple","text-sm","font-medium"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","aria-hidden","true",1,"icon-sm","flex-shrink-0"],[1,"models-table-cell"],[1,"model-rank-badge"],[1,"models-table-cell-name"],[1,"models-table-name",3,"title"],[1,"models-table-label"],[1,"models-table-value"]],template:function(u,s){u&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),K("click",function(){return s.loadLeaderboard()}),x(3,te,1,0,"div",3)(4,ie,2,0,":svg:svg",4),d(5),p(6,"transloco"),o()(),x(7,ne,8,4,"div",5),x(8,ae,5,3,"div",6),x(9,he,60,44),x(10,fe,4,3,"div",7),o()),u&2&&(t(2),w("disabled",s.loading()),t(),g(s.loading()?3:4),t(2),_(" ",c(6,7,"details.leaderboard.refresh")," "),t(2),g(s.error()?7:-1),t(),g(s.loading()&&!s.error()?8:-1),t(),g(!s.loading()&&!s.error()&&s.users().length>0?9:-1),t(),g(!s.loading()&&!s.error()&&s.users().length===0?10:-1))},dependencies:[Q,O,N],encapsulation:2,changeDetection:0});let e=i;return e})();export{Ke as KudosLeaderboardComponent};
