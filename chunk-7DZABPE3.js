import{a as ve}from"./chunk-7MWK4MZ2.js";import{a as ge}from"./chunk-OXDKZCOM.js";import{a as Ce}from"./chunk-DGWH4BQN.js";import{a as xe}from"./chunk-FJFZRYE7.js";import"./chunk-2GSLEGZS.js";import{a as he}from"./chunk-UQV72EDM.js";import{b as ce}from"./chunk-J27YOVZ5.js";import{a as fe}from"./chunk-BQ3SFYXW.js";import{a as N,b as R}from"./chunk-TWRQSRNJ.js";import{u as ue}from"./chunk-7P7BAAIV.js";import{a as j}from"./chunk-Z4QX4XJM.js";import"./chunk-T6V27EFK.js";import{a as _e}from"./chunk-ISHBUXAM.js";import"./chunk-VFTR325L.js";import{c as pe,d as me}from"./chunk-BMIYH3UD.js";import{e as re,l as de}from"./chunk-3GXWXVSS.js";import{c as $,g as le,k as I}from"./chunk-GZDNXZTC.js";import{$b as A,A as z,Cb as v,Db as m,F as P,Ja as J,Oa as t,Ob as k,Rb as r,S as ee,Sb as _,Tb as h,Ub as W,X as T,Za as ne,aa as g,ba as f,ca as w,cb as ae,da as B,dc as q,ga as te,gc as l,hc as d,ic as G,ja as C,k as F,lb as oe,mb as se,nb as b,nc as E,ob as u,pb as x,q as Y,qb as L,r as X,rb as K,sb as H,ta as ie,tb as U,ub as n,vb as o,w as Z,wb as S,zb as V}from"./chunk-QF4LG6ZD.js";import"./chunk-4CLCTAJ7.js";var Se=(()=>{let p=class p{constructor(){this.httpClient=T(le),this.auth=T(j),this.baseUrl="https://aihorde.net/api/v2"}getUser(i){let s=this.auth.getStoredApiKey(),c={};return s&&(c.apikey=s),this.httpClient.get(`${this.baseUrl}/users/${i}`,{headers:c}).pipe(z(()=>F(null)))}searchUsers(i){let s=this.auth.currentUser();return s&&s.username.toLowerCase().includes(i.toLowerCase())?F([{id:s.id,username:s.username}]):F([])}updateUser(i,s){let c=this.auth.getStoredApiKey();return c?this.httpClient.put(`${this.baseUrl}/users/${i}`,s,{headers:{apikey:c}}).pipe(z(()=>F(null))):F(null)}setTrusted(i,s){return this.updateUser(i,{trusted:s})}setFlagged(i,s){return this.updateUser(i,{flagged:s})}resetSuspicion(i){return this.updateUser(i,{reset_suspicion:!0})}setVpnAccess(i,s){return this.updateUser(i,{vpn:s})}setWorkerInvites(i,s){return this.updateUser(i,{worker_invite:s})}getSharedKey(i){return this.httpClient.get(`${this.baseUrl}/sharedkeys/${i}`).pipe(z(()=>F(null)))}getSharedKeysByIds(i){if(i.length===0)return F([]);let s=i.map(c=>this.getSharedKey(c).pipe(z(()=>F(null))));return Z(s).pipe(Y(c=>c.filter(y=>y!==null)))}};p.\u0275fac=function(s){return new(s||p)},p.\u0275prov=ee({token:p,factory:p.\u0275fac,providedIn:"root"});let a=p;return a})();var ye=a=>({username:a}),O=(a,p)=>p.id;function ke(a,p){a&1&&(n(0,"p",2),r(1),l(2,"transloco"),o()),a&2&&(t(),_(d(2,1,"admin.users.dialog.undelete_message")))}function Ee(a,p){if(a&1){let e=V();n(0,"div",14)(1,"div",15),v("click",function(){g(e);let s=m(2);return f(s.closeRawJsonModal())}),o(),n(2,"div",16)(3,"div",17)(4,"h3",18),r(5,"Raw JSON"),o(),n(6,"button",19),v("click",function(){g(e);let s=m(2);return f(s.closeRawJsonModal())}),r(7," Close "),o()(),n(8,"div",20)(9,"div",21)(10,"div",22),r(11,"User"),o(),S(12,"pre",23),o(),n(13,"div",21)(14,"div",22),r(15,"Workers"),o(),S(16,"pre",24),o(),n(17,"div",21)(18,"div",22),r(19,"Shared Keys"),o(),S(20,"pre",25),o(),n(21,"div",21)(22,"div",22),r(23,"Styles"),o(),S(24,"pre",26),o()()()()}if(a&2){let e=m(2);t(12),U("innerHTML",e.userJsonHighlighted(),J),t(4),U("innerHTML",e.workersJsonHighlighted(),J),t(4),U("innerHTML",e.sharedKeysJsonHighlighted(),J),t(4),U("innerHTML",e.stylesJsonHighlighted(),J)}}function we(a,p){if(a&1&&u(0,Ee,25,4,"div",14),a&2){let e=m();x(e.rawJsonModalOpen()?0:-1)}}function Ve(a,p){if(a&1){let e=V();n(0,"button",36),v("click",function(s){return g(e),m(2).clearUserHistory(),f(s.stopPropagation())}),r(1," Clear "),o()}}function be(a,p){if(a&1){let e=V();n(0,"button",39),v("click",function(){let s=g(e).$implicit,c=m(3);return f(c.selectUserFromHistory(s))}),n(1,"div",40)(2,"div",41)(3,"div",42),r(4),o(),n(5,"div",43),r(6),o()(),w(),n(7,"svg",44),S(8,"path",45),o()()()}if(a&2){let e=p.$implicit;t(4),h(" ",e.username," "),t(2),h("#",e.id)}}function Me(a,p){if(a&1&&(n(0,"div",35)(1,"div",37),K(2,be,9,2,"button",38,O),o()()),a&2){let e=m(2);t(2),H(e.userHistory())}}function Te(a,p){if(a&1){let e=V();n(0,"div",5)(1,"button",27),v("click",function(){g(e);let s=m();return f(s.toggleHistorySection())}),n(2,"div",28),w(),n(3,"svg",29),S(4,"path",30),o(),B(),n(5,"span",31),r(6),o()(),n(7,"div",28),u(8,Ve,2,0,"button",32),w(),n(9,"svg",33),S(10,"path",34),o()()(),u(11,Me,4,0,"div",35),o()}if(a&2){let e=m();t(6),h("Recent Users (",e.userHistory().length,")"),t(2),x(e.historyExpanded()?8:-1),t(),k("expanded",e.historyExpanded()),t(2),x(e.historyExpanded()?11:-1)}}function Ie(a,p){a&1&&(n(0,"div",10),w(),n(1,"svg",46),S(2,"circle",47)(3,"path",48),o(),B(),n(4,"p",49),r(5),l(6,"transloco"),o()()),a&2&&(t(5),_(d(6,1,"admin.users.loading")))}function Be(a,p){a&1&&(n(0,"div",11),w(),n(1,"svg",50),S(2,"path",51),o(),B(),n(3,"p",52),r(4),l(5,"transloco"),o()()),a&2&&(t(4),_(d(5,1,"admin.users.not_found")))}function Fe(a,p){a&1&&(n(0,"div",11),w(),n(1,"svg",50),S(2,"path",53),o(),B(),n(3,"p",52),r(4),l(5,"transloco"),o()()),a&2&&(t(4),h(" ",d(5,1,"admin.users.select_user")," "))}function Ke(a,p){if(a&1){let e=V();n(0,"div",55)(1,"div",74),w(),n(2,"svg",75),S(3,"path",58),o(),B(),n(4,"span",76),r(5),l(6,"transloco"),o()(),n(7,"button",77),v("click",function(){g(e);let s=m(2);return f(s.openUndeleteUserDialog())}),r(8),l(9,"transloco"),o()()}a&2&&(t(5),_(d(6,2,"admin.users.deleted_warning")),t(3),h(" ",d(9,4,"admin.users.undelete")," "))}function He(a,p){a&1&&(n(0,"span",62),r(1),l(2,"transloco"),o()),a&2&&(t(),_(d(2,1,"admin.users.badge.deleted")))}function Pe(a,p){a&1&&(w(),n(0,"svg",63),S(1,"path",78),o())}function De(a,p){a&1&&(w(),n(0,"svg",64),S(1,"path",79),o())}function We(a,p){a&1&&(n(0,"span",65),r(1),l(2,"transloco"),o()),a&2&&(t(),_(d(2,1,"admin.users.moderator_badge")))}function ze(a,p){if(a&1&&(n(0,"div",68)(1,"div",69),r(2),l(3,"transloco"),o(),n(4,"div",18),r(5),o()()),a&2){let e=m(2);t(2),h(" ",d(3,2,"admin.users.field.evaluating_kudos")," "),t(3),h(" ",e.selectedUser().evaluating_kudos," ")}}function Je(a,p){if(a&1){let e=V();n(0,"button",80),v("click",function(){g(e);let s=m(2);return f(s.openResetSuspicionDialog())}),r(1," Reset "),o()}}function Ne(a,p){if(a&1){let e=V();n(0,"div",72)(1,"div",81)(2,"div",82),l(3,"transloco"),n(4,"div",83)(5,"span",84),r(6),l(7,"transloco"),o(),n(8,"span",85),r(9),l(10,"transloco"),o()(),n(11,"label",86)(12,"input",87),v("change",function(s){g(e);let c=m(2);return f(c.onFieldChange("moderator",s))}),o(),S(13,"div",88)(14,"div",89),o()(),n(15,"div",82),l(16,"transloco"),n(17,"div",83)(18,"span",84),r(19),l(20,"transloco"),o(),n(21,"span",85),r(22),l(23,"transloco"),o()(),n(24,"label",86)(25,"input",87),v("change",function(s){g(e);let c=m(2);return f(c.onFieldChange("trusted",s))}),o(),S(26,"div",88)(27,"div",89),o()(),n(28,"div",82),l(29,"transloco"),n(30,"div",83)(31,"span",84),r(32),l(33,"transloco"),o(),n(34,"span",85),r(35),l(36,"transloco"),o()(),n(37,"label",86)(38,"input",87),v("change",function(s){g(e);let c=m(2);return f(c.onFieldChange("flagged",s))}),o(),S(39,"div",88)(40,"div",89),o()(),n(41,"div",82),l(42,"transloco"),n(43,"div",83)(44,"span",84),r(45),l(46,"transloco"),o(),n(47,"span",85),r(48),l(49,"transloco"),o()(),n(50,"label",86)(51,"input",87),v("change",function(s){g(e);let c=m(2);return f(c.onFieldChange("customizer",s))}),o(),S(52,"div",88)(53,"div",89),o()(),n(54,"div",82),l(55,"transloco"),n(56,"div",83)(57,"span",84),r(58),l(59,"transloco"),o(),n(60,"span",85),r(61),l(62,"transloco"),o()(),n(63,"label",86)(64,"input",87),v("change",function(s){g(e);let c=m(2);return f(c.onFieldChange("service",s))}),o(),S(65,"div",88)(66,"div",89),o()(),n(67,"div",82),l(68,"transloco"),n(69,"div",83)(70,"span",84),r(71),l(72,"transloco"),o(),n(73,"span",85),r(74),l(75,"transloco"),o()(),n(76,"label",86)(77,"input",87),v("change",function(s){g(e);let c=m(2);return f(c.onFieldChange("education",s))}),o(),S(78,"div",88)(79,"div",89),o()(),n(80,"div",82),l(81,"transloco"),n(82,"div",83)(83,"span",84),r(84),l(85,"transloco"),o(),n(86,"span",85),r(87),l(88,"transloco"),o()(),n(89,"label",86)(90,"input",87),v("change",function(s){g(e);let c=m(2);return f(c.onFieldChange("special",s))}),o(),S(91,"div",88)(92,"div",89),o()(),n(93,"div",82),l(94,"transloco"),n(95,"div",83)(96,"span",84),r(97),l(98,"transloco"),o(),n(99,"span",85),r(100),l(101,"transloco"),o()(),n(102,"label",86)(103,"input",87),v("change",function(s){g(e);let c=m(2);return f(c.onFieldChange("filtered",s))}),o(),S(104,"div",88)(105,"div",89),o()(),n(106,"div",82),l(107,"transloco"),n(108,"div",83)(109,"span",84),r(110),l(111,"transloco"),o(),n(112,"span",85),r(113),l(114,"transloco"),o()(),n(115,"label",86)(116,"input",87),v("change",function(s){g(e);let c=m(2);return f(c.onFieldChange("vpn",s))}),o(),S(117,"div",88)(118,"div",89),o()(),n(119,"div",82),l(120,"transloco"),n(121,"div",83)(122,"span",84),r(123),l(124,"transloco"),o(),n(125,"span",85),r(126),l(127,"transloco"),o()(),n(128,"label",86)(129,"input",87),v("change",function(s){g(e);let c=m(2);return f(c.onFieldChange("publicWorkers",s))}),o(),S(130,"div",88)(131,"div",89),o()()()()}if(a&2){let e=m(2);t(2),k("field-row-dimmed",!e.moderatorValue())("field-row-changed",e.moderatorChanged()),b("title",d(3,80,"admin.users.desc.moderator")),t(4),_(d(7,82,"admin.users.field.moderator")),t(3),_(d(10,84,"admin.users.desc.moderator")),t(3),U("checked",e.moderatorValue()),t(3),k("field-row-dimmed",!e.trustedValue())("field-row-changed",e.trustedChanged()),b("title",d(16,86,"admin.users.desc.trusted")),t(4),_(d(20,88,"admin.users.field.trusted")),t(3),_(d(23,90,"admin.users.desc.trusted")),t(3),U("checked",e.trustedValue()),t(3),k("field-row-dimmed",!e.flaggedValue())("field-row-changed",e.flaggedChanged()),b("title",d(29,92,"admin.users.desc.flagged")),t(4),_(d(33,94,"admin.users.field.flagged")),t(3),_(d(36,96,"admin.users.desc.flagged")),t(3),U("checked",e.flaggedValue()),t(3),k("field-row-dimmed",!e.customizerValue())("field-row-changed",e.customizerChanged()),b("title",d(42,98,"admin.users.desc.customizer")),t(4),_(d(46,100,"admin.users.field.customizer")),t(3),_(d(49,102,"admin.users.desc.customizer")),t(3),U("checked",e.customizerValue()),t(3),k("field-row-dimmed",!e.serviceValue())("field-row-changed",e.serviceChanged()),b("title",d(55,104,"admin.users.desc.service")),t(4),_(d(59,106,"admin.users.field.service")),t(3),_(d(62,108,"admin.users.desc.service")),t(3),U("checked",e.serviceValue()),t(3),k("field-row-dimmed",!e.educationValue())("field-row-changed",e.educationChanged()),b("title",d(68,110,"admin.users.desc.education")),t(4),_(d(72,112,"admin.users.field.education")),t(3),_(d(75,114,"admin.users.desc.education")),t(3),U("checked",e.educationValue()),t(3),k("field-row-dimmed",!e.specialValue())("field-row-changed",e.specialChanged()),b("title",d(81,116,"admin.users.desc.special")),t(4),_(d(85,118,"admin.users.field.special")),t(3),_(d(88,120,"admin.users.desc.special")),t(3),U("checked",e.specialValue()),t(3),k("field-row-dimmed",!e.filteredValue())("field-row-changed",e.filteredChanged()),b("title",d(94,122,"admin.users.desc.filtered")),t(4),_(d(98,124,"admin.users.field.filtered")),t(3),_(d(101,126,"admin.users.desc.filtered")),t(3),U("checked",e.filteredValue()),t(3),k("field-row-dimmed",!e.vpnValue())("field-row-changed",e.vpnChanged()),b("title",d(107,128,"admin.users.desc.vpn_access")),t(4),_(d(111,130,"admin.users.field.vpn_access")),t(3),_(d(114,132,"admin.users.desc.vpn_access")),t(3),U("checked",e.vpnValue()),t(3),k("field-row-dimmed",!e.publicWorkersValue())("field-row-changed",e.publicWorkersChanged()),b("title",d(120,134,"admin.users.desc.public_workers")),t(4),_(d(124,136,"admin.users.field.public_workers")),t(3),_(d(127,138,"admin.users.desc.public_workers")),t(3),U("checked",e.publicWorkersValue())}}function Re(a,p){if(a&1){let e=V();n(0,"div",72)(1,"div",90)(2,"div"),l(3,"transloco"),n(4,"label",91),r(5),l(6,"transloco"),o(),n(7,"p",92),r(8),l(9,"transloco"),o(),n(10,"input",93),v("input",function(s){g(e);let c=m(2);return f(c.onFieldChange("workerInvites",s))}),o()(),n(11,"div"),l(12,"transloco"),n(13,"label",91),r(14),l(15,"transloco"),o(),n(16,"p",92),r(17),l(18,"transloco"),o(),n(19,"input",94),v("input",function(s){g(e);let c=m(2);return f(c.onFieldChange("usageMultiplier",s))}),o()(),n(20,"div"),l(21,"transloco"),n(22,"label",91),r(23),l(24,"transloco"),o(),n(25,"p",92),r(26),l(27,"transloco"),o(),n(28,"input",93),v("input",function(s){g(e);let c=m(2);return f(c.onFieldChange("concurrency",s))}),o()(),n(29,"div"),l(30,"transloco"),n(31,"label",91),r(32),l(33,"transloco"),o(),n(34,"p",92),r(35),l(36,"transloco"),o(),n(37,"input",93),v("input",function(s){g(e);let c=m(2);return f(c.onFieldChange("monthlyKudos",s))}),o()()()()}if(a&2){let e=m(2);t(2),b("title",d(3,24,"admin.users.desc.worker_invites")),t(3),_(d(6,26,"admin.users.field.worker_invites")),t(3),h(" ",d(9,28,"admin.users.desc.worker_invites")," "),t(2),k("form-input-changed",e.workerInvitesChanged()),U("value",e.workerInvitesValue()),t(),b("title",d(12,30,"admin.users.desc.usage_multiplier")),t(3),_(d(15,32,"admin.users.field.usage_multiplier")),t(3),h(" ",d(18,34,"admin.users.desc.usage_multiplier")," "),t(2),k("form-input-changed",e.usageMultiplierChanged()),U("value",e.usageMultiplierValue()),t(),b("title",d(21,36,"admin.users.desc.concurrency")),t(3),_(d(24,38,"admin.users.field.concurrency")),t(3),h(" ",d(27,40,"admin.users.desc.concurrency")," "),t(2),k("form-input-changed",e.concurrencyChanged()),U("value",e.concurrencyValue()),t(),b("title",d(30,42,"admin.users.desc.monthly_kudos")),t(3),_(d(33,44,"admin.users.field.monthly_kudos")),t(3),h(" ",d(36,46,"admin.users.desc.monthly_kudos")," "),t(2),k("form-input-changed",e.monthlyKudosChanged()),U("value",e.monthlyKudosValue())}}function Le(a,p){if(a&1){let e=V();n(0,"div",100),l(1,"transloco"),n(2,"div",101)(3,"span",31),r(4),l(5,"transloco"),o(),n(6,"span",102),r(7),l(8,"transloco"),o(),n(9,"span",102),r(10),l(11,"transloco"),o(),n(12,"span",103),r(13),o()(),n(14,"button",104),v("click",function(){g(e);let s=m(3);return f(s.regenerateProxyPasskey())}),r(15),l(16,"transloco"),o()()}if(a&2){let e=m(3);b("title",d(1,7,"admin.users.desc.proxy_passkey")),t(4),_(d(5,9,"admin.users.field.proxy_passkey")),t(3),_(d(8,11,"admin.users.desc.proxy_passkey")),t(3),_(d(11,13,"admin.users.hint.proxy_passkey")),t(3),_(e.selectedUser().proxy_passkey),t(),U("disabled",e.isRegeneratingPasskey()),t(),h(" ",d(16,15,"admin.users.action.regenerate_proxy_passkey")," ")}}function Ge(a,p){if(a&1){let e=V();n(0,"div",73)(1,"div",95),l(2,"transloco"),n(3,"div",96)(4,"span",84),r(5),l(6,"transloco"),o(),n(7,"span",85),r(8),l(9,"transloco"),o()(),n(10,"input",97),v("input",function(s){g(e);let c=m(2);return f(c.onFieldChange("contact",s))}),o()(),n(11,"div",95),l(12,"transloco"),n(13,"div",98)(14,"span",84),r(15),l(16,"transloco"),o(),n(17,"span",85),r(18),l(19,"transloco"),o()(),n(20,"textarea",99),l(21,"transloco"),v("input",function(s){g(e);let c=m(2);return f(c.onFieldChange("adminComment",s))}),o()(),u(22,Le,17,17,"div",100),o()}if(a&2){let e=m(2);t(),b("title",d(2,15,"admin.users.desc.contact")),t(4),_(d(6,17,"admin.users.field.contact")),t(3),_(d(9,19,"admin.users.desc.contact")),t(2),k("form-input-changed",e.contactChanged()),U("value",e.contactValue()),t(),b("title",d(12,21,"admin.users.desc.admin_comment")),t(4),_(d(16,23,"admin.users.field.admin_comment")),t(3),_(d(19,25,"admin.users.desc.admin_comment")),t(2),k("form-input-changed",e.adminCommentChanged()),U("placeholder",A(d(21,27,"admin.users.field.admin_comment")))("value",e.adminCommentValue()),t(2),x(e.selectedUser().proxy_passkey?22:-1)}}function $e(a,p){if(a&1&&(n(0,"div",72),S(1,"app-kudos-breakdown-panel",105),o()),a&2){let e=m(2);t(),U("kudosDetails",e.selectedUser().kudos_details)}}function je(a,p){if(a&1&&(n(0,"div",110)(1,"span",111),r(2),l(3,"transloco"),o(),n(4,"span",31),r(5),l(6,"formatNumber"),o()()),a&2){let e=m(5);t(2),h("",d(3,2,"admin.users.records.megapixelsteps"),":"),t(3),_(d(6,4,e.selectedUser().records.usage.megapixelsteps??0))}}function Oe(a,p){if(a&1&&(n(0,"div",110)(1,"span",111),r(2),l(3,"transloco"),o(),n(4,"span",31),r(5),l(6,"formatNumber"),o()()),a&2){let e=m(5);t(2),h("",d(3,2,"admin.users.records.tokens"),":"),t(3),_(d(6,4,e.selectedUser().records.usage.tokens??0))}}function Ae(a,p){if(a&1&&(n(0,"div",107)(1,"h4",108),r(2),l(3,"transloco"),o(),n(4,"div",109),u(5,je,7,6,"div",110),u(6,Oe,7,6,"div",110),o()()),a&2){let e=m(4);t(2),h(" ",d(3,3,"admin.users.records.usage")," "),t(3),x(e.selectedUser().records.usage.megapixelsteps!==void 0?5:-1),t(),x(e.selectedUser().records.usage.tokens!==void 0?6:-1)}}function qe(a,p){if(a&1&&(n(0,"div",110)(1,"span",111),r(2),l(3,"transloco"),o(),n(4,"span",31),r(5),l(6,"formatNumber"),o()()),a&2){let e=m(5);t(2),h("",d(3,2,"admin.users.records.megapixelsteps"),":"),t(3),_(d(6,4,e.selectedUser().records.contribution.megapixelsteps??0))}}function Qe(a,p){if(a&1&&(n(0,"div",110)(1,"span",111),r(2),l(3,"transloco"),o(),n(4,"span",31),r(5),l(6,"formatNumber"),o()()),a&2){let e=m(5);t(2),h("",d(3,2,"admin.users.records.tokens"),":"),t(3),_(d(6,4,e.selectedUser().records.contribution.tokens??0))}}function Ye(a,p){if(a&1&&(n(0,"div",107)(1,"h4",108),r(2),l(3,"transloco"),o(),n(4,"div",109),u(5,qe,7,6,"div",110),u(6,Qe,7,6,"div",110),o()()),a&2){let e=m(4);t(2),h(" ",d(3,3,"admin.users.records.contribution")," "),t(3),x(e.selectedUser().records.contribution.megapixelsteps!==void 0?5:-1),t(),x(e.selectedUser().records.contribution.tokens!==void 0?6:-1)}}function Xe(a,p){if(a&1&&(n(0,"div",110)(1,"span",111),r(2),l(3,"transloco"),o(),n(4,"span",31),r(5),l(6,"formatNumber"),o()()),a&2){let e=m(5);t(2),h("",d(3,2,"admin.users.records.image"),":"),t(3),_(d(6,4,e.selectedUser().records.request.image??0))}}function Ze(a,p){if(a&1&&(n(0,"div",110)(1,"span",111),r(2),l(3,"transloco"),o(),n(4,"span",31),r(5),l(6,"formatNumber"),o()()),a&2){let e=m(5);t(2),h("",d(3,2,"admin.users.records.text"),":"),t(3),_(d(6,4,e.selectedUser().records.request.text??0))}}function et(a,p){if(a&1&&(n(0,"div",110)(1,"span",111),r(2),l(3,"transloco"),o(),n(4,"span",31),r(5),l(6,"formatNumber"),o()()),a&2){let e=m(5);t(2),h("",d(3,2,"admin.users.records.interrogation"),":"),t(3),_(d(6,4,e.selectedUser().records.request.interrogation??0))}}function tt(a,p){if(a&1&&(n(0,"div",107)(1,"h4",108),r(2),l(3,"transloco"),o(),n(4,"div",109),u(5,Xe,7,6,"div",110),u(6,Ze,7,6,"div",110),u(7,et,7,6,"div",110),o()()),a&2){let e=m(4);t(2),h(" ",d(3,4,"admin.users.records.requests")," "),t(3),x(e.selectedUser().records.request.image!==void 0?5:-1),t(),x(e.selectedUser().records.request.text!==void 0?6:-1),t(),x(e.selectedUser().records.request.interrogation!==void 0?7:-1)}}function it(a,p){if(a&1&&(n(0,"div",110)(1,"span",111),r(2),l(3,"transloco"),o(),n(4,"span",31),r(5),l(6,"formatNumber"),o()()),a&2){let e=m(5);t(2),h("",d(3,2,"admin.users.records.image"),":"),t(3),_(d(6,4,e.selectedUser().records.fulfillment.image??0))}}function nt(a,p){if(a&1&&(n(0,"div",110)(1,"span",111),r(2),l(3,"transloco"),o(),n(4,"span",31),r(5),l(6,"formatNumber"),o()()),a&2){let e=m(5);t(2),h("",d(3,2,"admin.users.records.text"),":"),t(3),_(d(6,4,e.selectedUser().records.fulfillment.text??0))}}function at(a,p){if(a&1&&(n(0,"div",110)(1,"span",111),r(2),l(3,"transloco"),o(),n(4,"span",31),r(5),l(6,"formatNumber"),o()()),a&2){let e=m(5);t(2),h("",d(3,2,"admin.users.records.interrogation"),":"),t(3),_(d(6,4,e.selectedUser().records.fulfillment.interrogation??0))}}function ot(a,p){if(a&1&&(n(0,"div",107)(1,"h4",108),r(2),l(3,"transloco"),o(),n(4,"div",109),u(5,it,7,6,"div",110),u(6,nt,7,6,"div",110),u(7,at,7,6,"div",110),o()()),a&2){let e=m(4);t(2),h(" ",d(3,4,"admin.users.records.fulfillments")," "),t(3),x(e.selectedUser().records.fulfillment.image!==void 0?5:-1),t(),x(e.selectedUser().records.fulfillment.text!==void 0?6:-1),t(),x(e.selectedUser().records.fulfillment.interrogation!==void 0?7:-1)}}function st(a,p){if(a&1&&(n(0,"div",110)(1,"span",111),r(2),l(3,"transloco"),o(),n(4,"span",31),r(5),l(6,"formatNumber"),o()()),a&2){let e=m(5);t(2),h("",d(3,2,"admin.users.records.image"),":"),t(3),_(d(6,4,e.selectedUser().records.style.image??0))}}function rt(a,p){if(a&1&&(n(0,"div",110)(1,"span",111),r(2),l(3,"transloco"),o(),n(4,"span",31),r(5),l(6,"formatNumber"),o()()),a&2){let e=m(5);t(2),h("",d(3,2,"admin.users.records.text"),":"),t(3),_(d(6,4,e.selectedUser().records.style.text??0))}}function lt(a,p){if(a&1&&(n(0,"div",107)(1,"h4",108),r(2),l(3,"transloco"),o(),n(4,"div",109),u(5,st,7,6,"div",110),u(6,rt,7,6,"div",110),o()()),a&2){let e=m(4);t(2),h(" ",d(3,3,"admin.users.records.styles")," "),t(3),x(e.selectedUser().records.style.image!==void 0?5:-1),t(),x(e.selectedUser().records.style.text!==void 0?6:-1)}}function dt(a,p){if(a&1&&(n(0,"div",72)(1,"div",106),u(2,Ae,7,5,"div",107),u(3,Ye,7,5,"div",107),u(4,tt,8,6,"div",107),u(5,ot,8,6,"div",107),u(6,lt,7,5,"div",107),o()()),a&2){let e=m(3);t(2),x(e.selectedUser().records.usage?2:-1),t(),x(e.selectedUser().records.contribution?3:-1),t(),x(e.selectedUser().records.request?4:-1),t(),x(e.selectedUser().records.fulfillment?5:-1),t(),x(e.selectedUser().records.style?6:-1)}}function ct(a,p){if(a&1){let e=V();n(0,"div",71)(1,"button",27),v("click",function(){g(e);let s=m(2);return f(s.toggleRecordsSection())}),n(2,"span",31),r(3),l(4,"transloco"),o(),w(),n(5,"svg",33),S(6,"path",34),o()(),u(7,dt,7,5,"div",72),o()}if(a&2){let e=m(2);t(3),_(d(4,4,"admin.users.section.records")),t(2),k("expanded",e.recordsExpanded()),t(2),x(e.recordsExpanded()?7:-1)}}function pt(a,p){if(a&1&&(n(0,"span",115),r(1),o()),a&2){let e=p.$implicit;t(),_(e)}}function mt(a,p){if(a&1&&(n(0,"span",116),r(1),o()),a&2){let e=m(5);t(),h("+",e.selectedUser().active_generations.image.length-10," more")}}function _t(a,p){if(a&1&&(n(0,"div")(1,"h4",113),r(2),l(3,"transloco"),o(),n(4,"div",114),K(5,pt,2,1,"span",115,L),u(7,mt,2,1,"span",116),o()()),a&2){let e=m(4);t(2),W(" ",d(3,3,"admin.users.active_generations.image")," (",e.selectedUser().active_generations.image.length,") "),t(3),H(e.selectedUser().active_generations.image.slice(0,10)),t(2),x(e.selectedUser().active_generations.image.length>10?7:-1)}}function ut(a,p){if(a&1&&(n(0,"span",115),r(1),o()),a&2){let e=p.$implicit;t(),_(e)}}function xt(a,p){if(a&1&&(n(0,"span",116),r(1),o()),a&2){let e=m(5);t(),h("+",e.selectedUser().active_generations.text.length-10," more")}}function ht(a,p){if(a&1&&(n(0,"div")(1,"h4",113),r(2),l(3,"transloco"),o(),n(4,"div",114),K(5,ut,2,1,"span",115,L),u(7,xt,2,1,"span",116),o()()),a&2){let e=m(4);t(2),W(" ",d(3,3,"admin.users.active_generations.text")," (",e.selectedUser().active_generations.text.length,") "),t(3),H(e.selectedUser().active_generations.text.slice(0,10)),t(2),x(e.selectedUser().active_generations.text.length>10?7:-1)}}function Ct(a,p){if(a&1&&(n(0,"span",115),r(1),o()),a&2){let e=p.$implicit;t(),_(e)}}function vt(a,p){if(a&1&&(n(0,"span",116),r(1),o()),a&2){let e=m(5);t(),h("+",e.selectedUser().active_generations.alchemy.length-10," more")}}function gt(a,p){if(a&1&&(n(0,"div")(1,"h4",113),r(2),l(3,"transloco"),o(),n(4,"div",114),K(5,Ct,2,1,"span",115,L),u(7,vt,2,1,"span",116),o()()),a&2){let e=m(4);t(2),W(" ",d(3,3,"admin.users.active_generations.alchemy")," (",e.selectedUser().active_generations.alchemy.length,") "),t(3),H(e.selectedUser().active_generations.alchemy.slice(0,10)),t(2),x(e.selectedUser().active_generations.alchemy.length>10?7:-1)}}function ft(a,p){if(a&1&&(n(0,"div",72)(1,"div",112),u(2,_t,8,5,"div"),u(3,ht,8,5,"div"),u(4,gt,8,5,"div"),o()()),a&2){let e,i,s,c=m(3);t(2),x(!((e=c.selectedUser().active_generations)==null||e.image==null)&&e.image.length?2:-1),t(),x(!((i=c.selectedUser().active_generations)==null||i.text==null)&&i.text.length?3:-1),t(),x(!((s=c.selectedUser().active_generations)==null||s.alchemy==null)&&s.alchemy.length?4:-1)}}function St(a,p){if(a&1){let e=V();n(0,"div",71)(1,"button",27),v("click",function(){g(e);let s=m(2);return f(s.toggleActiveGenerationsSection())}),n(2,"span",31),r(3),l(4,"transloco"),o(),w(),n(5,"svg",33),S(6,"path",34),o()(),u(7,ft,5,3,"div",72),o()}if(a&2){let e=m(2);t(3),_(d(4,4,"admin.users.section.active_generations")),t(2),k("expanded",e.activeGenerationsExpanded()),t(2),x(e.activeGenerationsExpanded()?7:-1)}}function yt(a,p){if(a&1&&(n(0,"div",68)(1,"div",40)(2,"div")(3,"div",117),r(4),o(),n(5,"div",116),r(6),o()(),n(7,"span",118),r(8),o()()()),a&2){let e=p.$implicit;t(4),h(" ",e.name," "),t(2),h(" ",e.type," "),t(2),h("",e.id.slice(0,8),"...")}}function Ut(a,p){if(a&1&&(n(0,"div",72)(1,"div",37),K(2,yt,9,3,"div",68,O),o()()),a&2){let e=m(3);t(2),H(e.selectedUser().styles)}}function kt(a,p){if(a&1){let e=V();n(0,"div",71)(1,"button",27),v("click",function(){g(e);let s=m(2);return f(s.toggleStylesSection())}),n(2,"span",31),r(3),l(4,"transloco"),o(),w(),n(5,"svg",33),S(6,"path",34),o()(),u(7,Ut,4,0,"div",72),o()}if(a&2){let e=m(2);t(3),W("",d(4,5,"admin.users.section.styles")," (",e.selectedUser().styles.length,")"),t(2),k("expanded",e.stylesExpanded()),t(2),x(e.stylesExpanded()?7:-1)}}function Et(a,p){a&1&&(n(0,"div",10),w(),n(1,"svg",121),S(2,"circle",47)(3,"path",48),o()())}function wt(a,p){a&1&&(n(0,"div",120),r(1," No shared key details available "),o())}function Vt(a,p){if(a&1&&(n(0,"div",127),r(1),l(2,"date"),o()),a&2){let e=m().$implicit;t(),h(" Expires: ",G(2,1,e.expiry,"mediumDate")," ")}}function bt(a,p){a&1&&r(0," Unlimited ")}function Mt(a,p){if(a&1&&(r(0),l(1,"formatNumber")),a&2){let e=m().$implicit;h(" ",d(1,1,e.kudos??0)," ")}}function Tt(a,p){a&1&&r(0," \u221E ")}function It(a,p){if(a&1&&(r(0),l(1,"formatNumber")),a&2){let e=m().$implicit;h(" ",d(1,1,e.max_image_pixels??0)," ")}}function Bt(a,p){a&1&&r(0," \u221E ")}function Ft(a,p){if(a&1&&r(0),a&2){let e=m().$implicit;h(" ",e.max_image_steps??0," ")}}function Kt(a,p){a&1&&r(0," \u221E ")}function Ht(a,p){if(a&1&&r(0),a&2){let e=m().$implicit;h(" ",e.max_text_tokens??0," ")}}function Pt(a,p){if(a&1&&(n(0,"div",122)(1,"div",123)(2,"div",124)(3,"div",125),r(4),o(),n(5,"div",126),r(6),o()(),u(7,Vt,3,4,"div",127),o(),n(8,"div",128)(9,"div")(10,"span",111),r(11,"Kudos Limit:"),o(),n(12,"span",129),u(13,bt,1,0)(14,Mt,2,3),o()(),n(15,"div")(16,"span",111),r(17,"Utilized:"),o(),n(18,"span",129),r(19),l(20,"formatNumber"),o()()(),n(21,"div",130)(22,"div",131)(23,"div",132),r(24,"Max Pixels"),o(),n(25,"div",31),u(26,Tt,1,0)(27,It,2,3),o()(),n(28,"div",131)(29,"div",132),r(30,"Max Steps"),o(),n(31,"div",31),u(32,Bt,1,0)(33,Ft,1,1),o()(),n(34,"div",131)(35,"div",132),r(36,"Max Tokens"),o(),n(37,"div",31),u(38,Kt,1,0)(39,Ht,1,1),o()()()()),a&2){let e=p.$implicit;t(4),h(" ",e.name??"Unnamed Key"," "),t(),U("title",A(e.id)),t(),h(" ",e.id," "),t(),x(e.expiry?7:-1),t(6),x(e.kudos===-1?13:14),t(6),_(d(20,10,e.utilized??0)),t(7),x(e.max_image_pixels===-1?26:27),t(6),x(e.max_image_steps===-1?32:33),t(6),x(e.max_text_tokens===-1?38:39)}}function Dt(a,p){if(a&1&&(n(0,"div",37),K(1,Pt,40,12,"div",122,O),o()),a&2){let e=m(4);t(),H(e.userSharedKeys())}}function Wt(a,p){if(a&1&&(n(0,"div",119),u(1,Et,4,0,"div",10)(2,wt,2,0,"div",120)(3,Dt,3,0,"div",37),o()),a&2){let e=m(3);t(),x(e.loadingSharedKeys()?1:e.userSharedKeys().length===0&&e.sharedKeysFetched()?2:3)}}function zt(a,p){if(a&1){let e=V();n(0,"div",71)(1,"button",27),v("click",function(){g(e);let s=m(2);return f(s.toggleSharedKeysSection())}),n(2,"span",31),r(3),l(4,"transloco"),o(),w(),n(5,"svg",33),S(6,"path",34),o()(),u(7,Wt,4,1,"div",119),o()}if(a&2){let e=m(2);t(3),W("",d(4,5,"admin.users.section.shared_keys")," (",e.selectedUser().sharedkey_ids.length,")"),t(2),k("expanded",e.sharedKeysExpanded()),t(2),x(e.sharedKeysExpanded()?7:-1)}}function Jt(a,p){a&1&&(n(0,"div",10),w(),n(1,"svg",121),S(2,"circle",47)(3,"path",48),o()())}function Nt(a,p){if(a&1){let e=V();n(0,"app-worker-card",135),v("workerUpdated",function(){g(e);let s=m(5);return f(s.onWorkerUpdated())})("workerDeleted",function(s){g(e);let c=m(5);return f(c.onWorkerDeleted(s))}),o()}if(a&2){let e,i=p.$implicit,s=m(5);U("worker",i)("isModerator",((e=s.auth.currentUser())==null?null:e.moderator)??!1)}}function Rt(a,p){if(a&1&&(n(0,"div",133),K(1,Nt,1,2,"app-worker-card",134,O),o()),a&2){let e=m(4);t(),H(e.userWorkers())}}function Lt(a,p){if(a&1&&(n(0,"div",119),u(1,Jt,4,0,"div",10)(2,Rt,3,0,"div",133),o()),a&2){let e=m(3);t(),x(e.loadingWorkers()?1:2)}}function Gt(a,p){if(a&1){let e=V();n(0,"div",71)(1,"button",27),v("click",function(){g(e);let s=m(2);return f(s.toggleWorkersSection())}),n(2,"span",31),r(3),l(4,"transloco"),o(),w(),n(5,"svg",33),S(6,"path",34),o()(),u(7,Lt,3,1,"div",119),o()}if(a&2){let e=m(2);t(3),_(d(4,4,"admin.users.section.workers")),t(2),k("expanded",e.workersExpanded()),t(2),x(e.workersExpanded()?7:-1)}}function $t(a,p){if(a&1){let e=V();n(0,"div",54),u(1,Ke,10,6,"div",55),n(2,"div",56),w(),n(3,"svg",57),S(4,"path",58),o(),B(),n(5,"span"),r(6),l(7,"transloco"),o()(),n(8,"div",59)(9,"div",60)(10,"h2",61),r(11),u(12,He,3,3,"span",62),u(13,Pe,2,0,":svg:svg",63),u(14,De,2,0,":svg:svg",64),u(15,We,3,3,"span",65),o(),n(16,"button",66),v("click",function(){g(e);let s=m();return f(s.openRawJsonModal())}),r(17," Raw JSON "),o()(),n(18,"div",67)(19,"div",68)(20,"div",69),r(21),l(22,"transloco"),o(),n(23,"div",18),r(24),l(25,"formatNumber"),o()(),n(26,"div",68)(27,"div",69),r(28),l(29,"transloco"),o(),n(30,"div",18),r(31),o()(),u(32,ze,6,4,"div",68),n(33,"div",68)(34,"div",69),r(35),l(36,"transloco"),o(),n(37,"div",18),r(38),o(),u(39,Je,2,0,"button",70),o()()(),n(40,"div",71)(41,"button",27),v("click",function(){g(e);let s=m();return f(s.togglePermissionsSection())}),n(42,"span",31),r(43),l(44,"transloco"),o(),w(),n(45,"svg",33),S(46,"path",34),o()(),u(47,Ne,132,140,"div",72),o(),B(),n(48,"div",71)(49,"button",27),v("click",function(){g(e);let s=m();return f(s.toggleLimitsSection())}),n(50,"span",31),r(51),l(52,"transloco"),o(),w(),n(53,"svg",33),S(54,"path",34),o()(),u(55,Re,38,48,"div",72),o(),B(),n(56,"div",71)(57,"button",27),v("click",function(){g(e);let s=m();return f(s.toggleContactSection())}),n(58,"span",31),r(59),l(60,"transloco"),o(),w(),n(61,"svg",33),S(62,"path",34),o()(),u(63,Ge,23,29,"div",73),o(),B(),n(64,"div",71)(65,"button",27),v("click",function(){g(e);let s=m();return f(s.toggleKudosDetailsSection())}),n(66,"span",31),r(67),l(68,"transloco"),o(),w(),n(69,"svg",33),S(70,"path",34),o()(),u(71,$e,2,1,"div",72),o(),u(72,ct,8,6,"div",71),u(73,St,8,6,"div",71),u(74,kt,8,7,"div",71),u(75,zt,8,7,"div",71),u(76,Gt,8,6,"div",71),o()}if(a&2){let e=m();k("panel-unsaved",e.isDirty()),t(),x(e.selectedUser().deleted?1:-1),t(),k("unsaved-changes-warning-hidden",!e.isDirty()),t(4),_(d(7,44,"admin.users.unsaved_changes")),t(5),h(" ",e.selectedUser().username," "),t(),x(e.selectedUser().deleted?12:-1),t(),x(e.trustedValue()?13:-1),t(),x(e.flaggedValue()?14:-1),t(),x(e.selectedUser().moderator?15:-1),t(6),h(" ",d(22,46,"admin.users.field.kudos")," "),t(3),h(" ",d(25,48,e.selectedUser().kudos)," "),t(4),h(" ",d(29,50,"admin.users.field.worker_count")," "),t(3),h(" ",e.selectedUser().worker_count," "),t(),x(e.selectedUser().evaluating_kudos!==void 0?32:-1),t(),k("border-2",e.selectedUser().suspicious>10&&!e.trustedValue())("border-red-500",e.selectedUser().suspicious>10&&!e.trustedValue()),t(2),h(" ",d(36,52,"admin.users.field.suspicious")," "),t(3),h(" ",e.selectedUser().suspicious," "),t(),x(e.selectedUser().suspicious>0?39:-1),t(4),_(d(44,54,"admin.users.section.permissions")),t(2),k("expanded",e.permissionsExpanded()),t(2),x(e.permissionsExpanded()?47:-1),t(4),_(d(52,56,"admin.users.section.limits")),t(2),k("expanded",e.limitsExpanded()),t(2),x(e.limitsExpanded()?55:-1),t(4),_(d(60,58,"admin.users.section.contact")),t(2),k("expanded",e.contactExpanded()),t(2),x(e.contactExpanded()?63:-1),t(4),_(d(68,60,"admin.users.section.kudos_details")),t(2),k("expanded",e.kudosDetailsExpanded()),t(2),x(e.kudosDetailsExpanded()?71:-1),t(),x(e.selectedUser().records?72:-1),t(),x(e.hasActiveGenerations(e.selectedUser())?73:-1),t(),x(e.selectedUser().styles&&e.selectedUser().styles.length>0?74:-1),t(),x(e.selectedUser().sharedkey_ids&&e.selectedUser().sharedkey_ids.length>0?75:-1),t(),x(e.selectedUser().worker_ids&&e.selectedUser().worker_ids.length>0?76:-1)}}function jt(a,p){if(a&1){let e=V();n(0,"button",136),v("click",function(){g(e);let s=m();return f(s.saveChanges())}),r(1),l(2,"transloco"),o()}if(a&2){let e=m();U("disabled",e.isSaving()),t(),h(" ",d(2,2,"admin.users.save")," ")}}var Q="admin_user_history",Ot=30,Si=(()=>{let p=class p{constructor(){this.title=T(de),this.translator=T(_e),this.destroyRef=T(te),this.userService=T(Se),this.workerService=T(xe),this.platformId=T(ie),this.route=T(ce),this.auth=T(j),this.searchQuery=C(""),this.loading=C(!1),this.selectedUser=C(null),this.userNotFound=C(!1),this.userWorkers=C([]),this.loadingWorkers=C(!1),this.userSharedKeys=C([]),this.loadingSharedKeys=C(!1),this.sharedKeysFetched=C(!1),this.workersExpanded=C(!1),this.permissionsExpanded=C(!0),this.limitsExpanded=C(!0),this.contactExpanded=C(!1),this.kudosDetailsExpanded=C(!1),this.recordsExpanded=C(!1),this.activeGenerationsExpanded=C(!1),this.stylesExpanded=C(!1),this.sharedKeysExpanded=C(!1),this.rawJsonModalOpen=C(!1),this.trustedValue=C(!1),this.flaggedValue=C(!1),this.workerInvitesValue=C(0),this.moderatorValue=C(!1),this.publicWorkersValue=C(!1),this.customizerValue=C(!1),this.serviceValue=C(!1),this.educationValue=C(!1),this.specialValue=C(!1),this.filteredValue=C(!1),this.vpnValue=C(!1),this.usageMultiplierValue=C(1),this.concurrencyValue=C(0),this.monthlyKudosValue=C(0),this.contactValue=C(""),this.adminCommentValue=C(""),this.isRegeneratingPasskey=C(!1),this.isDirty=C(!1),this.isSaving=C(!1),this.userJson=E(()=>N(this.selectedUser())),this.workersJson=E(()=>N(this.userWorkers())),this.sharedKeysJson=E(()=>N(this.userSharedKeys())),this.stylesJson=E(()=>N(this.selectedUser()?.styles??[])),this.userJsonHighlighted=E(()=>R(this.userJson())),this.workersJsonHighlighted=E(()=>R(this.workersJson())),this.sharedKeysJsonHighlighted=E(()=>R(this.sharedKeysJson())),this.stylesJsonHighlighted=E(()=>R(this.stylesJson())),this.trustedChanged=E(()=>{let i=this.selectedUser();return i?this.trustedValue()!==i.trusted:!1}),this.flaggedChanged=E(()=>{let i=this.selectedUser();return i?this.flaggedValue()!==i.flagged:!1}),this.moderatorChanged=E(()=>{let i=this.selectedUser();return i?this.moderatorValue()!==i.moderator:!1}),this.publicWorkersChanged=E(()=>{let i=this.selectedUser();return i?this.publicWorkersValue()!==(i.public_workers??!1):!1}),this.customizerChanged=E(()=>{let i=this.selectedUser();return i?this.customizerValue()!==(i.customizer??!1):!1}),this.serviceChanged=E(()=>{let i=this.selectedUser();return i?this.serviceValue()!==(i.service??!1):!1}),this.educationChanged=E(()=>{let i=this.selectedUser();return i?this.educationValue()!==(i.education??!1):!1}),this.specialChanged=E(()=>{let i=this.selectedUser();return i?this.specialValue()!==(i.special??!1):!1}),this.filteredChanged=E(()=>{let i=this.selectedUser();return i?this.filteredValue()!==(i.filtered??!1):!1}),this.vpnChanged=E(()=>{let i=this.selectedUser();return i?this.vpnValue()!==(i.vpn??!1):!1}),this.workerInvitesChanged=E(()=>{let i=this.selectedUser();return i?this.workerInvitesValue()!==i.worker_invited:!1}),this.usageMultiplierChanged=E(()=>{let i=this.selectedUser();return i?this.usageMultiplierValue()!==(i.usage_multiplier??1):!1}),this.concurrencyChanged=E(()=>{let i=this.selectedUser();return i?this.concurrencyValue()!==(i.concurrency??0):!1}),this.monthlyKudosChanged=E(()=>{let i=this.selectedUser();return i?this.monthlyKudosValue()!==(i.monthly_kudos?.amount??0):!1}),this.contactChanged=E(()=>{let i=this.selectedUser();return i?this.contactValue().trim()!==(i.contact??""):!1}),this.adminCommentChanged=E(()=>{let i=this.selectedUser();return i?this.adminCommentValue().trim()!==(i.admin_comment??""):!1}),this.dialogOpen=C(!1),this.dialogType=C("resetSuspicion"),this.isUpdating=C(!1),this.toasts=C([]),this.userHistory=C([]),this.historyExpanded=C(!1),this.fieldSignals={trusted:this.trustedValue,flagged:this.flaggedValue,moderator:this.moderatorValue,publicWorkers:this.publicWorkersValue,customizer:this.customizerValue,service:this.serviceValue,education:this.educationValue,special:this.specialValue,filtered:this.filteredValue,vpn:this.vpnValue,workerInvites:this.workerInvitesValue,usageMultiplier:this.usageMultiplierValue,concurrency:this.concurrencyValue,monthlyKudos:this.monthlyKudosValue,contact:this.contactValue,adminComment:this.adminCommentValue}}ngOnInit(){X([this.translator.get("admin.users.title"),this.translator.get("app_title")]).pipe(I(this.destroyRef)).subscribe(([s,c])=>{this.title.setTitle(`${s} | ${c}`)}),this.loadUserHistory();let i=this.route.snapshot.paramMap.get("userId");if(i)this.searchQuery.set(i),this.searchUser();else{let s=this.userHistory();if(s.length>0){let c=s[0];this.searchQuery.set(c.id.toString()),this.searchUser()}}}onSearchChange(i){let s=i.target;this.searchQuery.set(s.value)}searchUser(){let i=this.searchQuery().trim();if(!i)return;this.loading.set(!0),this.clearToasts(),this.userNotFound.set(!1),this.selectedUser.set(null),this.userWorkers.set([]),this.workersExpanded.set(!1),this.userSharedKeys.set([]),this.sharedKeysFetched.set(!1),this.sharedKeysExpanded.set(!1);let s=null,c=parseInt(i,10);if(!isNaN(c))s=c;else{let y=i.match(/#(\d+)$/);y&&(s=parseInt(y[1],10))}s!==null?this.userService.getUser(s).pipe(I(this.destroyRef),P(()=>this.loading.set(!1))).subscribe({next:y=>{y?(this.setSelectedUser(y),this.addToUserHistory(y)):this.userNotFound.set(!0)},error:()=>{this.userNotFound.set(!0),this.showToast("error","Failed to load user data.")}}):(this.loading.set(!1),this.userNotFound.set(!0))}setSelectedUser(i){this.selectedUser.set(i),this.trustedValue.set(i.trusted),this.flaggedValue.set(i.flagged),this.workerInvitesValue.set(i.worker_invited),this.moderatorValue.set(i.moderator??!1),this.publicWorkersValue.set(i.public_workers??!1),this.customizerValue.set(i.customizer??!1),this.serviceValue.set(i.service??!1),this.educationValue.set(i.education??!1),this.specialValue.set(i.special??!1),this.filteredValue.set(i.filtered??!1),this.vpnValue.set(i.vpn??!1),this.usageMultiplierValue.set(i.usage_multiplier??1),this.concurrencyValue.set(i.concurrency??0),this.monthlyKudosValue.set(i.monthly_kudos?.amount??0),this.contactValue.set(i.contact??""),this.adminCommentValue.set(i.admin_comment??""),this.isDirty.set(!1)}onFieldChange(i,s){let c=s.target,y=this.fieldSignals[i];if(c instanceof HTMLInputElement&&c.type==="checkbox")y.set(c.checked);else if(c instanceof HTMLInputElement&&c.type==="number"){let M=c.value;if(i==="usageMultiplier"){let D=parseFloat(M);y.set(Number.isFinite(D)?D:1)}else y.set(parseInt(M,10)||0)}else y.set(c.value);this.checkDirty()}checkDirty(){let i=this.selectedUser();i&&this.isDirty.set(this.trustedValue()!==i.trusted||this.flaggedValue()!==i.flagged||this.moderatorValue()!==i.moderator||this.publicWorkersValue()!==(i.public_workers??!1)||this.customizerValue()!==(i.customizer??!1)||this.serviceValue()!==(i.service??!1)||this.educationValue()!==(i.education??!1)||this.specialValue()!==(i.special??!1)||this.filteredValue()!==(i.filtered??!1)||this.vpnValue()!==(i.vpn??!1)||this.workerInvitesValue()!==i.worker_invited||this.usageMultiplierValue()!==(i.usage_multiplier??1)||this.concurrencyValue()!==(i.concurrency??0)||this.monthlyKudosValue()!==(i.monthly_kudos?.amount??0)||this.contactValue().trim()!==(i.contact??"")||this.adminCommentValue().trim()!==(i.admin_comment??""))}saveChanges(){let i=this.selectedUser();if(!i||!this.isDirty())return;this.isSaving.set(!0);let s={};this.trustedValue()!==i.trusted&&(s.trusted=this.trustedValue()),this.flaggedValue()!==i.flagged&&(s.flagged=this.flaggedValue()),this.workerInvitesValue()!==i.worker_invited&&(s.worker_invite=this.workerInvitesValue()),this.moderatorValue()!==i.moderator&&(s.moderator=this.moderatorValue()),this.publicWorkersValue()!==(i.public_workers??!1)&&(s.public_workers=this.publicWorkersValue()),this.customizerValue()!==(i.customizer??!1)&&(s.customizer=this.customizerValue()),this.serviceValue()!==(i.service??!1)&&(s.service=this.serviceValue()),this.educationValue()!==(i.education??!1)&&(s.education=this.educationValue()),this.specialValue()!==(i.special??!1)&&(s.special=this.specialValue()),this.filteredValue()!==(i.filtered??!1)&&(s.filtered=this.filteredValue()),this.vpnValue()!==(i.vpn??!1)&&(s.vpn=this.vpnValue()),this.usageMultiplierValue()!==(i.usage_multiplier??1)&&(s.usage_multiplier=this.usageMultiplierValue()),this.concurrencyValue()!==(i.concurrency??0)&&(s.concurrency=this.concurrencyValue()),this.monthlyKudosValue()!==(i.monthly_kudos?.amount??0)&&(s.monthly_kudos=this.monthlyKudosValue()),this.contactValue().trim()!==(i.contact??"")&&(s.contact=this.contactValue().trim()||void 0),this.adminCommentValue().trim()!==(i.admin_comment??"")&&(s.admin_comment=this.adminCommentValue().trim()||void 0),this.userService.updateUser(i.id,s).pipe(I(this.destroyRef),P(()=>this.isSaving.set(!1))).subscribe({next:c=>{c&&(this.userService.getUser(i.id).pipe(I(this.destroyRef)).subscribe(y=>{y&&this.setSelectedUser(y)}),this.showToast("success","Changes saved successfully."))},error:()=>{this.showToast("error","Failed to save changes.")}})}toggleWorkersSection(){let i=!this.workersExpanded();this.workersExpanded.set(i),i&&this.userWorkers().length===0&&this.loadUserWorkers()}togglePermissionsSection(){this.permissionsExpanded.set(!this.permissionsExpanded())}toggleLimitsSection(){this.limitsExpanded.set(!this.limitsExpanded())}toggleContactSection(){this.contactExpanded.set(!this.contactExpanded())}toggleKudosDetailsSection(){this.kudosDetailsExpanded.set(!this.kudosDetailsExpanded())}toggleRecordsSection(){this.recordsExpanded.set(!this.recordsExpanded())}toggleActiveGenerationsSection(){this.activeGenerationsExpanded.set(!this.activeGenerationsExpanded())}toggleStylesSection(){this.stylesExpanded.set(!this.stylesExpanded())}toggleSharedKeysSection(){let i=!this.sharedKeysExpanded();this.sharedKeysExpanded.set(i),i&&!this.sharedKeysFetched()&&this.loadUserSharedKeys()}openRawJsonModal(){let i=this.selectedUser();i&&(i.worker_ids?.length&&this.userWorkers().length===0&&!this.loadingWorkers()&&this.loadUserWorkers(),i.sharedkey_ids?.length&&!this.sharedKeysFetched()&&!this.loadingSharedKeys()&&this.loadUserSharedKeys(),this.rawJsonModalOpen.set(!0))}closeRawJsonModal(){this.rawJsonModalOpen.set(!1)}loadUserSharedKeys(){let i=this.selectedUser();!i||!i.sharedkey_ids||i.sharedkey_ids.length===0||(this.loadingSharedKeys.set(!0),this.userService.getSharedKeysByIds(i.sharedkey_ids).pipe(I(this.destroyRef),P(()=>this.loadingSharedKeys.set(!1))).subscribe({next:s=>{this.userSharedKeys.set(s),this.sharedKeysFetched.set(!0)},error:()=>{this.sharedKeysFetched.set(!0),this.showToast("error","Failed to load shared keys.")}}))}hasActiveGenerations(i){if(!i||!i.active_generations)return!1;let s=i.active_generations;return(s.image?.length??0)>0||(s.text?.length??0)>0||(s.alchemy?.length??0)>0}loadUserWorkers(){let i=this.selectedUser();!i||!i.worker_ids||i.worker_ids.length===0||(this.loadingWorkers.set(!0),this.workerService.getWorkersByIds(i.worker_ids).pipe(I(this.destroyRef),P(()=>this.loadingWorkers.set(!1))).subscribe({next:s=>{this.userWorkers.set(s)},error:()=>{this.showToast("error","Failed to load workers.")}}))}openResetSuspicionDialog(){this.dialogType.set("resetSuspicion"),this.dialogOpen.set(!0)}openUndeleteUserDialog(){this.dialogType.set("undeleteUser"),this.dialogOpen.set(!0)}closeDialog(){this.dialogOpen.set(!1)}confirmDialog(){let i=this.selectedUser();if(!i)return;this.isUpdating.set(!0);let s=this.dialogType(),c;if(s==="resetSuspicion")c=this.userService.resetSuspicion(i.id);else if(s==="undeleteUser")c=this.userService.updateUser(i.id,{undelete:!0});else{this.isUpdating.set(!1);return}c.pipe(I(this.destroyRef),P(()=>{this.isUpdating.set(!1),this.closeDialog()})).subscribe({next:y=>{y&&(this.userService.getUser(i.id).pipe(I(this.destroyRef)).subscribe(M=>{M&&this.setSelectedUser(M)}),s==="resetSuspicion"?this.showToast("success","Suspicion reset successfully."):s==="undeleteUser"&&this.showToast("success","User restored successfully."))},error:()=>{s==="resetSuspicion"?this.showToast("error","Failed to reset suspicion."):s==="undeleteUser"&&this.showToast("error","Failed to restore user.")}})}onWorkerUpdated(){this.loadUserWorkers()}onWorkerDeleted(i){this.userWorkers.update(s=>s.filter(c=>c.id!==i)),this.showToast("success","Worker deleted successfully! Note: It may take up to a minute for the API to reflect this change.")}regenerateProxyPasskey(){let i=this.selectedUser();i&&(this.isRegeneratingPasskey.set(!0),this.userService.updateUser(i.id,{generate_proxy_passkey:!0}).pipe(I(this.destroyRef),P(()=>this.isRegeneratingPasskey.set(!1))).subscribe({next:s=>{s&&this.userService.getUser(i.id).pipe(I(this.destroyRef)).subscribe(c=>{c&&this.setSelectedUser(c)})},error:()=>{this.showToast("error","Failed to regenerate passkey.")}}))}showToast(i,s,c=i==="success"){let y=`toast-${Date.now()}-${Math.random().toString(36).slice(2,7)}`;this.toasts.update(M=>[...M,{id:y,type:i,message:s}]),c&&setTimeout(()=>this.dismissToast(y),3e3)}dismissToast(i){this.toasts.update(s=>s.filter(c=>c.id!==i))}clearToasts(){this.toasts.set([])}loadUserHistory(){if($(this.platformId))try{let i=localStorage.getItem(Q);if(i){let s=JSON.parse(i);this.userHistory.set(s)}}catch(i){console.error("Failed to load user history:",i),this.userHistory.set([])}}addToUserHistory(i){if(!$(this.platformId))return;let c=this.userHistory().filter(D=>D.id!==i.id),M=[{id:i.id,username:i.username,timestamp:Date.now()},...c].slice(0,Ot);this.userHistory.set(M);try{localStorage.setItem(Q,JSON.stringify(M))}catch(D){console.error("Failed to save user history:",D)}}toggleHistorySection(){this.historyExpanded.set(!this.historyExpanded())}selectUserFromHistory(i){this.searchQuery.set(i.id.toString()),this.searchUser()}clearUserHistory(){if(this.userHistory.set([]),!!$(this.platformId))try{localStorage.removeItem(Q)}catch(i){console.error("Failed to clear user history:",i)}}};p.\u0275fac=function(s){return new(s||p)},p.\u0275cmp=ne({type:p,selectors:[["app-user-management"]],decls:28,vars:39,consts:[[3,"dismiss","toasts"],[3,"confirm","cancel","open","title","confirmLabel","cancelLabel","loading","variant"],[1,"text-gray-300"],[1,"admin-container"],[1,"admin-heading-page"],[1,"panel","mb-6"],[1,"mb-6"],[1,"flex","gap-3"],["type","text",1,"form-input","flex-1",3,"input","keydown.enter","value","placeholder"],[1,"btn-primary",3,"click","disabled"],[1,"admin-loading"],[1,"admin-empty"],[1,"panel",3,"panel-unsaved"],[1,"btn-save-fixed",3,"disabled"],[1,"modal"],[1,"modal-backdrop",3,"click"],["role","dialog","aria-modal","true","aria-label","Raw JSON",1,"dialog-panel","json-dialog"],[1,"flex","items-center","justify-between","mb-4"],[1,"admin-heading-card"],[1,"btn-muted","text-sm",3,"click"],[1,"json-grid"],[1,"json-section"],[1,"json-section-title","admin-text-light"],["aria-label","User JSON",1,"json-block",3,"innerHTML"],["aria-label","Workers JSON",1,"json-block",3,"innerHTML"],["aria-label","Shared Keys JSON",1,"json-block",3,"innerHTML"],["aria-label","Styles JSON",1,"json-block",3,"innerHTML"],[1,"expandable-header",3,"click"],[1,"flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","admin-text-muted"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"admin-text-light"],["title","Clear history",1,"btn-muted","text-sm","px-2","py-1"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"expandable-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"p-4","pt-0"],["title","Clear history",1,"btn-muted","text-sm","px-2","py-1",3,"click"],[1,"admin-grid-history"],[1,"list-item-button"],[1,"list-item-button",3,"click"],[1,"flex","items-center","justify-between"],[1,"flex-1","min-w-0"],[1,"admin-text-white","truncate"],[1,"admin-text-muted","text-sm"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","admin-icon-muted","shrink-0","ml-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],["fill","none","viewBox","0 0 24 24",1,"admin-spinner"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"admin-spinner-track"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"admin-spinner-head"],[1,"admin-loading-text"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"admin-empty-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"admin-empty-text"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"panel"],[1,"bg-red-900/50","border-b","border-red-700","px-6","py-3","flex","items-center","justify-between","gap-3"],[1,"unsaved-changes-warning"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5"],["fill-rule","evenodd","d","M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z","clip-rule","evenodd"],[1,"p-6","pb-3"],[1,"flex","items-center","justify-between","mb-6"],[1,"admin-heading-section","flex","items-center","gap-2"],[1,"text-xs","font-medium","px-2","py-0.5","rounded","bg-red-600","text-white"],["fill","currentColor","viewBox","0 0 20 20","aria-label","Trusted user",1,"w-5","h-5","text-green-400"],["fill","currentColor","viewBox","0 0 20 20","aria-label","Flagged user",1,"w-5","h-5","text-red-400"],[1,"admin-badge-moderator"],["type","button",1,"btn-muted","text-sm",3,"click"],[1,"admin-grid-stats-4","mb-6"],[1,"admin-bg-dark","rounded-lg","p-3"],[1,"text-xs","admin-text-muted","mb-1"],[1,"btn-danger","text-xs","mt-2","px-2","py-1"],[1,"admin-border-t"],[1,"p-6","pt-4"],[1,"p-6","pt-4","space-y-4"],[1,"flex","items-center","gap-3"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-red-400"],[1,"text-red-300"],[1,"btn-warning","text-sm","px-3","py-1.5",3,"click"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z","clip-rule","evenodd"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z","clip-rule","evenodd"],[1,"btn-danger","text-xs","mt-2","px-2","py-1",3,"click"],[1,"admin-grid-permissions"],[1,"field-row-compact"],[1,"field-label"],[1,"field-label-text"],[1,"field-label-desc"],[1,"toggle-switch"],["type","checkbox",3,"change","checked"],[1,"toggle-switch-track"],[1,"toggle-switch-thumb"],[1,"admin-grid-limits","gap-4"],[1,"field-label-text","block","mb-1"],[1,"field-label-desc","mb-2"],["type","number","min","0",1,"form-input","w-full",3,"input","value"],["type","number","step","0.1","min","0.1",1,"form-input","w-full",3,"input","value"],[1,"field-row-stacked"],[1,"field-label","max-w-sm"],["type","text","placeholder","email@example.com",1,"form-input","flex-1",3,"input","value"],[1,"field-label","pt-2","max-w-sm"],[1,"form-input","flex-1","min-h-20",3,"input","value","placeholder"],[1,"flex","items-center","justify-between","py-2","admin-border-t","gap-3","pt-4"],[1,"flex","flex-col"],[1,"text-xs","admin-icon-muted"],[1,"admin-text-white","font-mono","text-sm","break-all"],[1,"btn-primary","whitespace-nowrap",3,"click","disabled"],["variant","admin",3,"kudosDetails"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"admin-bg-dark","rounded-lg","p-4"],[1,"text-sm","font-medium","admin-text-light","mb-3"],[1,"space-y-2","text-sm"],[1,"flex","justify-between"],[1,"admin-text-muted"],[1,"space-y-4"],[1,"text-sm","font-medium","admin-text-light","mb-2"],[1,"flex","flex-wrap","gap-2"],[1,"text-xs","font-mono","admin-bg-dark","px-2","py-1","rounded"],[1,"text-xs","admin-text-muted"],[1,"admin-text-light","text-sm"],[1,"text-xs","font-mono","admin-text-muted"],[1,"p-4"],[1,"admin-text-muted","text-center","py-4"],["fill","none","viewBox","0 0 24 24",1,"admin-spinner","w-6","h-6"],[1,"admin-bg-dark","rounded-lg","p-4","space-y-3"],[1,"flex","items-start","justify-between","gap-2"],[1,"min-w-0","flex-1"],[1,"admin-text-white","font-medium","truncate"],[1,"text-xs","font-mono","admin-text-muted","truncate",3,"title"],[1,"text-xs","admin-text-muted","whitespace-nowrap"],[1,"grid","grid-cols-2","gap-2","text-sm"],[1,"admin-text-light","ml-1"],[1,"grid","grid-cols-3","gap-2","text-xs"],[1,"admin-bg-darker","rounded","p-2"],[1,"admin-text-muted","mb-1"],[1,"admin-grid-workers"],[3,"worker","isModerator"],[3,"workerUpdated","workerDeleted","worker","isModerator"],[1,"btn-save-fixed",3,"click","disabled"]],template:function(s,c){if(s&1&&(n(0,"app-admin-toast-bar",0),v("dismiss",function(M){return c.dismissToast(M)}),o(),n(1,"app-admin-dialog",1),l(2,"transloco"),l(3,"transloco"),l(4,"transloco"),l(5,"transloco"),l(6,"transloco"),v("confirm",function(){return c.confirmDialog()})("cancel",function(){return c.closeDialog()}),u(7,ke,3,3,"p",2),o(),ae(8,we,1,1),oe(9,8),n(11,"div",3)(12,"h1",4),r(13),l(14,"transloco"),o(),u(15,Te,12,5,"div",5),n(16,"div",6)(17,"div",7)(18,"input",8),l(19,"transloco"),v("input",function(M){return c.onSearchChange(M)})("keydown.enter",function(){return c.searchUser()}),o(),n(20,"button",9),v("click",function(){return c.searchUser()}),r(21),l(22,"transloco"),o()()(),u(23,Ie,7,3,"div",10)(24,Be,6,3,"div",11)(25,Fe,6,3,"div",11)(26,$t,77,62,"div",12),o(),u(27,jt,3,4,"button",13)),s&2){let y;U("toasts",c.toasts()),t(),U("open",c.dialogOpen())("title",c.dialogType()==="resetSuspicion"?G(2,17,"admin.users.dialog.reset_suspicion_title",q(35,ye,(y=c.selectedUser())==null?null:y.username)):G(3,20,"admin.users.dialog.undelete_title",q(37,ye,(y=c.selectedUser())==null?null:y.username)))("confirmLabel",c.dialogType()==="resetSuspicion"?d(4,23,"admin.users.dialog.confirm"):d(5,25,"admin.users.dialog.undelete_confirm"))("cancelLabel",d(6,27,"admin.users.dialog.cancel"))("loading",c.isUpdating())("variant",c.dialogType()==="resetSuspicion"?"danger":"default"),t(6),x(c.dialogType()==="undeleteUser"?7:-1),t(2),se(c.rawJsonModalOpen()),t(4),_(d(14,29,"admin.users.title")),t(2),x(c.userHistory().length>0?15:-1),t(3),U("value",c.searchQuery())("placeholder",d(19,31,"admin.users.search_placeholder")),t(2),U("disabled",c.loading()||!c.searchQuery()),t(),h(" ",d(22,33,"admin.users.search_button")," "),t(2),x(c.loading()?23:c.userNotFound()?24:c.selectedUser()?26:25),t(4),x(c.isDirty()?27:-1)}},dependencies:[pe,me,ue,he,Ce,re,ge,fe,ve],encapsulation:2,changeDetection:0});let a=p;return a})();export{Si as UserManagementComponent};
