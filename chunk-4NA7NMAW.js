import{a as oe}from"./chunk-BQ3SFYXW.js";import{a as O,b as J}from"./chunk-TWRQSRNJ.js";import{o as ie,p as ne,u as ae}from"./chunk-7P7BAAIV.js";import{a as P}from"./chunk-Z4QX4XJM.js";import"./chunk-T6V27EFK.js";import{a as te}from"./chunk-ISHBUXAM.js";import"./chunk-VFTR325L.js";import{c as Z,d as ee}from"./chunk-BMIYH3UD.js";import{l as X}from"./chunk-3GXWXVSS.js";import{f as A,g as W,k as B}from"./chunk-GZDNXZTC.js";import{$b as E,A as I,Cb as f,Db as _,F as R,Ja as q,Oa as n,Ob as H,Rb as r,S as z,Sb as u,Tb as m,Ub as U,X as k,Za as N,aa as h,ba as g,c as K,ca as w,da as M,ga as Q,gc as p,hc as d,ja as x,k as T,nc as V,ob as b,pb as F,qb as Y,r as G,rb as D,sb as L,tb as C,ub as o,vb as l,wb as y,zb as S}from"./chunk-QF4LG6ZD.js";import"./chunk-4CLCTAJ7.js";var le=(()=>{let c=class c{constructor(){this.httpClient=k(W),this.auth=k(P),this.baseUrl="https://aihorde.net/api/v2"}getHeaders(){let e=this.auth.getStoredApiKey();return e?{apikey:e}:{}}getFilters(e,i){let s=new A;return e!==void 0&&(s=s.set("filter_type",e.toString())),i&&(s=s.set("contains",i)),this.httpClient.get(`${this.baseUrl}/filters`,{headers:this.getHeaders(),params:s}).pipe(I(()=>T([])))}getFilter(e){return this.httpClient.get(`${this.baseUrl}/filters/${e}`,{headers:this.getHeaders()}).pipe(I(()=>T(null)))}createFilter(e){let i=this.auth.getStoredApiKey();return i?this.httpClient.put(`${this.baseUrl}/filters`,e,{headers:{apikey:i}}).pipe(I(()=>T(null))):T(null)}updateFilter(e,i){let s=this.auth.getStoredApiKey();return s?this.httpClient.patch(`${this.baseUrl}/filters/${e}`,i,{headers:{apikey:s}}).pipe(I(()=>T(null))):T(null)}deleteFilter(e){let i=this.auth.getStoredApiKey();return i?this.httpClient.delete(`${this.baseUrl}/filters/${e}`,{headers:{apikey:i},observe:"response"}).pipe(I(()=>T(null)),s=>new K(v=>{s.subscribe({next:$=>{v.next($!==null),v.complete()},error:()=>{v.next(!1),v.complete()}})})):T(!1)}testPrompt(e){let i=this.auth.getStoredApiKey();return i?this.httpClient.post(`${this.baseUrl}/filters`,e,{headers:{apikey:i}}).pipe(I(()=>T(null))):T(null)}getCompiledRegex(e){let i=new A;return e!==void 0&&(i=i.set("filter_type",e.toString())),this.httpClient.get(`${this.baseUrl}/filters/regex`,{headers:this.getHeaders(),params:i}).pipe(I(()=>T([])))}};c.\u0275fac=function(i){return new(i||c)},c.\u0275prov=z({token:c,factory:c.\u0275fac,providedIn:"root"});let t=c;return t})();var j={10:"CSAM",11:"Specific Person",20:"NSFW"};function re(t){return j[t]??`Unknown (${t})`}function se(){return Object.entries(j).map(([t,c])=>({value:parseInt(t,10),label:`${t}: ${c}`}))}var pe=(t,c)=>c.value,ce=(t,c)=>c.id,me=(t,c)=>c.filter_type;function _e(t,c){t&1&&(r(0),p(1,"transloco")),t&2&&m(" ",d(1,1,"admin.filters.prompt_tester.testing")," ")}function fe(t,c){t&1&&(r(0),p(1,"transloco")),t&2&&m(" ",d(1,1,"admin.filters.prompt_tester.test_button")," ")}function ue(t,c){if(t&1){let a=S();o(0,"button",19),f("click",function(){h(a);let i=_(2);return g(i.clearTestResult())}),r(1),p(2,"transloco"),l()}t&2&&(n(),m(" ",d(2,1,"admin.filters.prompt_tester.clear")," "))}function he(t,c){t&1&&(o(0,"span",24),r(1),p(2,"transloco"),l()),t&2&&(n(),u(d(2,1,"admin.filters.prompt_tester.blocked")))}function ge(t,c){t&1&&(o(0,"span",25),r(1),p(2,"transloco"),l()),t&2&&(n(),u(d(2,1,"admin.filters.prompt_tester.allowed")))}function xe(t,c){if(t&1&&(o(0,"span",29),r(1),l()),t&2){let a=c.$implicit;n(),u(a)}}function Ce(t,c){if(t&1&&(o(0,"div",26)(1,"span",27),r(2),p(3,"transloco"),l(),o(4,"div",28),D(5,xe,2,1,"span",29,Y),l()()),t&2){let a=_();n(2),u(d(3,1,"admin.filters.prompt_tester.matches")),n(3),L(a.matches)}}function ve(t,c){if(t&1&&(o(0,"div",20)(1,"div",21)(2,"span",22),r(3),p(4,"transloco"),l(),o(5,"span",23),r(6),l(),b(7,he,3,3,"span",24)(8,ge,3,3,"span",25),l(),b(9,Ce,7,3,"div",26),l()),t&2){let a=c;H("test-result-blocked",a.suspicion>=2)("test-result-safe",a.suspicion<2),n(3),u(d(4,8,"admin.filters.prompt_tester.suspicion")),n(3),u(a.suspicion),n(),F(a.suspicion>=2?7:8),n(2),F(a.matches&&a.matches.length>0?9:-1)}}function be(t,c){if(t&1){let a=S();o(0,"div",8)(1,"div",11)(2,"h2",12),r(3),p(4,"transloco"),l(),o(5,"p",13),r(6),p(7,"transloco"),l(),o(8,"div",14)(9,"textarea",15),p(10,"transloco"),f("input",function(i){h(a);let s=_();return g(s.onTestPromptChange(i))}),l(),o(11,"div",3)(12,"button",16),f("click",function(){h(a);let i=_();return g(i.testPrompt())}),b(13,_e,2,3)(14,fe,2,3),l(),b(15,ue,3,3,"button",17),l(),b(16,ve,10,10,"div",18),l()()()}if(t&2){let a,e=_();n(3),m(" ",d(4,9,"admin.filters.prompt_tester.title")," "),n(3),m(" ",d(7,11,"admin.filters.prompt_tester.description")," "),n(3),C("placeholder",E(d(10,13,"admin.filters.prompt_tester.placeholder")))("value",e.testPromptValue()),n(3),C("disabled",e.testing()||!e.testPromptValue().trim()),n(),F(e.testing()?13:14),n(2),F(e.testResult()?15:-1),n(),F((a=e.testResult())?16:-1,a)}}function Fe(t,c){if(t&1&&(o(0,"option",36),r(1),l()),t&2){let a=c.$implicit;C("value",a.value),n(),u(a.label)}}function Te(t,c){if(t&1){let a=S();o(0,"button",19),f("click",function(){h(a);let i=_(2);return g(i.clearFilters())}),r(1),p(2,"transloco"),l()}t&2&&(n(),m(" ",d(2,1,"admin.filters.clear_filters")," "))}function ye(t,c){t&1&&(o(0,"div",37),w(),o(1,"svg",39),y(2,"circle",40)(3,"path",41),l(),M(),o(4,"span",42),r(5),p(6,"transloco"),l()()),t&2&&(n(5),u(d(6,1,"admin.filters.loading")))}function Se(t,c){t&1&&(o(0,"div",38),w(),o(1,"svg",43),y(2,"path",44),l(),M(),o(3,"span",45),r(4),p(5,"transloco"),l()()),t&2&&(n(4),u(d(5,1,"admin.filters.no_filters")))}function we(t,c){if(t&1&&(o(0,"code",53),r(1),l()),t&2){let a=_().$implicit;n(),u(a.replacement)}}function Ee(t,c){t&1&&(o(0,"span",54),r(1,"-"),l())}function ke(t,c){if(t&1){let a=S();o(0,"tr")(1,"td")(2,"code",50),r(3),l()(),o(4,"td")(5,"span",51),r(6),l()(),o(7,"td",52),r(8),l(),o(9,"td"),b(10,we,2,1,"code",53)(11,Ee,2,0,"span",54),l(),o(12,"td"),r(13),l(),o(14,"td")(15,"div",55)(16,"button",56),p(17,"transloco"),f("click",function(){let i=h(a).$implicit,s=_(3);return g(s.openRawJsonDialog(i))}),w(),o(18,"svg",57),y(19,"path",58),l()(),M(),o(20,"button",56),p(21,"transloco"),f("click",function(){let i=h(a).$implicit,s=_(3);return g(s.openEditDialog(i))}),w(),o(22,"svg",57),y(23,"path",59),l()(),M(),o(24,"button",60),p(25,"transloco"),f("click",function(){let i=h(a).$implicit,s=_(3);return g(s.openDeleteDialog(i))}),w(),o(26,"svg",57),y(27,"path",61),l()()()()()}if(t&2){let a=c.$implicit,e=_(3);n(3),u(a.regex),n(3),U(" ",a.filter_type,": ",e.getTypeLabel(a.filter_type)," "),n(2),m(" ",a.description||"-"," "),n(2),F(a.replacement?10:11),n(3),u(a.user),n(3),C("title",E(d(17,12,"admin.filters.view_json"))),n(4),C("title",E(d(21,14,"admin.filters.edit"))),n(4),C("title",E(d(25,16,"admin.filters.delete")))}}function Me(t,c){if(t&1&&(o(0,"div",46),r(1),p(2,"transloco"),o(3,"strong"),r(4),l(),r(5),p(6,"transloco"),o(7,"strong"),r(8),l(),r(9),p(10,"transloco"),l(),o(11,"div",47)(12,"div",48)(13,"table",49)(14,"thead")(15,"tr")(16,"th"),r(17),p(18,"transloco"),l(),o(19,"th"),r(20),p(21,"transloco"),l(),o(22,"th"),r(23),p(24,"transloco"),l(),o(25,"th"),r(26),p(27,"transloco"),l(),o(28,"th"),r(29),p(30,"transloco"),l(),o(31,"th"),r(32),p(33,"transloco"),l()()(),o(34,"tbody"),D(35,ke,28,18,"tr",null,ce),l()()()()),t&2){let a=_(2);n(),m(" ",d(2,11,"admin.filters.showing")," "),n(3),u(a.filteredFilters().length),n(),m(" ",d(6,13,"admin.filters.of")," "),n(3),u(a.filters().length),n(),m(" ",d(10,15,"admin.filters.filters_label")," "),n(8),u(d(18,17,"admin.filters.table.regex")),n(3),u(d(21,19,"admin.filters.table.type")),n(3),u(d(24,21,"admin.filters.table.description")),n(3),u(d(27,23,"admin.filters.table.replacement")),n(3),u(d(30,25,"admin.filters.table.user")),n(3),u(d(33,27,"admin.filters.table.actions")),n(3),L(a.filteredFilters())}}function Ie(t,c){if(t&1){let a=S();o(0,"div",30)(1,"div",31)(2,"input",32),p(3,"transloco"),f("input",function(i){h(a);let s=_();return g(s.onSearchChange(i))}),l()(),o(4,"div",33)(5,"select",34),f("change",function(i){h(a);let s=_();return g(s.onFilterTypeChange(i))}),o(6,"option",35),r(7),p(8,"transloco"),l(),D(9,Fe,2,2,"option",36,pe),l()(),b(11,Te,3,3,"button",17),l(),b(12,ye,7,3,"div",37)(13,Se,6,3,"div",38)(14,Me,37,29)}if(t&2){let a=_();n(2),C("placeholder",E(d(3,7,"admin.filters.search_placeholder")))("value",a.searchQuery()),n(3),C("value",a.filterTypeFilter()??""),n(2),m(" ",d(8,9,"admin.filters.all_types")," "),n(2),L(a.filterTypeOptions),n(2),F(a.searchQuery()||a.filterTypeFilter()!==null?11:-1),n(),F(a.loading()?12:a.filteredFilters().length===0?13:14)}}function Ve(t,c){t&1&&(o(0,"div",37),w(),o(1,"svg",39),y(2,"circle",40)(3,"path",41),l(),M(),o(4,"span",42),r(5),p(6,"transloco"),l()()),t&2&&(n(5),u(d(6,1,"admin.filters.loading_compiled")))}function Be(t,c){t&1&&(o(0,"div",38),w(),o(1,"svg",43),y(2,"path",58),l(),M(),o(3,"span",45),r(4),p(5,"transloco"),l()()),t&2&&(n(4),u(d(5,1,"admin.filters.no_compiled_regex")))}function Re(t,c){if(t&1){let a=S();o(0,"div",65)(1,"div",66)(2,"div",67)(3,"span",51),r(4),l()(),o(5,"button",68),p(6,"transloco"),f("click",function(){let i=h(a).$implicit,s=_(3);return g(s.copyToClipboard(i.regex))}),w(),o(7,"svg",69),y(8,"path",70),l(),r(9),p(10,"transloco"),l()(),M(),o(11,"div",71)(12,"pre",72)(13,"code"),r(14),l()()()()}if(t&2){let a=c.$implicit,e=_(3);n(4),U(" ",a.filter_type,": ",e.getTypeLabel(a.filter_type)," "),n(),C("title",E(d(6,6,"admin.filters.copy"))),n(4),m(" ",d(10,8,"admin.filters.copy")," "),n(5),u(a.regex)}}function De(t,c){if(t&1&&(o(0,"div",64),D(1,Re,15,10,"div",65,me),l()),t&2){let a=_(2);n(),L(a.compiledRegex())}}function Le(t,c){if(t&1){let a=S();o(0,"div",62)(1,"p",54),r(2),p(3,"transloco"),l(),o(4,"button",63),f("click",function(){h(a);let i=_();return g(i.loadCompiledRegex())}),r(5),p(6,"transloco"),l()(),b(7,Ve,7,3,"div",37)(8,Be,6,3,"div",38)(9,De,3,0,"div",64)}if(t&2){let a=_();n(2),m(" ",d(3,4,"admin.filters.compiled_regex.description")," "),n(2),C("disabled",a.loadingCompiled()),n(),m(" ",d(6,6,"admin.filters.refresh")," "),n(2),F(a.loadingCompiled()?7:a.compiledRegex().length===0?8:9)}}function $e(t,c){t&1&&(r(0),p(1,"transloco")),t&2&&m(" ",d(1,1,"admin.filters.dialog.create_title")," ")}function He(t,c){t&1&&(r(0),p(1,"transloco")),t&2&&m(" ",d(1,1,"admin.filters.dialog.edit_title")," ")}function Ue(t,c){if(t&1&&(o(0,"option",36),r(1),l()),t&2){let a=c.$implicit;C("value",a.value),n(),u(a.label)}}function Pe(t,c){t&1&&(r(0),p(1,"transloco")),t&2&&m(" ",d(1,1,"admin.filters.dialog.saving")," ")}function Oe(t,c){t&1&&(r(0),p(1,"transloco")),t&2&&m(" ",d(1,1,"admin.filters.dialog.create")," ")}function Je(t,c){t&1&&(r(0),p(1,"transloco")),t&2&&m(" ",d(1,1,"admin.filters.dialog.save")," ")}function je(t,c){if(t&1){let a=S();o(0,"div",9)(1,"div",73),f("click",function(){h(a);let i=_();return g(i.closeDialog())}),l(),o(2,"div",74)(3,"h2",75),b(4,$e,2,3)(5,He,2,3),l(),o(6,"div",14)(7,"div",76)(8,"label",77),r(9),p(10,"transloco"),o(11,"span",78),r(12,"*"),l()(),o(13,"input",79),p(14,"transloco"),f("input",function(i){h(a);let s=_();return g(s.onFormRegexChange(i))}),l(),o(15,"p",80),r(16),p(17,"transloco"),l()(),o(18,"div",76)(19,"label",81),r(20),p(21,"transloco"),l(),o(22,"select",82),f("change",function(i){h(a);let s=_();return g(s.onFormFilterTypeChange(i))}),D(23,Ue,2,2,"option",36,pe),l()(),o(25,"div",76)(26,"label",83),r(27),p(28,"transloco"),l(),o(29,"textarea",84),p(30,"transloco"),f("input",function(i){h(a);let s=_();return g(s.onFormDescriptionChange(i))}),l()(),o(31,"div",76)(32,"label",85),r(33),p(34,"transloco"),l(),o(35,"input",86),p(36,"transloco"),f("input",function(i){h(a);let s=_();return g(s.onFormReplacementChange(i))}),l(),o(37,"p",80),r(38),p(39,"transloco"),l()()(),o(40,"div",87)(41,"button",19),f("click",function(){h(a);let i=_();return g(i.closeDialog())}),r(42),p(43,"transloco"),l(),o(44,"button",16),f("click",function(){h(a);let i=_();return g(i.confirmDialog())}),b(45,Pe,2,3)(46,Oe,2,3)(47,Je,2,3),l()()()()}if(t&2){let a=_();n(4),F(a.dialogType()==="create"?4:5),n(5),m(" ",d(10,20,"admin.filters.form.regex")," "),n(4),C("placeholder",E(d(14,22,"admin.filters.form.regex_placeholder")))("value",a.formRegex()),n(3),m(" ",d(17,24,"admin.filters.form.regex_hint")," "),n(4),m(" ",d(21,26,"admin.filters.form.filter_type")," "),n(2),C("value",a.formFilterType()),n(),L(a.filterTypeOptions),n(4),m(" ",d(28,28,"admin.filters.form.description")," "),n(2),C("placeholder",E(d(30,30,"admin.filters.form.description_placeholder")))("value",a.formDescription()),n(4),m(" ",d(34,32,"admin.filters.form.replacement")," "),n(2),C("placeholder",E(d(36,34,"admin.filters.form.replacement_placeholder")))("value",a.formReplacement()),n(3),m(" ",d(39,36,"admin.filters.form.replacement_hint")," "),n(4),m(" ",d(43,38,"admin.filters.dialog.cancel")," "),n(2),C("disabled",a.isUpdating()||!a.formRegex().trim()),n(),F(a.isUpdating()?45:a.dialogType()==="create"?46:47)}}function Ae(t,c){if(t&1&&(o(0,"div",88)(1,"div",91)(2,"div")(3,"span",54),r(4),p(5,"transloco"),l(),o(6,"code",92),r(7),l()(),o(8,"div")(9,"span",54),r(10),p(11,"transloco"),l(),o(12,"span",93),r(13),l()()()()),t&2){let a=c,e=_(2);n(4),m("",d(5,5,"admin.filters.table.regex"),":"),n(3),u(a.regex),n(3),m("",d(11,7,"admin.filters.table.type"),":"),n(3),U(" ",a.filter_type,": ",e.getTypeLabel(a.filter_type)," ")}}function Ke(t,c){t&1&&(r(0),p(1,"transloco")),t&2&&m(" ",d(1,1,"admin.filters.dialog.deleting")," ")}function Ge(t,c){t&1&&(r(0),p(1,"transloco")),t&2&&m(" ",d(1,1,"admin.filters.dialog.delete")," ")}function ze(t,c){if(t&1){let a=S();o(0,"div",9)(1,"div",73),f("click",function(){h(a);let i=_();return g(i.closeDialog())}),l(),o(2,"div",74)(3,"h2",12),r(4),p(5,"transloco"),l(),o(6,"p",13),r(7),p(8,"transloco"),l(),b(9,Ae,14,9,"div",88),o(10,"div",89)(11,"button",19),f("click",function(){h(a);let i=_();return g(i.closeDialog())}),r(12),p(13,"transloco"),l(),o(14,"button",90),f("click",function(){h(a);let i=_();return g(i.confirmDialog())}),b(15,Ke,2,3)(16,Ge,2,3),l()()()()}if(t&2){let a,e=_();n(4),m(" ",d(5,6,"admin.filters.dialog.delete_title")," "),n(3),m(" ",d(8,8,"admin.filters.dialog.delete_confirm")," "),n(2),F((a=e.selectedFilter())?9:-1,a),n(3),m(" ",d(13,10,"admin.filters.dialog.cancel")," "),n(2),C("disabled",e.isUpdating()),n(),F(e.isUpdating()?15:16)}}function Qe(t,c){if(t&1){let a=S();o(0,"div",9)(1,"div",73),f("click",function(){h(a);let i=_();return g(i.closeDialog())}),l(),o(2,"div",94)(3,"div",95)(4,"h2",96),r(5),p(6,"transloco"),l(),o(7,"button",97),f("click",function(){h(a);let i=_();return g(i.copyToClipboard(i.selectedFilterJson()))}),w(),o(8,"svg",69),y(9,"path",70),l(),r(10),p(11,"transloco"),l()(),M(),o(12,"div",98)(13,"pre",72),y(14,"code",99),l()(),o(15,"div",100)(16,"button",19),f("click",function(){h(a);let i=_();return g(i.closeDialog())}),r(17),p(18,"transloco"),l()()()()}if(t&2){let a=_();n(5),m(" ",d(6,4,"admin.filters.dialog.raw_json_title")," "),n(5),m(" ",d(11,6,"admin.filters.copy")," "),n(4),C("innerHTML",a.selectedFilterJsonHighlighted(),q),n(3),m(" ",d(18,8,"admin.filters.dialog.close")," ")}}var ht=(()=>{let c=class c{constructor(){this.title=k(X),this.translator=k(te),this.destroyRef=k(Q),this.filterService=k(le),this.auth=k(P),this.activeTab=x("tester"),this.filters=x([]),this.loading=x(!1),this.searchQuery=x(""),this.filterTypeFilter=x(null),this.compiledRegex=x([]),this.loadingCompiled=x(!1),this.dialogOpen=x(!1),this.dialogType=x("create"),this.selectedFilter=x(null),this.isUpdating=x(!1),this.formRegex=x(""),this.formFilterType=x(10),this.formDescription=x(""),this.formReplacement=x(""),this.isDirty=x(!1),this.testPromptValue=x(""),this.testResult=x(null),this.testing=x(!1),this.testerExpanded=x(!1),this.toasts=x([]),this.filterTypeOptions=se(),this.filterTypeLabelFn=re,this.filteredFilters=V(()=>{let e=this.filters(),i=this.searchQuery().toLowerCase().trim(),s=this.filterTypeFilter();return i&&(e=e.filter(v=>v.regex.toLowerCase().includes(i)||(v.description?.toLowerCase().includes(i)??!1)||v.user.toLowerCase().includes(i)||v.id.toLowerCase().includes(i))),s!==null&&(e=e.filter(v=>v.filter_type===s)),e}),this.selectedFilterJson=V(()=>O(this.selectedFilter())),this.selectedFilterJsonHighlighted=V(()=>J(this.selectedFilterJson())),this.allFiltersJson=V(()=>O(this.filters())),this.allFiltersJsonHighlighted=V(()=>J(this.allFiltersJson())),this.compiledRegexJson=V(()=>O(this.compiledRegex())),this.compiledRegexJsonHighlighted=V(()=>J(this.compiledRegexJson()))}ngOnInit(){G([this.translator.get("admin.filters.title"),this.translator.get("app_title")]).pipe(B(this.destroyRef)).subscribe(([e,i])=>{this.title.setTitle(`${e} | ${i}`)}),this.loadFilters()}switchTab(e){this.activeTab.set(e),e==="compiled"&&this.compiledRegex().length===0&&this.loadCompiledRegex()}loadFilters(){this.loading.set(!0),this.filterService.getFilters().pipe(B(this.destroyRef),R(()=>this.loading.set(!1))).subscribe({next:e=>{this.filters.set(e)},error:()=>{this.showToast("error","Failed to load filters.")}})}loadCompiledRegex(){this.loadingCompiled.set(!0),this.filterService.getCompiledRegex().pipe(B(this.destroyRef),R(()=>this.loadingCompiled.set(!1))).subscribe({next:e=>{this.compiledRegex.set(e)},error:()=>{this.showToast("error","Failed to load compiled regex.")}})}onSearchChange(e){let i=e.target;this.searchQuery.set(i.value)}onFilterTypeChange(e){let s=e.target.value;this.filterTypeFilter.set(s?parseInt(s,10):null)}clearFilters(){this.searchQuery.set(""),this.filterTypeFilter.set(null)}openCreateDialog(){this.formRegex.set(""),this.formFilterType.set(10),this.formDescription.set(""),this.formReplacement.set(""),this.isDirty.set(!1),this.dialogType.set("create"),this.dialogOpen.set(!0)}openEditDialog(e){this.selectedFilter.set(e),this.formRegex.set(e.regex),this.formFilterType.set(e.filter_type),this.formDescription.set(e.description??""),this.formReplacement.set(e.replacement??""),this.isDirty.set(!1),this.dialogType.set("edit"),this.dialogOpen.set(!0)}openDeleteDialog(e){this.selectedFilter.set(e),this.dialogType.set("delete"),this.dialogOpen.set(!0)}openRawJsonDialog(e){this.selectedFilter.set(e),this.dialogType.set("rawJson"),this.dialogOpen.set(!0)}closeDialog(){this.dialogOpen.set(!1),this.selectedFilter.set(null)}onFormFieldChange(){this.isDirty.set(!0)}onFormRegexChange(e){let i=e.target;this.formRegex.set(i.value),this.onFormFieldChange()}onFormFilterTypeChange(e){let i=e.target;this.formFilterType.set(parseInt(i.value,10)),this.onFormFieldChange()}onFormDescriptionChange(e){let i=e.target;this.formDescription.set(i.value),this.onFormFieldChange()}onFormReplacementChange(e){let i=e.target;this.formReplacement.set(i.value),this.onFormFieldChange()}confirmDialog(){let e=this.dialogType();e==="create"?this.createFilter():e==="edit"?this.updateFilter():e==="delete"?this.deleteFilter():e==="rawJson"&&this.closeDialog()}createFilter(){let e=this.formRegex().trim();if(!e){this.showToast("error","Regex pattern is required.");return}this.isUpdating.set(!0),this.filterService.createFilter({regex:e,filter_type:this.formFilterType(),description:this.formDescription().trim()||void 0,replacement:this.formReplacement()||void 0}).pipe(B(this.destroyRef),R(()=>this.isUpdating.set(!1))).subscribe({next:i=>{i?(this.showToast("success","Filter created successfully."),this.closeDialog(),this.loadFilters()):this.showToast("error","Failed to create filter.")},error:()=>{this.showToast("error","Failed to create filter.")}})}updateFilter(){let e=this.selectedFilter();if(!e)return;let i=this.formRegex().trim();if(!i){this.showToast("error","Regex pattern is required.");return}this.isUpdating.set(!0),this.filterService.updateFilter(e.id,{regex:i,filter_type:this.formFilterType(),description:this.formDescription().trim()||void 0,replacement:this.formReplacement()||void 0}).pipe(B(this.destroyRef),R(()=>this.isUpdating.set(!1))).subscribe({next:s=>{s?(this.showToast("success","Filter updated successfully."),this.closeDialog(),this.loadFilters()):this.showToast("error","Failed to update filter.")},error:()=>{this.showToast("error","Failed to update filter.")}})}deleteFilter(){let e=this.selectedFilter();e&&(this.isUpdating.set(!0),this.filterService.deleteFilter(e.id).pipe(B(this.destroyRef),R(()=>this.isUpdating.set(!1))).subscribe({next:i=>{i?(this.showToast("success","Filter deleted successfully."),this.closeDialog(),this.loadFilters()):this.showToast("error","Failed to delete filter.")},error:()=>{this.showToast("error","Failed to delete filter.")}}))}toggleTester(){this.testerExpanded.set(!this.testerExpanded())}onTestPromptChange(e){let i=e.target;this.testPromptValue.set(i.value)}testPrompt(){let e=this.testPromptValue().trim();if(!e){this.showToast("error","Please enter a prompt to test.");return}this.testing.set(!0),this.testResult.set(null),this.filterService.testPrompt({prompt:e}).pipe(B(this.destroyRef),R(()=>this.testing.set(!1))).subscribe({next:i=>{i?this.testResult.set(i):this.showToast("error","Failed to test prompt.")},error:()=>{this.showToast("error","Failed to test prompt.")}})}clearTestResult(){this.testResult.set(null),this.testPromptValue.set("")}copyToClipboard(e){navigator.clipboard.writeText(e).then(()=>this.showToast("success","Copied to clipboard."),()=>this.showToast("error","Failed to copy to clipboard."))}showToast(e,i,s=e==="success"){let v=`toast-${Date.now()}-${Math.random().toString(36).slice(2,7)}`;this.toasts.update($=>[...$,{id:v,type:e,message:i}]),s&&setTimeout(()=>this.dismissToast(v),3e3)}dismissToast(e){this.toasts.update(i=>i.filter(s=>s.id!==e))}hasUnsavedChanges(){return this.isDirty()&&this.dialogOpen()}getTypeLabel(e){return j[e]??`Unknown (${e})`}};c.\u0275fac=function(i){return new(i||c)},c.\u0275cmp=N({type:c,selectors:[["app-filter-management"]],decls:29,vars:32,consts:[[1,"admin-container-lg"],[1,"admin-header"],[1,"admin-heading-page"],[1,"flex","gap-2"],["type","button",1,"btn-muted",3,"click","disabled"],["type","button",1,"btn-primary",3,"click"],[1,"tab-nav"],["type","button",1,"tab-btn",3,"click"],[1,"panel"],[1,"modal"],[3,"dismiss","toasts"],[1,"p-6"],[1,"admin-heading-section","mb-4"],[1,"admin-text-muted","mb-4"],[1,"flex","flex-col","gap-4"],["rows","3",1,"form-textarea",3,"input","value","placeholder"],["type","button",1,"btn-primary",3,"click","disabled"],["type","button",1,"btn-muted"],[1,"test-result",3,"test-result-blocked","test-result-safe"],["type","button",1,"btn-muted",3,"click"],[1,"test-result"],[1,"test-result-header"],[1,"test-result-label"],[1,"test-result-value"],[1,"badge-base","badge-danger","ml-2"],[1,"badge-base","badge-success","ml-2"],[1,"test-result-matches"],[1,"test-result-matches-label"],[1,"test-result-matches-list"],[1,"badge-base","badge-warning"],[1,"filter-controls","mb-6"],[1,"filter-search"],["type","text",1,"form-input",3,"input","value","placeholder"],[1,"filter-type-select"],[1,"form-select",3,"change","value"],["value",""],[3,"value"],[1,"admin-loading"],[1,"admin-empty"],["fill","none","viewBox","0 0 24 24","aria-hidden","true",1,"admin-spinner"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"admin-spinner-track"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"admin-spinner-head"],[1,"admin-loading-text"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"admin-empty-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"],[1,"admin-empty-text"],[1,"filter-count","mb-4"],[1,"panel","overflow-hidden"],[1,"data-table-wrapper"],[1,"data-table"],[1,"data-table-mono","data-table-mono-primary"],[1,"badge-base","badge-info"],[1,"data-table-mono-primary"],[1,"data-table-mono","data-table-mono-accent"],[1,"admin-text-muted"],[1,"data-table-actions"],["type","button",1,"btn-icon",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["type","button",1,"btn-icon","btn-icon-danger",3,"click","title"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"compiled-regex-header","mb-6"],["type","button",1,"btn-muted","mt-4",3,"click","disabled"],[1,"compiled-regex-list"],[1,"panel","mb-4"],[1,"compiled-regex-header-row"],[1,"compiled-regex-type"],["type","button",1,"btn-muted","btn-sm",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"],[1,"compiled-regex-content"],[1,"code-block"],[1,"modal-backdrop",3,"click"],[1,"dialog-panel"],[1,"admin-heading-section","mb-6"],[1,"form-group"],["for","filter-regex",1,"form-label"],[1,"text-red-500"],["id","filter-regex","type","text",1,"form-input",3,"input","value","placeholder"],[1,"form-hint"],["for","filter-type",1,"form-label"],["id","filter-type",1,"form-select",3,"change","value"],["for","filter-description",1,"form-label"],["id","filter-description","rows","3",1,"form-textarea",3,"input","value","placeholder"],["for","filter-replacement",1,"form-label"],["id","filter-replacement","type","text",1,"form-input",3,"input","value","placeholder"],[1,"flex","justify-end","gap-3","mt-6"],[1,"panel","p-4","mb-6"],[1,"flex","justify-end","gap-3"],["type","button",1,"btn-danger",3,"click","disabled"],[1,"flex","flex-col","gap-2"],[1,"data-table-mono","data-table-mono-primary","ml-2"],[1,"badge-base","badge-info","ml-2"],[1,"dialog-panel","worker-modal-panel-large"],[1,"flex","justify-between","items-center","mb-4"],[1,"admin-heading-section"],["type","button",1,"btn-muted","btn-sm",3,"click"],[1,"worker-modal-scroll"],[3,"innerHTML"],[1,"flex","justify-end","mt-6"]],template:function(i,s){i&1&&(o(0,"div",0)(1,"div",1)(2,"h1",2),r(3),p(4,"transloco"),l(),o(5,"div",3)(6,"button",4),f("click",function(){return s.loadFilters()}),r(7),p(8,"transloco"),l(),o(9,"button",5),f("click",function(){return s.openCreateDialog()}),r(10),p(11,"transloco"),l()()(),o(12,"div",6)(13,"button",7),f("click",function(){return s.switchTab("tester")}),r(14),p(15,"transloco"),l(),o(16,"button",7),f("click",function(){return s.switchTab("filters")}),r(17),p(18,"transloco"),l(),o(19,"button",7),f("click",function(){return s.switchTab("compiled")}),r(20),p(21,"transloco"),l()(),b(22,be,17,15,"div",8),b(23,Ie,15,11),b(24,Le,10,8),l(),b(25,je,48,40,"div",9),b(26,ze,17,12,"div",9),b(27,Qe,19,10,"div",9),o(28,"app-admin-toast-bar",10),f("dismiss",function($){return s.dismissToast($)}),l()),i&2&&(n(3),u(d(4,20,"admin.filters.title")),n(3),C("disabled",s.loading()),n(),m(" ",d(8,22,"admin.filters.refresh")," "),n(3),m(" ",d(11,24,"admin.filters.create")," "),n(3),H("active",s.activeTab()==="tester"),n(),m(" ",d(15,26,"admin.filters.tabs.prompt_tester")," "),n(2),H("active",s.activeTab()==="filters"),n(),m(" ",d(18,28,"admin.filters.tabs.filters")," "),n(2),H("active",s.activeTab()==="compiled"),n(),m(" ",d(21,30,"admin.filters.tabs.compiled_regex")," "),n(2),F(s.activeTab()==="tester"?22:-1),n(),F(s.activeTab()==="filters"?23:-1),n(),F(s.activeTab()==="compiled"?24:-1),n(),F(s.dialogOpen()&&(s.dialogType()==="create"||s.dialogType()==="edit")?25:-1),n(),F(s.dialogOpen()&&s.dialogType()==="delete"?26:-1),n(),F(s.dialogOpen()&&s.dialogType()==="rawJson"?27:-1),n(),C("toasts",s.toasts()))},dependencies:[Z,ee,ae,ie,ne,oe],encapsulation:2,changeDetection:0});let t=c;return t})();export{ht as FilterManagementComponent};
