<section class="section-primary">
  <div class="container-content-sm">
    <div class="container-page-content">
      <!-- Page Header -->
      <div class="container-centered-md">
        <h1 class="heading-page-title">
          {{ "guis_and_tools_page.title" | transloco }}
        </h1>
        <p class="text-description">
          {{ "guis_and_tools_page.description" | transloco }}
        </p>
      </div>

      <!-- Collapsible Beginner Introduction -->
      <app-beginner-header [disableLinks]="true" />

      <!-- Sticky Filter Bar -->
      <div class="tools-filter-bar">
        <div class="tools-filter-bar-content">
          <!-- Search Input -->
          <div class="tools-search-wrapper">
            <svg
              class="tools-search-icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              />
            </svg>
            <input
              type="text"
              class="tools-search-input"
              [placeholder]="
                'guis_and_tools_page.search_placeholder' | transloco
              "
              [ngModel]="searchQuery()"
              (ngModelChange)="searchQuery.set($event)"
              aria-label="Search tools and GUIs"
            />
            @if (searchQuery()) {
              <button
                type="button"
                class="tools-search-clear"
                (click)="searchQuery.set('')"
                aria-label="Clear search"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  />
                </svg>
              </button>
            }
          </div>

          <!-- Filter Toggle Button -->
          <button
            type="button"
            class="tools-filter-toggle"
            [class.active]="activeFilterCount() > 0"
            (click)="toggleFiltersPanel()"
            [attr.aria-expanded]="showFiltersPanel()"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
              />
            </svg>
            <span class="visible-sm-up">{{
              "guis_and_tools_page.filters" | transloco
            }}</span>
            @if (activeFilterCount() > 0) {
              <span class="tools-filter-count">{{ activeFilterCount() }}</span>
            }
          </button>

          <!-- View Mode Toggle (Desktop Only) -->
          <div class="tools-view-toggle">
            <button
              type="button"
              class="tools-view-btn"
              [class.active]="viewMode() === 'table'"
              (click)="setViewMode('table')"
              aria-label="Table view"
              title="Table view"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 10h16M4 14h16M4 18h16"
                />
              </svg>
            </button>
            <button
              type="button"
              class="tools-view-btn"
              [class.active]="viewMode() === 'grid'"
              (click)="setViewMode('grid')"
              aria-label="Grid view"
              title="Grid view"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
                />
              </svg>
            </button>
          </div>

          <!-- Results Count -->
          <div class="tools-results-count">
            {{ filteredItems().length }}
            {{ "guis_and_tools_page.results" | transloco }}
          </div>
        </div>

        <!-- Expandable Filters Panel -->
        @if (showFiltersPanel()) {
          <div class="tools-filters-panel">
            <div class="tools-filters-grid">
              <!-- Primary Filters -->
              <div class="tools-filter-group">
                <div class="tools-filter-group-header">
                  <span class="tools-filter-group-title">{{
                    "guis_and_tools_page.filter_primary" | transloco
                  }}</span>
                  <button
                    type="button"
                    class="link-btn-sm"
                    (click)="selectAllTypes()"
                  >
                    {{ "guis_and_tools_page.select_all" | transloco }}
                  </button>
                </div>
                <div class="tools-filter-chips">
                  @for (category of primaryCategories(); track category) {
                    <button
                      type="button"
                      class="tools-filter-chip"
                      [class.active]="isTypeSelected(category)"
                      (click)="toggleType(category)"
                    >
                      {{ category }}
                    </button>
                  }
                </div>
              </div>

              <!-- Secondary Filters -->
              <div class="tools-filter-group">
                <div class="tools-filter-group-header">
                  <span class="tools-filter-group-title">{{
                    "guis_and_tools_page.filter_secondary" | transloco
                  }}</span>
                  @if (selectedCategories().size > 0) {
                    <button
                      type="button"
                      class="link-btn-sm"
                      (click)="clearAllCategories()"
                    >
                      {{ "guis_and_tools_page.clear_all" | transloco }}
                    </button>
                  }
                </div>
                <div class="tools-filter-chips">
                  @for (category of secondaryCategories(); track category) {
                    <button
                      type="button"
                      class="tools-filter-chip"
                      [class.active]="isCategorySelected(category)"
                      (click)="toggleCategory(category)"
                    >
                      {{ category }}
                    </button>
                  }
                </div>
              </div>
            </div>

            <!-- Clear All Filters -->
            @if (activeFilterCount() > 0) {
              <div class="tools-filters-actions">
                <button
                  type="button"
                  class="btn-muted btn-sm"
                  (click)="clearAllFilters()"
                >
                  {{ "guis_and_tools_page.clear_all_filters" | transloco }}
                </button>
              </div>
            }
          </div>
        }
      </div>

      <!-- Main Content Layout with TOC Sidebar -->
      <div class="tools-layout">
        <!-- Table of Contents Sidebar (Desktop) -->
        <aside class="tools-toc">
          <nav class="tools-toc-nav" aria-label="Table of contents">
            <h2 class="tools-toc-title">
              {{ "guis_and_tools_page.sections" | transloco }}
            </h2>
            <ul class="tools-toc-list">
              @for (section of visibleSections(); track section.id) {
                <li>
                  <a
                    class="tools-toc-link"
                    [class.active]="activeSection() === section.id"
                    (click)="scrollToSection(section.id, $event)"
                    [href]="'#section-' + section.id"
                  >
                    <span class="tools-toc-link-text">{{
                      section.titleKey | transloco
                    }}</span>
                    <span class="tools-toc-link-count">{{
                      section.items().length
                    }}</span>
                  </a>
                </li>
              }
            </ul>
          </nav>
        </aside>

        <!-- Main Content -->
        <div class="tools-content">
          <!-- Mobile Section Pills -->
          <div class="tools-section-pills">
            @for (section of visibleSections(); track section.id) {
              <a
                class="tools-section-pill"
                [class.active]="activeSection() === section.id"
                (click)="scrollToSection(section.id, $event)"
                [href]="'#section-' + section.id"
              >
                {{ section.titleKey | transloco }}
                <span class="tools-section-pill-count">{{
                  section.items().length
                }}</span>
              </a>
            }
          </div>

          <!-- Items List -->
          <div class="stack-lg">
            @for (section of sections; track section.id) {
              <app-item-list-section
                [id]="'section-' + section.id"
                [items]="section.items()"
                [sectionName]="section.id"
                [title]="section.titleKey"
                [expandedRows]="expandedRows"
                [collapsedSections]="collapsedSections"
                [viewMode]="viewMode()"
                (rowToggle)="toggleRow($event)"
                (sectionToggle)="toggleSection($event)"
              />
            }

            @if (filteredItems().length === 0) {
              <div class="state-empty">
                <svg
                  class="state-empty-icon"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="1.5"
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                  />
                </svg>
                <p class="state-empty-text">
                  {{ "guis_and_tools_page.no_results" | transloco }}
                </p>
                @if (activeFilterCount() > 0 || searchQuery()) {
                  <button
                    type="button"
                    class="btn-muted btn-sm spaced-top"
                    (click)="clearAllFilters()"
                  >
                    {{ "guis_and_tools_page.clear_all_filters" | transloco }}
                  </button>
                }
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scroll to Top Button -->
  @if (showScrollToTop()) {
    <button
      type="button"
      (click)="scrollToTop()"
      class="scroll-to-top-btn"
      aria-label="Scroll to top"
    >
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M5 10l7-7m0 0l7 7m-7-7v18"
        />
      </svg>
    </button>
  }
</section>
