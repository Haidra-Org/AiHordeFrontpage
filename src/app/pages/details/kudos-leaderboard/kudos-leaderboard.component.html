<div class="stack-lg">
  <!-- Header with Refresh -->
  <div class="details-tabs">
    <button
      type="button"
      class="btn-source-control"
      (click)="loadLeaderboard()"
      [disabled]="loading()"
    >
      @if (loading()) {
        <div class="spinner spinner-sm" aria-hidden="true"></div>
      } @else {
        <svg
          class="icon-sm"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"
          />
        </svg>
      }
      {{ "details.leaderboard.refresh" | transloco }}
    </button>
  </div>

  <!-- Error State -->
  @if (error()) {
    <div class="state-container state-container-sm state-error">
      <svg
        class="state-icon"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"
        />
      </svg>
      <p>{{ error() }}</p>
      <button
        type="button"
        class="btn-source-control"
        (click)="loadLeaderboard()"
      >
        {{ "details.leaderboard.retry" | transloco }}
      </button>
    </div>
  }

  <!-- Loading State -->
  @if (loading() && !error()) {
    <div class="state-container state-container-sm text-secondary">
      <div class="spinner spinner-md"></div>
      <p>{{ "details.leaderboard.loading" | transloco }}</p>
    </div>
  }

  <!-- Content -->
  @if (!loading() && !error() && users().length > 0) {
    <!-- Info Cards Side by Side -->
    <div class="usage-totals-grid">
      <!-- Appreciation Message -->
      <div class="card card-bg-secondary">
        <div class="flex items-start gap-3">
          <svg
            class="icon-sm text-brand-purple flex-shrink-0 mt-0.5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"
            />
          </svg>
          <div>
            <h3 class="font-semibold text-primary">
              {{ "details.leaderboard.appreciation_title" | transloco }}
            </h3>
            <p class="text-secondary text-sm mt-1">
              {{ "details.leaderboard.appreciation_message" | transloco }}
            </p>
          </div>
        </div>
      </div>

      <!-- Kudos Explanation -->
      <div class="card card-bg-primary">
        <h3 class="heading-card">
          {{ "details.leaderboard.what_kudos_represent" | transloco }}
        </h3>
        <div class="prose-content text-sm">
          <p>{{ "details.leaderboard.kudos_explanation_1" | transloco }}</p>
          <p class="mt-2">
            {{ "details.leaderboard.kudos_explanation_2" | transloco }}
          </p>
          <p class="mt-2">
            <a routerLink="/faq" class="link">
              {{ "details.leaderboard.learn_more_faq" | transloco }}
            </a>
          </p>
        </div>
      </div>
    </div>

    <!-- Find My Rank Section -->
    <div class="card card-bg-secondary card-full">
      <div class="stack-sm">
        <div class="text-center">
          <h3 class="heading-card">
            {{ "details.leaderboard.find_my_rank" | transloco }}
          </h3>
          <p class="text-secondary text-sm">
            {{ "details.leaderboard.find_my_rank_description" | transloco }}
          </p>
        </div>

        <!-- Rank Result Display -->
        @if (rankSearched() && userRank() !== null) {
          <div class="card card-bg-primary">
            <div class="flex flex-col items-center gap-3">
              <div class="flex flex-col items-center gap-1">
                <span class="text-secondary text-sm font-medium">{{
                  "details.leaderboard.your_rank" | transloco
                }}</span>
                <span
                  class="text-5xl font-bold text-primary"
                  style="font-variant-numeric: tabular-nums"
                  >#{{ userRank() | number }}</span
                >
              </div>

              @if (showThankYou()) {
                <div
                  class="flex items-center gap-2 text-brand-purple text-sm font-medium"
                >
                  <svg
                    class="icon-sm flex-shrink-0"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"
                    />
                  </svg>
                  <span>{{
                    "details.leaderboard.thank_you_message" | transloco
                  }}</span>
                </div>
              }
            </div>
          </div>
        }

        <!-- Action Button -->
        <div class="flex justify-center">
          <button
            type="button"
            class="btn-primary"
            [class.btn-disabled]="!isLoggedIn()"
            [disabled]="!isLoggedIn() || searchingRank()"
            (click)="findMyRank()"
            [title]="
              isLoggedIn()
                ? ''
                : ('details.leaderboard.login_to_rate' | transloco)
            "
          >
            @if (searchingRank()) {
              <div class="spinner spinner-sm" aria-hidden="true"></div>
              {{ "details.leaderboard.searching" | transloco }}
            } @else if (!isLoggedIn()) {
              {{ "details.leaderboard.login_to_rate" | transloco }}
            } @else {
              {{ "details.leaderboard.find_my_rank_button" | transloco }}
            }
          </button>
        </div>
      </div>
    </div>

    <!-- Leaderboard Table -->
    <div class="models-table">
      <div class="models-table-header leaderboard-table-header">
        <span class="models-table-th">{{
          "details.leaderboard.rank" | transloco
        }}</span>
        <span class="models-table-th">{{
          "details.leaderboard.username" | transloco
        }}</span>
        <span class="models-table-th models-table-th-right">{{
          "details.leaderboard.kudos" | transloco
        }}</span>
      </div>
      @for (user of users(); track user.id; let i = $index) {
        <div class="models-table-row leaderboard-table-row">
          <div class="models-table-cell">
            <span
              class="model-rank-badge"
              [class.rank-1]="i === 0"
              [class.rank-2]="i === 1"
              [class.rank-3]="i === 2"
            >
              @if (i === 0) {
                ğŸ¥‡
              } @else if (i === 1) {
                ğŸ¥ˆ
              } @else if (i === 2) {
                ğŸ¥‰
              } @else {
                {{ i + 1 }}
              }
            </span>
          </div>
          <div class="models-table-cell-name">
            <span class="models-table-name" [title]="user.username">
              {{ user.username }}
            </span>
          </div>
          <div class="models-table-cell">
            <span class="models-table-label">{{
              "details.leaderboard.kudos" | transloco
            }}</span>
            <span class="models-table-value">
              {{ user.kudos | number }}
            </span>
          </div>
        </div>
      }
    </div>

    <!-- Footer Note -->
    <div class="card card-bg-secondary">
      <p class="text-secondary text-sm text-center">
        {{ "details.leaderboard.footer_note" | transloco }}
      </p>
    </div>
  }

  <!-- Empty State -->
  @if (!loading() && !error() && users().length === 0) {
    <div class="state-container state-container-sm state-muted">
      <p>{{ "details.leaderboard.no_users" | transloco }}</p>
    </div>
  }
</div>
