<div class="stack-lg">
  <!-- Back Navigation -->
  <div>
    <button type="button" class="btn-source-control" (click)="goBack()">
      <svg
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"
        />
      </svg>
      {{ "styles.back_to_list" | transloco }}
    </button>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="state-container text-secondary">
      <div class="spinner spinner-lg"></div>
      <p>{{ "styles.loading" | transloco }}</p>
    </div>
  }

  <!-- Error State -->
  @if (error() && !loading()) {
    <div class="state-container state-error">
      <svg
        class="state-icon"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"
        />
      </svg>
      <p>{{ error() }}</p>
      <button
        type="button"
        class="btn-source-control"
        [routerLink]="['/details/styles']"
      >
        {{ "styles.back_to_list" | transloco }}
      </button>
    </div>
  }

  <!-- Edit Form -->
  @if (style() && editMode() && !loading()) {
    <app-style-form
      [mode]="'edit'"
      [styleType]="styleType()"
      [initialValues]="style()"
      [saving]="saving()"
      (formSubmit)="onFormSubmit($event)"
      (formCancel)="onFormCancel()"
    />
  }

  <!-- Style Details View - Single Card -->
  @if (style() && !editMode() && !loading()) {
    <article class="card card-bg-primary card-full style-detail-card">
      <!-- Header Section -->
      <header class="style-detail-header">
        <div class="style-detail-title-row">
          <div class="style-detail-title-section">
            <!-- Badges -->
            <div class="style-detail-badges">
              <!-- Type Badge -->
              <span
                class="badge-base"
                [class.badge-primary]="isImageStyle()"
                [class.badge-success]="isTextStyle()"
              >
                @if (isImageStyle()) {
                  {{ "styles.type.image" | transloco }}
                } @else {
                  {{ "styles.type.text" | transloco }}
                }
              </span>

              <!-- NSFW Badge -->
              @if (style()?.nsfw) {
                <span class="badge-base badge-danger">NSFW</span>
              }

              <!-- Public/Private Badge -->
              <span
                class="badge-base"
                [class.badge-success]="style()?.public"
                [class.badge-secondary]="!style()?.public"
              >
                @if (style()?.public) {
                  {{ "styles.public" | transloco }}
                } @else {
                  {{ "styles.private" | transloco }}
                }
              </span>
            </div>

            <!-- Title -->
            <h1 class="style-detail-title">{{ style()?.name }}</h1>

            <!-- Meta Info -->
            <div class="style-detail-meta">
              <span>{{ "styles.by" | transloco }} {{ style()?.creator }}</span>
              <span class="style-detail-meta-divider">•</span>
              <span>{{ style()?.use_count }} {{ "styles.uses" | transloco }}</span>
              <span class="style-detail-meta-divider">•</span>
              <span class="style-detail-id">{{ style()?.id }}</span>
            </div>

            <!-- Description (inline with header) -->
            @if (style()?.info) {
              <p class="style-detail-description">{{ style()?.info }}</p>
            }
          </div>

          <!-- Actions -->
          <div class="style-detail-actions">
            <button
              type="button"
              class="btn-source-control btn-sm"
              (click)="toggleJsonView()"
            >
              <svg
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5"
                />
              </svg>
              {{ showJsonView() ? ("styles.hide_json" | transloco) : ("styles.show_json" | transloco) }}
            </button>

            @if (isOwner()) {
              <button
                type="button"
                class="btn-source-control btn-sm"
                (click)="toggleEditMode()"
              >
                <svg
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"
                  />
                </svg>
                {{ "styles.edit" | transloco }}
              </button>
              <button
                type="button"
                class="btn-source-control btn-sm"
                (click)="confirmDelete()"
                [disabled]="deleting()"
              >
                <svg
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"
                  />
                </svg>
                {{ "styles.delete" | transloco }}
              </button>
            }
          </div>
        </div>
      </header>

      <!-- Delete Confirmation Modal -->
      @if (showDeleteConfirm()) {
        <div class="modal-overlay">
          <div class="modal-panel">
            <h3>{{ "styles.delete_confirm_title" | transloco }}</h3>
            <p>{{ "styles.delete_confirm_message" | transloco }}</p>
            <div class="modal-actions">
              <button
                type="button"
                class="btn-source-control"
                (click)="cancelDelete()"
                [disabled]="deleting()"
              >
                {{ "styles.cancel" | transloco }}
              </button>
              <button
                type="button"
                class="btn-primary btn-danger"
                (click)="onDelete()"
                [disabled]="deleting()"
              >
                @if (deleting()) {
                  {{ "styles.deleting" | transloco }}
                } @else {
                  {{ "styles.confirm_delete" | transloco }}
                }
              </button>
            </div>
          </div>
        </div>
      }

      <!-- Two Column Content Layout -->
      <div class="style-detail-content">
        <!-- Main Column -->
        <div class="style-detail-main">
          <!-- Prompt Template -->
          <div class="style-detail-section">
            <div class="style-detail-section-header">
              <h2 class="style-detail-section-title">{{ "styles.prompt_template" | transloco }}</h2>
              <button
                type="button"
                class="btn-source-control btn-sm"
                (click)="copyToClipboard(style()?.prompt ?? '')"
              >
                <svg
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"
                  />
                </svg>
                {{ "styles.copy" | transloco }}
              </button>
            </div>
            <pre class="code-block-compact">{{ style()?.prompt }}</pre>
          </div>

          <!-- Tags & Models Inline -->
          <div class="style-detail-tags-models">
            @if (style()?.tags && style()!.tags!.length > 0) {
              <div class="style-detail-inline-section">
                <span class="style-detail-inline-label">{{ "styles.tags" | transloco }}:</span>
                <div class="badge-container-inline">
                  @for (tag of style()!.tags; track tag) {
                    <span class="badge-base badge-info badge-sm">{{ tag }}</span>
                  }
                </div>
              </div>
            }
            @if (style()?.models && style()!.models!.length > 0) {
              <div class="style-detail-inline-section">
                <span class="style-detail-inline-label">{{ "styles.compatible_models" | transloco }}:</span>
                <div class="badge-container-inline">
                  @for (model of style()!.models; track model) {
                    <span class="badge-base badge-secondary badge-sm">{{ model }}</span>
                  }
                </div>
              </div>
            }
          </div>

          <!-- JSON View (collapsible) -->
          @if (showJsonView()) {
            <div class="style-detail-section">
              <div class="style-detail-section-header">
                <h2 class="style-detail-section-title">{{ "styles.json_view" | transloco }}</h2>
                <button
                  type="button"
                  class="btn-source-control btn-sm"
                  (click)="copyToClipboard(styleJson())"
                >
                  <svg
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"
                    />
                  </svg>
                  {{ "styles.copy" | transloco }}
                </button>
              </div>
              <pre class="code-block code-block-sm code-block-bordered code-block-scroll" [innerHTML]="styleJsonHighlighted()"></pre>
            </div>
          }

          <!-- Example Images (Image Styles Only) -->
          @if (isImageStyle() && style()) {
            @let imageStyle = $any(style());
            @if (imageStyle.examples && imageStyle.examples.length > 0) {
              <div class="style-detail-section style-detail-examples">
                <h2 class="style-detail-section-title">{{ "styles.examples" | transloco }}</h2>
                <div class="image-grid image-grid-compact">
                  @for (example of imageStyle.examples; track example.id) {
                    <div class="image-grid-item" [class.image-grid-item-primary]="example.primary">
                      <img [src]="example.url" [alt]="'Example for ' + style()?.name" loading="lazy" />
                      @if (example.primary) {
                        <span class="image-badge">{{ "styles.primary" | transloco }}</span>
                      }
                    </div>
                  }
                </div>
              </div>
            }
          }
        </div>

        <!-- Sidebar Column - Parameters -->
        <aside class="style-detail-sidebar">
          <!-- Image Style Parameters -->
          @if (imageStyleParams()) {
            <div class="style-detail-section">
              <h2 class="style-detail-section-title">{{ "styles.generation_params" | transloco }}</h2>
              <div class="style-detail-params-section">
                <dl class="style-detail-params">
                  @if (imageStyleParams()?.sampler_name) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.sampler" | transloco }}</dt>
                      <dd>{{ imageStyleParams()?.sampler_name }}</dd>
                    </div>
                  }
                  @if (imageStyleParams()?.cfg_scale !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.cfg_scale" | transloco }}</dt>
                      <dd>{{ imageStyleParams()?.cfg_scale }}</dd>
                    </div>
                  }
                  @if (imageStyleParams()?.steps !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.steps" | transloco }}</dt>
                      <dd>{{ imageStyleParams()?.steps }}</dd>
                    </div>
                  }
                  @if (imageStyleParams()?.width !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.width" | transloco }}</dt>
                      <dd>{{ imageStyleParams()?.width }}px</dd>
                    </div>
                  }
                  @if (imageStyleParams()?.height !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.height" | transloco }}</dt>
                      <dd>{{ imageStyleParams()?.height }}px</dd>
                    </div>
                  }
                  @if (imageStyleParams()?.clip_skip !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.clip_skip" | transloco }}</dt>
                      <dd>{{ imageStyleParams()?.clip_skip }}</dd>
                    </div>
                  }
                  @if (imageStyleParams()?.denoising_strength !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.denoising_strength" | transloco }}</dt>
                      <dd>{{ imageStyleParams()?.denoising_strength }}</dd>
                    </div>
                  }
                  @if (imageStyleParams()?.facefixer_strength !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.facefixer_strength" | transloco }}</dt>
                      <dd>{{ imageStyleParams()?.facefixer_strength }}</dd>
                    </div>
                  }
                  @if (imageStyleParams()?.workflow) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.workflow" | transloco }}</dt>
                      <dd>{{ imageStyleParams()?.workflow }}</dd>
                    </div>
                  }
                </dl>

                <!-- Boolean Flags -->
                @if (
                  imageStyleParams()?.karras !== undefined ||
                  imageStyleParams()?.hires_fix !== undefined ||
                  imageStyleParams()?.tiling !== undefined ||
                  imageStyleParams()?.transparent !== undefined
                ) {
                  <div class="style-detail-param style-detail-param-flags">
                    <dt>{{ "styles.flags" | transloco }}</dt>
                    <dd class="style-detail-flags">
                      @if (imageStyleParams()?.karras) {
                        <span class="badge-base badge-success badge-sm">Karras</span>
                      }
                      @if (imageStyleParams()?.hires_fix) {
                        <span class="badge-base badge-success badge-sm">Hires Fix</span>
                      }
                      @if (imageStyleParams()?.tiling) {
                        <span class="badge-base badge-success badge-sm">Tiling</span>
                      }
                      @if (imageStyleParams()?.transparent) {
                        <span class="badge-base badge-success badge-sm">Transparent</span>
                      }
                    </dd>
                  </div>
                }

                <!-- Post Processing -->
                @if (imageStyleParams()?.post_processing && imageStyleParams()!.post_processing!.length > 0) {
                  <div class="style-detail-param style-detail-param-full">
                    <dt>{{ "styles.form.post_processing" | transloco }}</dt>
                    <dd class="badge-container-inline">
                      @for (pp of imageStyleParams()!.post_processing; track pp) {
                        <span class="badge-base badge-purple badge-sm">{{ pp }}</span>
                      }
                    </dd>
                  </div>
                }

                <!-- LoRAs -->
                @if (imageStyleParams()?.loras && imageStyleParams()!.loras!.length > 0) {
                  <div class="style-detail-param style-detail-param-full">
                    <dt>{{ "styles.form.loras" | transloco }}</dt>
                    <dd class="style-detail-loras">
                      @for (lora of imageStyleParams()!.loras; track lora.name) {
                        <div class="style-detail-lora-item">
                          <span class="style-detail-lora-name">{{ lora.name }}</span>
                          <span class="style-detail-lora-values">
                            model: {{ lora.model ?? 1 }} | clip: {{ lora.clip ?? 1 }}
                            @if (lora.inject_trigger) { | trigger: {{ lora.inject_trigger }} }
                          </span>
                        </div>
                      }
                    </dd>
                  </div>
                }

                <!-- Textual Inversions -->
                @if (imageStyleParams()?.tis && imageStyleParams()!.tis!.length > 0) {
                  <div class="style-detail-param style-detail-param-full">
                    <dt>{{ "styles.form.tis" | transloco }}</dt>
                    <dd class="style-detail-tis">
                      @for (ti of imageStyleParams()!.tis; track ti.name) {
                        <div class="style-detail-ti-item">
                          <span class="style-detail-ti-name">{{ ti.name }}</span>
                          <span class="style-detail-ti-values">
                            inject: {{ ti.inject_ti ?? 'prompt' }} | strength: {{ ti.strength ?? 1 }}
                          </span>
                        </div>
                      }
                    </dd>
                  </div>
                }
              </div>
            </div>
          }

          <!-- Text Style Parameters -->
          @if (textStyleParams()) {
            <div class="style-detail-section">
              <h2 class="style-detail-section-title">{{ "styles.generation_params" | transloco }}</h2>
              <div class="style-detail-params-section">
                <dl class="style-detail-params style-detail-params-compact">
                  @if (textStyleParams()?.temperature !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.temperature" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.temperature }}</dd>
                    </div>
                  }
                  @if (textStyleParams()?.top_p !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.top_p" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.top_p }}</dd>
                    </div>
                  }
                  @if (textStyleParams()?.top_k !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.top_k" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.top_k }}</dd>
                    </div>
                  }
                  @if (textStyleParams()?.top_a !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.top_a" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.top_a }}</dd>
                    </div>
                  }
                  @if (textStyleParams()?.min_p !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.min_p" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.min_p }}</dd>
                    </div>
                  }
                  @if (textStyleParams()?.typical !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.typical" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.typical }}</dd>
                    </div>
                  }
                  @if (textStyleParams()?.tfs !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.tfs" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.tfs }}</dd>
                    </div>
                  }
                  @if (textStyleParams()?.rep_pen !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.rep_pen" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.rep_pen }}</dd>
                    </div>
                  }
                  @if (textStyleParams()?.rep_pen_range !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.rep_pen_range" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.rep_pen_range }}</dd>
                    </div>
                  }
                  @if (textStyleParams()?.rep_pen_slope !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.rep_pen_slope" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.rep_pen_slope }}</dd>
                    </div>
                  }
                  @if (textStyleParams()?.smoothing_factor !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.smoothing_factor" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.smoothing_factor }}</dd>
                    </div>
                  }
                  @if (textStyleParams()?.dynatemp_range !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.dynatemp_range" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.dynatemp_range }}</dd>
                    </div>
                  }
                  @if (textStyleParams()?.dynatemp_exponent !== undefined) {
                    <div class="style-detail-param">
                      <dt>{{ "styles.form.dynatemp_exponent" | transloco }}</dt>
                      <dd>{{ textStyleParams()?.dynatemp_exponent }}</dd>
                    </div>
                  }
                </dl>

                <!-- Boolean Flags for Text -->
                @if (
                  textStyleParams()?.singleline !== undefined ||
                  textStyleParams()?.frmtadsnsp !== undefined ||
                  textStyleParams()?.frmtrmblln !== undefined ||
                  textStyleParams()?.frmtrmspch !== undefined ||
                  textStyleParams()?.frmttriminc !== undefined ||
                  textStyleParams()?.use_default_badwordsids !== undefined
                ) {
                  <div class="style-detail-param style-detail-param-flags">
                    <dt>{{ "styles.flags" | transloco }}</dt>
                    <dd class="style-detail-flags">
                      @if (textStyleParams()?.singleline) {
                        <span class="badge-base badge-info badge-sm">Single Line</span>
                      }
                      @if (textStyleParams()?.use_default_badwordsids) {
                        <span class="badge-base badge-info badge-sm">Default Bad Words</span>
                      }
                      @if (textStyleParams()?.frmtadsnsp) {
                        <span class="badge-base badge-outline badge-sm">Add Sentence Space</span>
                      }
                      @if (textStyleParams()?.frmtrmblln) {
                        <span class="badge-base badge-outline badge-sm">Remove Blank Lines</span>
                      }
                      @if (textStyleParams()?.frmtrmspch) {
                        <span class="badge-base badge-outline badge-sm">Remove Special Chars</span>
                      }
                      @if (textStyleParams()?.frmttriminc) {
                        <span class="badge-base badge-outline badge-sm">Trim Incomplete</span>
                      }
                    </dd>
                  </div>
                }

                <!-- Sampler Order -->
                @if (textStyleParams()?.sampler_order && textStyleParams()!.sampler_order!.length > 0) {
                  <div class="style-detail-param style-detail-param-full">
                    <dt>{{ "styles.form.sampler_order" | transloco }}</dt>
                    <dd class="style-detail-code-inline">{{ textStyleParams()?.sampler_order?.join(', ') }}</dd>
                  </div>
                }

                <!-- Stop Sequences -->
                @if (textStyleParams()?.stop_sequence && textStyleParams()!.stop_sequence!.length > 0) {
                  <div class="style-detail-param style-detail-param-full">
                    <dt>{{ "styles.form.stop_sequence" | transloco }}</dt>
                    <dd class="badge-container-inline">
                      @for (seq of textStyleParams()!.stop_sequence; track seq) {
                        <span class="style-detail-code-inline">{{ seq }}</span>
                      }
                    </dd>
                  </div>
                }
              </div>
            </div>
          }
        </aside>
      </div>
    </article>
  }
</div>
