import{a as fe}from"./chunk-DDCMYIKF.js";import{a as Z}from"./chunk-62U34UEH.js";import{a as he}from"./chunk-UQV72EDM.js";import{b as O,e as j}from"./chunk-J27YOVZ5.js";import{c as ee,d as y,e as te,f as ie,g as re,h as f,j as ne,k as ae,l as oe,m as se,n as le,o as pe,p as me,r as de,s as ce,v as ue}from"./chunk-7P7BAAIV.js";import{a as U,b as z}from"./chunk-T6V27EFK.js";import{a as Y}from"./chunk-ISHBUXAM.js";import{a as J}from"./chunk-VFTR325L.js";import{b as Q,c as W,d as X}from"./chunk-BMIYH3UD.js";import{l as L}from"./chunk-3GXWXVSS.js";import{k as d}from"./chunk-GZDNXZTC.js";import{C as A,Cb as H,Db as E,Oa as i,Ob as C,Rb as o,Sb as m,Tb as S,Ub as G,X as _,Za as D,cb as N,dc as T,ga as q,gb as M,gc as s,hc as p,ic as V,ja as g,nc as F,ob as b,pb as v,rb as P,sb as $,tb as u,ub as a,vb as r,wb as k,xb as K,yb as w}from"./chunk-QF4LG6ZD.js";import{d as R}from"./chunk-4CLCTAJ7.js";var be=t=>({exampleUser:t}),_e=t=>({user:t}),ve=t=>({amountFormatted:t}),ye=(t,n)=>n.id;function xe(t,n){if(t&1&&(K(0),o(1),w()),t&2){let l=n.$implicit;i(),S(" ",l("transfer.title")," ")}}function ge(t,n){if(t&1&&(K(0),o(1),a(2,"a",26),o(3),r(),o(4," . "),w()),t&2){let l=n.$implicit;i(),S(" ",l("transfer.visit_old_pre")," "),i(2),m(l("transfer.visit_old_link_text"))}}function Ce(t,n){t&1&&(a(0,"p",14)(1,"small"),o(2),s(3,"transloco"),r()()),t&2&&(i(2),m(p(3,1,"invalid_api_key")))}function Se(t,n){if(t&1&&(a(0,"p",15)(1,"small"),o(2),s(3,"transloco"),r()()),t&2){let l=E();i(2),m(V(3,1,"current_user",T(4,_e,l.currentUser().username)))}}function ke(t,n){if(t&1&&(a(0,"option",30),o(1),s(2,"transloco"),r(),a(3,"option",30),o(4),s(5,"formatNumber"),s(6,"transloco"),r()),t&2){let l=n.$implicit;u("value",null),i(),S(" ",p(2,5,"option.empty")," "),i(2),u("value",l.id),i(),G(" ",l.username," (",V(6,9,"transfer.account.kudos_amount",T(12,ve,p(5,7,l.kudos))),") ")}}function Te(t,n){if(t&1&&(a(0,"div",27)(1,"p",15)(2,"small"),o(3),s(4,"transloco"),a(5,"sup")(6,"a",28),o(7,"1"),r()()()(),a(8,"select",29),P(9,ke,7,14,null,null,ye),r()()),t&2){let l=E();C("mb-5",l.form.value.targetUserValidated!==!1)("mb-1",l.form.value.targetUserValidated===!1),i(3),m(p(4,5,"transfer.donate")),i(6),$(l.educatorAccounts())}}function Ve(t,n){t&1&&(a(0,"p",21)(1,"small"),o(2),s(3,"transloco"),r()()),t&2&&(i(2),m(p(3,1,"invalid_target_user")))}function Ue(t,n){t&1&&(a(0,"p",21)(1,"small"),o(2),s(3,"transloco"),r()()),t&2&&(i(2),m(p(3,1,"transfer.too_many_kudos")))}function Ae(t,n){t&1&&(a(0,"p",31),o(1),s(2,"transloco"),r()),t&2&&(i(),S(" ",p(2,1,"transfer.success")," "))}function Ee(t,n){t&1&&(a(0,"p",21),o(1),s(2,"transloco"),r()),t&2&&(i(),m(p(2,1,"transfer.error")))}function Be(t,n){if(t&1&&b(0,Ae,3,3,"p",31)(1,Ee,3,3,"p",21),t&2){let l=E();v(l.sentSuccessfully()?0:1)}}var Je=(()=>{let n=class n{constructor(){this.title=_(L),this.translator=_(Y),this.footerColor=_(Z),this.database=_(z),this.aiHorde=_(J),this.activatedRoute=_(O),this.destroyRef=_(q),this.exampleUsers=g(["db0#1","Tazlin#6572","Rikudou#185676"]),this.exampleUser=F(()=>this.exampleUsers()[Math.floor(Math.random()*this.exampleUsers().length)]),this.currentUser=g(null),this.sentSuccessfully=g(null),this.maximumKudos=F(()=>this.currentUser()?this.currentUser().kudos:null),this.educatorAccounts=g(void 0),this.fragment=g(null),this.form=new re({apiKey:new f("",[y.required]),remember:new f(!1),targetUser:new f("",[y.required]),kudosAmount:new f(1,[y.required,y.min(1)]),educatorAccount:new f(null),apiKeyValidated:new f(null,[y.requiredTrue]),targetUserValidated:new f(null,[y.requiredTrue]),kudosAmountValidated:new f(null,[y.requiredTrue])}),M(()=>{this.aiHorde.getEducatorAccounts().pipe(d(this.destroyRef)).subscribe(h=>{this.educatorAccounts.set(h)})})}ngOnInit(){this.translator.get("transfer.title").pipe(d(this.destroyRef)).subscribe(e=>{this.translator.get("app_title").subscribe(c=>{this.title.setTitle(`${e} | ${c}`)})}),this.footerColor.setDarkMode(!0);let h=this.database.get("remember_api_key",!0),x=this.database.get("api_key",h?U.Permanent:U.Session);this.form.controls.apiKey.valueChanges.pipe(d(this.destroyRef)).subscribe(()=>{this.currentUser.set(null),this.form.patchValue({apiKeyValidated:null})}),this.form.controls.targetUser.valueChanges.pipe(d(this.destroyRef)).subscribe(()=>{this.form.patchValue({targetUserValidated:null})}),this.form.controls.kudosAmount.valueChanges.pipe(d(this.destroyRef)).subscribe(e=>{if(e??=0,this.maximumKudos()===null){this.form.patchValue({kudosAmountValidated:null});return}this.form.patchValue({kudosAmountValidated:e<=this.maximumKudos()})}),this.form.controls.educatorAccount.valueChanges.pipe(d(this.destroyRef)).subscribe(e=>{if(e==="null"&&(e=null),!e){this.form.controls.targetUser.enable(),this.form.patchValue({targetUser:""});return}e=Number(e);let c=this.educatorAccounts().filter(B=>B.id===e)[0];this.form.controls.targetUser.disable(),this.form.patchValue({targetUser:c.username})}),this.form.controls.apiKey.valueChanges.pipe(A(500),d(this.destroyRef)).subscribe(e=>R(this,null,function*(){e&&this.aiHorde.getUserByApiKey(e).subscribe(c=>{this.currentUser.set(c),this.form.patchValue({apiKeyValidated:c!==null})})})),this.form.controls.targetUser.valueChanges.pipe(A(500),d(this.destroyRef)).subscribe(e=>R(this,null,function*(){if(!e)return;let c=e.split("#");if(c.length!==2){this.form.patchValue({targetUserValidated:!1});return}let B=Number(c[1]);this.aiHorde.getUserById(B).subscribe(I=>{this.form.patchValue({targetUserValidated:I!==null&&e.toLowerCase()===I.username.toLowerCase()})})})),this.form.patchValue({remember:h}),x&&this.form.patchValue({apiKey:x}),this.form.valueChanges.pipe(A(300),d(this.destroyRef)).subscribe(e=>{this.database.store("remember_api_key",e.remember??!1),this.database.store("api_key",e.apiKey??"",e.remember?U.Permanent:U.Session),this.sentSuccessfully.set(null)}),this.activatedRoute.fragment.pipe(d(this.destroyRef)).subscribe(e=>{this.fragment.set(e),e&&typeof document<"u"&&document.querySelector(`#${e}`)?.scrollIntoView()})}transfer(){this.sentSuccessfully.set(null),this.form.valid&&this.aiHorde.transferKudos(this.form.value.apiKey,this.form.controls.targetUser.value,this.form.value.kudosAmount).subscribe(h=>{this.sentSuccessfully.set(h)})}};n.\u0275fac=function(x){return new(x||n)},n.\u0275cmp=D({type:n,selectors:[["app-transfer"]],decls:47,vars:52,consts:[[1,"section-primary"],[1,"container-page-header"],[1,"place-center"],[1,"heading-hero"],[4,"transloco"],[1,"section-secondary"],[1,"container-spaced"],[1,"grid-items"],[1,"text-secondary","sm:text-lg"],[1,"mb-6"],[1,"max-w-sm","mx-auto",3,"ngSubmit","formGroup"],[1,"mb-2"],["for","source_api_key",1,"form-label"],["formControlName","apiKey","type","text","id","source_api_key","required","",1,"form-input",3,"placeholder"],[1,"mb-1","text-error"],[1,"mb-1"],[1,"mb-5"],["formControlName","remember",3,"description"],["for","target_user",1,"form-label"],["formControlName","targetUser","type","text","id","target_user","required","",1,"form-input",3,"placeholder"],[1,"text-primary",3,"mb-5","mb-1"],[1,"mb-5","text-error"],["for","kudos_amount",1,"form-label"],["formControlName","kudosAmount","type","number","min","1","id","kudos_amount","required","",1,"form-input",3,"placeholder"],["type","submit",1,"btn-primary","btn-responsive",3,"disabled"],["id","note1",1,"mt-6"],["href","/transfer",1,"link"],[1,"text-primary"],["routerLink","/v2-transfer/","fragment","note1",1,"text-blue-600","dark:text-green-400"],["formControlName","educatorAccount",1,"form-input"],[3,"value"],[1,"mb-5","text-success"]],template:function(x,e){x&1&&(a(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),N(4,xe,2,1,"ng-container",4),r()()()(),a(5,"section",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"p",9),N(10,ge,5,2,"ng-container",4),r(),a(11,"form",10),H("ngSubmit",function(){return e.transfer()}),a(12,"div",11)(13,"label",12),o(14),s(15,"transloco"),r(),k(16,"input",13),s(17,"transloco"),r(),b(18,Ce,4,3,"p",14),b(19,Se,4,6,"p",15),a(20,"div",16),k(21,"app-toggle-checkbox",17),s(22,"transloco"),r(),a(23,"div")(24,"label",18),o(25),s(26,"transloco"),r(),k(27,"input",19),s(28,"transloco"),r(),b(29,Te,11,7,"div",20),b(30,Ve,4,3,"p",21),a(31,"div")(32,"label",22),o(33),s(34,"transloco"),r(),k(35,"input",23),s(36,"transloco"),s(37,"transloco"),r(),b(38,Ue,4,3,"p",21),b(39,Be,2,1),a(40,"button",24),o(41," Submit "),r()(),a(42,"p",25)(43,"sup"),o(44,"1"),r(),o(45),s(46,"transloco"),r()()()()()),x&2&&(i(11),u("formGroup",e.form),i(3),m(p(15,28,"transfer.source_api_key")),i(2),u("placeholder",p(17,30,"transfer.source_api_key.description")),i(2),v(e.form.value.apiKeyValidated===!1?18:-1),i(),v(e.currentUser()?19:-1),i(2),u("description",p(22,32,"transfer.source_api_key.remember")),i(2),C("mb-1",e.educatorAccounts())("mb-5",!e.educatorAccounts()),i(2),m(p(26,34,"transfer.target_user")),i(2),u("placeholder",V(28,36,"transfer.target_user.description",T(48,be,e.exampleUser()))),i(2),v(e.educatorAccounts()?29:-1),i(),v(e.form.value.targetUserValidated===!1?30:-1),i(),C("mb-5",e.form.value.kudosAmountValidated!==!1)("mb-1",e.form.value.kudosAmountValidated===!1),i(2),m(p(34,39,"transfer.kudos_amount")),i(2),u("placeholder",V(37,43,"transfer.kudos_amount.description",T(50,_e,e.form.value.targetUser||p(36,41,"transfer.kudos_amount.description.user_placeholder")))),i(3),v(e.form.value.kudosAmountValidated===!1?38:-1),i(),v(e.sentSuccessfully()!==null?39:-1),i(),C("btn-disabled",!e.form.valid),u("disabled",!e.form.valid),i(2),C("active",e.fragment()==="note1"),i(3),S(" ",p(46,46,"educators.explanation")," "))},dependencies:[W,X,Q,fe,ue,ne,pe,me,ee,ae,le,te,ie,ce,de,oe,se,he,j],encapsulation:2});let t=n;return t})();export{Je as TransferComponent};
